<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>痘痘再见，再也不见 | 联合丽格西南中心医美科普 - 专业痤疮治疗指南</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="联合丽格西南中心提供专业痤疮治疗服务，包括激光祛痘、果酸焕肤、光动力疗法等多种医美项目。GAGS评分系统智能推荐治疗方案，专家团队在线咨询，真实案例对比展示。了解痘痘治疗、痘坑修复、痤疮护理的权威指南。">
    <meta name="keywords" content="痤疮治疗,痘痘治疗,祛痘,痘坑修复,激光祛痘,果酸焕肤,光动力疗法,医美祛痘,痘痘医生,GAGS评分,联合丽格,皮肤科,医美科普,痤疮护理,痘印治疗">
    <meta name="author" content="联合丽格西南中心">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="revisit-after" content="7 days">
    <link rel="canonical" href="https://acne.yoursite.com/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://acne.yoursite.com/">
    <meta property="og:title" content="痘痘再见，再也不见 | 联合丽格西南中心医美科普">
    <meta property="og:description" content="专业痤疮治疗指南，提供激光祛痘、果酸焕肤、光动力疗法等多种医美项目。GAGS智能评分，专家在线咨询，真实案例展示。">
    <meta property="og:image" content="https://acne.yoursite.com/og-image.png">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="联合丽格西南中心">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://acne.yoursite.com/">
    <meta name="twitter:title" content="痘痘再见，再也不见 | 联合丽格西南中心">
    <meta name="twitter:description" content="专业痤疮治疗指南，智能推荐系统，专家团队在线咨询">
    <meta name="twitter:image" content="https://acne.yoursite.com/twitter-image.png">

    <!-- Mobile Optimization -->
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="痘痘再见">

    <!-- Icons -->
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">

    <!-- jsPDF库 - 用于生成PDF报告 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "MedicalBusiness",
      "name": "联合丽格西南中心",
      "description": "专业痤疮治疗医疗机构，提供激光祛痘、果酸焕肤、光动力疗法等医美服务",
      "url": "https://acne.yoursite.com",
      "logo": "https://acne.yoursite.com/logo.png",
      "image": "https://acne.yoursite.com/og-image.png",
      "telephone": "400-123-4567",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "成都",
        "addressRegion": "四川省",
        "addressCountry": "CN"
      },
      "medicalSpecialty": [
        "Dermatology",
        "CosmeticSurgery"
      ],
      "availableService": [
        {
          "@type": "MedicalProcedure",
          "name": "激光祛痘",
          "description": "点阵激光、光子嫩肤等激光类痤疮治疗"
        },
        {
          "@type": "MedicalProcedure",
          "name": "果酸焕肤",
          "description": "化学焕肤治疗痤疮和痘印"
        },
        {
          "@type": "MedicalProcedure",
          "name": "光动力疗法",
          "description": "ALA-PDT红蓝光治疗重度痤疮"
        }
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "痤疮治疗服务",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "GAGS评分系统",
              "description": "智能痤疮评估和治疗方案推荐"
            }
          }
        ]
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "痘痘再见 - 联合丽格痤疮治疗指南",
      "url": "https://acne.yoursite.com",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://acne.yoursite.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <style>
        /* CSS变量 - 浅色模式（默认） */
        :root {
            --bg-gradient-start: #f5f7fa;
            --bg-gradient-end: #c3cfe2;
            --text-primary: #333;
            --text-secondary: #666;
            --text-muted: #999;
            --bg-white: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-hover: rgba(255, 255, 255, 0.95);
            --border-color: #e9ecef;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --shadow-hover: rgba(0, 0, 0, 0.15);
            --input-bg: white;
            --input-border: #ddd;
            --modal-bg: rgba(0, 0, 0, 0.5);
        }

        /* 深色模式 */
        [data-theme="dark"] {
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --bg-white: #2a2a3e;
            --bg-card: rgba(42, 42, 62, 0.95);
            --bg-hover: rgba(50, 50, 70, 0.98);
            --border-color: #3a3a4e;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --shadow-hover: rgba(0, 0, 0, 0.4);
            --input-bg: #2a2a3e;
            --input-border: #3a3a4e;
            --modal-bg: rgba(0, 0, 0, 0.7);
        }

        /* 平滑过渡 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            background: var(--bg-card);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px var(--shadow-color);
            position: relative;
        }

        /* 主题切换按钮 */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            box-shadow: 0 4px 15px var(--shadow-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(20deg);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        /* 主题切换动画 */
        .theme-icon {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .theme-icon.hide {
            transform: rotate(180deg);
            opacity: 0;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
        }

        .header-logo img {
            max-width: 120px;
            margin: 0;
        }

        .header-title {
            text-align: left;
        }

        .header-title h1 {
            font-size: 2em;
            color: #2c3e50;
            margin: 0 0 8px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-title p {
            font-size: 0.95em;
            color: #7f8c8d;
            margin: 0;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .book-info {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .toc {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chapter-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .chapter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .chapter-title {
            color: #e74c3c;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .chapter-desc {
            color: #555;
            font-size: 0.9em;
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
            display: none;
        }

        .content-area.active {
            display: block;
        }

        .content {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 20px;
        }

        .content h1, .content h2, .content h3 {
            color: #2c3e50;
            margin: 20px 0 10px 0;
        }

        .content p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .content ul, .content ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        .content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .content strong {
            font-weight: bold;
            color: #2c3e50;
        }

        .content em {
            font-style: italic;
            color: #7f8c8d;
        }

        .back-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background 0.3s ease;
        }

        .back-btn:hover {
            background: #2980b9;
        }

        .stats {
            text-align: center;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .stat-item {
            display: inline-block;
            margin: 0 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #e74c3c;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        footer {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin-top: 30px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .footer-content {
            max-width: 1000px;
            margin: 0 auto;
        }

        .footer-company {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }

        .footer-company h4 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 8px;
        }

        .footer-company p {
            color: #7f8c8d;
            font-size: 1em;
        }

        .footer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px 0;
        }

        .footer-item {
            color: #555;
            font-size: 0.95em;
            text-align: center;
        }

        .footer-item strong {
            color: #2c3e50;
            display: inline-block;
            margin-right: 5px;
        }

        .footer-item a {
            color: #3498db;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-item a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        .footer-copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .footer-copyright p {
            color: #7f8c8d;
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .footer-info {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .footer-item {
                text-align: left;
                padding-left: 20px;
            }
        }

        .search-box {
            margin: 20px 0;
            text-align: center;
        }

        .search-input {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            width: 300px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: #3498db;
        }

        /* 医美专区样式 */
        .medical-beauty-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .medical-beauty-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: medicalPulse 4s ease-in-out infinite;
        }

        @keyframes medicalPulse {
            0%, 100% { opacity: 0.5; transform: scale(0.8) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }

        .medical-beauty-section h3 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .medical-beauty-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .highlight-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .highlight-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .highlight-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .highlight-card h4 {
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .highlight-card p {
            font-size: 0.9em;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* 特殊章节样式 */
        .chapter-card.special {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: 3px solid #ffeaa7;
            position: relative;
            overflow: hidden;
        }

        .chapter-card.special::before {
            content: "✨ 专业医美";
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ffeaa7;
            color: #2d3436;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .chapter-card.special .chapter-title {
            color: #ffeaa7;
            font-size: 1.2em;
        }

        .chapter-card.special .chapter-desc {
            color: rgba(255, 255, 255, 0.9);
        }

        /* 工具面板样式 */
        .tool-panel {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            margin-top: 20px;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.1);
        }

        .tool-panel.active {
            display: block;
        }

        .tool-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 15px;
        }

        .tool-header h2 {
            color: #2c3e50;
            font-size: 1.6em;
            margin-bottom: 10px;
        }

        .tool-header p {
            color: #7f8c8d;
            font-size: 1em;
        }

        /* 表格样式 */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .comparison-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .comparison-table tr:hover {
            background-color: #e3f2fd;
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }

        /* 结果显示样式 */
        .result-card {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 184, 148, 0.3);
        }

        .result-card h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .cost-breakdown {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cost-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* 费用计算器专用样式 */
        .calculator-settings {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .calculator-results {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .treatment-category {
            background: rgba(52, 152, 219, 0.05);
            border: 2px solid rgba(52, 152, 219, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .treatment-category h4 {
            color: #2980b9;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid rgba(52, 152, 219, 0.2);
            padding-bottom: 8px;
        }

        .checkbox-group {
            margin: 15px 0;
        }

        .checkbox-group label {
            display: block;
            margin: 10px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .checkbox-group label:hover {
            background: rgba(52, 152, 219, 0.1);
            border-color: rgba(52, 152, 219, 0.3);
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checkbox-group input[type="checkbox"]:checked + span,
        .checkbox-group label:has(input[type="checkbox"]:checked) {
            background: rgba(52, 152, 219, 0.15);
            border-color: #3498db;
            font-weight: bold;
        }

        /* 费用计算器专用样式 */
        .treatment-type-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .treatment-type-btn:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }

        .treatment-type-btn.active {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border-color: #2980b9;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .treatment-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .treatment-checkbox {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .treatment-checkbox:hover {
            background: rgba(52, 152, 219, 0.08);
            border-color: rgba(52, 152, 219, 0.3);
        }

        .treatment-checkbox input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .treatment-checkbox input[type="checkbox"]:checked {
            accent-color: #3498db;
        }

        .treatment-checkbox:has(input[type="checkbox"]:checked) {
            background: rgba(52, 152, 219, 0.12);
            border-color: #3498db;
        }

        .price-tag {
            font-size: 0.85em;
            color: #00b894;
            font-weight: bold;
            margin-left: auto;
            padding-left: 10px;
        }

        /* 图标样式系统 */
        :root {
            --icon-color: #3498db;
            --icon-hover-color: #2980b9;
            --icon-special-color: #ffeaa7;
        }

        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            vertical-align: middle;
            transition: all 0.3s ease;
        }

        .icon--small {
            width: 20px;
            height: 20px;
        }

        .icon--large {
            width: 32px;
            height: 32px;
        }

        .icon--extra-large {
            width: 48px;
            height: 48px;
        }

        .icon svg {
            width: 100%;
            height: 100%;
        }

        /* 图标动画效果 */
        .icon:hover {
            transform: scale(1.1);
        }

        .chapter-card .icon:hover {
            transform: scale(1.2) rotate(5deg);
        }

        .loading-icon {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 章节卡片图标布局 */
        .chapter-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .chapter-icon {
            flex-shrink: 0;
            --icon-color: #e74c3c;
        }

        .chapter-card:hover .chapter-icon {
            --icon-color: #c0392b;
        }

        .chapter-card.special .chapter-icon {
            --icon-color: #ffeaa7;
        }

        /* 搜索框图标 */
        .search-container {
            position: relative;
            display: inline-block;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            --icon-color: #7f8c8d;
        }

        .search-input {
            padding-left: 45px;
        }

        .search-input:focus + .search-icon {
            --icon-color: #3498db;
        }

        /* 返回按钮图标 */
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-btn .icon {
            --icon-color: white;
        }

        /* 功能卡片图标 */
        .highlight-card .highlight-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .highlight-card .highlight-icon .icon {
            width: 40px;
            height: 40px;
            --icon-color: white;
        }

        /* 三件套黄金组合特殊样式 */
        .highlight-card.golden-combo {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #2c3e50;
            border: 3px solid #fff;
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.4);
            position: relative;
        }

        .highlight-card.golden-combo::before {
            content: '⭐ 黄金组合';
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
            z-index: 10;
        }

        @keyframes glow {
            from { box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); }
            to { box-shadow: 0 6px 25px rgba(255, 107, 107, 0.6); }
        }

        .highlight-card.golden-combo::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: -100%; }
        }

        .highlight-card.golden-combo:hover {
            transform: translateY(-8px) scale(1.08);
            box-shadow: 0 25px 50px rgba(255, 215, 0, 0.6);
        }

        .highlight-card.golden-combo h4 {
            font-size: 1.3em;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
            position: relative;
            z-index: 2;
        }

        .highlight-card.golden-combo p {
            font-weight: 600;
            opacity: 1;
            position: relative;
            z-index: 2;
        }

        /* 快速预览弹窗 */
        .quick-preview {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #2c3e50;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 300px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 2px solid #ffd700;
        }

        .highlight-card:hover .quick-preview {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(10px);
        }

        .preview-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd700;
        }

        .preview-header h5 {
            color: #ff6b6b;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .preview-items {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .preview-item {
            text-align: center;
            flex: 1;
        }

        .preview-item-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
        }

        .preview-item-text {
            font-size: 0.8em;
            font-weight: bold;
            color: #666;
        }

        .preview-benefits {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .preview-benefits h6 {
            color: #27ae60;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-align: center;
        }

        .preview-benefits ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .preview-benefits li {
            font-size: 0.8em;
            color: #555;
            margin-bottom: 4px;
            position: relative;
            padding-left: 15px;
        }

        .preview-benefits li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .preview-cta {
            text-align: center;
            margin-top: 15px;
        }

        .preview-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .preview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        /* 三件套专题页面样式 */
        .golden-combo-header {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            color: #2c3e50;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .golden-combo-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        .combo-hero {
            position: relative;
            z-index: 1;
        }

        .hero-badge {
            display: inline-block;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .combo-hero h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
        }

        .hero-subtitle {
            font-size: 1.2em;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 2.2em;
            font-weight: bold;
            color: #ff6b6b;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }

        .stat-label {
            font-size: 0.9em;
            margin-top: 5px;
            opacity: 0.8;
        }

        /* 治疗时间轴 */
        .treatment-timeline {
            margin: 40px 0;
        }

        .treatment-timeline h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .timeline {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
            transform: translateX(-50%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 40px;
            width: 50%;
        }

        .timeline-item:nth-child(odd) {
            left: 0;
            padding-right: 40px;
            text-align: right;
        }

        .timeline-item:nth-child(even) {
            left: 50%;
            padding-left: 40px;
            text-align: left;
        }

        .timeline-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            animation: timelinePulse 2s ease-in-out infinite;
        }

        @keyframes timelinePulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
            }
        }

        .timeline-marker:nth-child(1) { animation-delay: 0s; }
        .timeline-marker:nth-child(2) { animation-delay: 0.5s; }
        .timeline-marker:nth-child(3) { animation-delay: 1s; }
        .timeline-marker:nth-child(4) { animation-delay: 1.5s; }

        .timeline-item:nth-child(odd) .timeline-marker {
            right: -20px;
        }

        .timeline-item:nth-child(even) .timeline-marker {
            left: -20px;
        }

        .timeline-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border: 2px solid #f8f9fa;
        }

        .timeline-content h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .timeline-content p {
            color: #666;
            margin-bottom: 15px;
        }

        .timeline-content ul {
            list-style: none;
            padding: 0;
        }

        .timeline-content li {
            color: #555;
            margin-bottom: 8px;
            position: relative;
            padding-left: 20px;
        }

        .timeline-content li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }

        /* 治疗方法网格 */
        .treatment-methods {
            margin: 40px 0;
        }

        .treatment-methods h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .method-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
            border: 2px solid #f8f9fa;
        }

        .method-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .method-card:hover .method-icon {
            animation: methodIconBounce 0.6s ease-in-out;
        }

        @keyframes methodIconBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.2) rotate(0deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        .method-icon {
            font-size: 3em;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .method-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .method-description {
            text-align: left;
        }

        .method-description p {
            margin-bottom: 15px;
            color: #555;
        }

        .method-description ul {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }

        .method-description li {
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
            color: #666;
        }

        .method-description li:last-child {
            border-bottom: none;
        }

        /* 协同优势 */
        .combo-advantages {
            margin: 40px 0;
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
        }

        .combo-advantages h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .advantages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .advantage-item {
            text-align: center;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .advantage-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            animation: advantageFloat 3s ease-in-out infinite;
        }

        @keyframes advantageFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .advantage-item:nth-child(1) .advantage-icon { animation-delay: 0s; }
        .advantage-item:nth-child(2) .advantage-icon { animation-delay: 0.5s; }
        .advantage-item:nth-child(3) .advantage-icon { animation-delay: 1s; }
        .advantage-item:nth-child(4) .advantage-icon { animation-delay: 1.5s; }

        .advantage-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .advantage-item p {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
        }

        /* 成功案例 */
        .success-cases {
            margin: 40px 0;
        }

        .success-cases h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }

        .case-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .case-info h3 {
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .case-info p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* 价格指南 */
        .price-guide {
            margin: 40px 0;
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
        }

        .price-guide h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .price-table {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .price-item {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .price-item h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .price-range {
            margin-bottom: 20px;
        }

        .price {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .period {
            font-size: 0.9em;
            color: #666;
        }

        .price-item ul {
            list-style: none;
            padding: 0;
            text-align: left;
        }

        .price-item li {
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
            color: #666;
            font-size: 0.9em;
        }

        .price-item li:last-child {
            border-bottom: none;
        }

        .total-cost {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
        }

        .total-cost h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .total-cost p {
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        /* 操作按钮 */
        .action-buttons {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }

        .action-buttons .btn {
            margin: 0 10px 10px 0;
        }

        /* 三件套专题页面移动端优化 */
        @media (max-width: 768px) {
            .combo-hero h1 {
                font-size: 2em;
            }

            .hero-stats {
                flex-direction: column;
                gap: 20px;
            }

            .timeline::before {
                left: 20px;
            }

            .timeline-item {
                width: 100%;
                left: 0 !important;
                padding-left: 60px !important;
                padding-right: 0 !important;
                text-align: left !important;
            }

            .timeline-marker {
                left: 0 !important;
                right: auto !important;
            }

            .methods-grid {
                grid-template-columns: 1fr;
            }

            .advantages-grid {
                grid-template-columns: 1fr;
            }

            .cases-grid {
                grid-template-columns: 1fr;
            }

            .price-table {
                grid-template-columns: 1fr;
            }

            .action-buttons .btn {
                display: block;
                width: 100%;
                margin: 10px 0;
            }

            .golden-combo-header {
                padding: 30px 20px;
            }

            .hero-stats .stat {
                padding: 15px;
                background: rgba(255,255,255,0.2);
                border-radius: 10px;
            }

            /* 费用计算器移动端适配 */
            #costCalculatorModal .modal-content {
                max-width: 95%;
            }

            #costCalculatorModal .modal-content > div[style*="grid"] {
                grid-template-columns: 1fr !important;
            }

            .treatment-type-btn {
                padding: 12px 8px;
            }

            .treatment-type-btn div:first-child {
                font-size: 0.95em;
            }

            .treatment-category {
                padding: 15px;
                margin: 15px 0;
            }

            .treatment-checkbox {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .price-tag {
                margin-left: 28px;
                padding-left: 0;
            }

            .result-card {
                padding: 20px;
            }

            #totalCost {
                font-size: 1.8em !important;
            }
        }

        /* 自测模态窗口样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 20px;
        }

        .modal-header h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .modal-header .subtitle {
            color: #7f8c8d;
            font-size: 1em;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #95a5a6;
            transition: color 0.3s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #e74c3c;
        }

        /* 评估步骤样式 */
        .assessment-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .assessment-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .step-title {
            color: #2c3e50;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .step-description {
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* 评分区域样式 */
        .scoring-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .area-title {
            color: #2c3e50;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .scoring-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .score-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .score-option:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .score-option.selected {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.3);
        }

        .score-value {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .score-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .score-description {
            font-size: 0.8em;
            margin-top: 8px;
            line-height: 1.3;
        }

        /* 问题样式 */
        .question-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .question-title {
            color: #2c3e50;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .answer-options {
            display: grid;
            gap: 12px;
        }

        .answer-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .answer-option:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }

        .answer-option.selected {
            border-color: #e74c3c;
            background: #ffeaea;
        }

        .answer-option input[type="radio"] {
            margin: 0;
            width: 18px;
            height: 18px;
        }

        /* 进度条样式 */
        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* 按钮样式 */
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Markdown代码块样式 */
        #chapterContent pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #chapterContent code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }

        #chapterContent pre code {
            background: transparent;
            padding: 0;
            border-radius: 0;
            color: inherit;
        }

        #chapterContent p code {
            background: #f4f4f4;
            color: #e74c3c;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }

        /* Markdown表格样式 */
        .markdown-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .markdown-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .markdown-table th {
            padding: 15px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #764ba2;
        }

        .markdown-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .markdown-table tr:last-child td {
            border-bottom: none;
        }

        .markdown-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .markdown-table tr:hover {
            background-color: #e8f4f8;
        }

        /* 结果显示样式 */
        .result-container {
            text-align: center;
            padding: 30px;
        }

        .result-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .severity-level {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .severity-description {
            font-size: 1em;
            opacity: 0.9;
        }

        .treatment-recommendation {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }

        .recommendation-title {
            color: #2c3e50;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            background: white;
            border-left: 4px solid #e74c3c;
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .recommendation-list li:before {
            content: "✓";
            color: #27ae60;
            font-weight: bold;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.8em;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .header-title {
                text-align: center;
            }

            .header-title h1 {
                font-size: 1.5em;
            }

            .header-title p {
                font-size: 0.85em;
            }

            .toc {
                grid-template-columns: 1fr;
            }

            .search-input {
                width: 90%;
            }

            .medical-beauty-highlights {
                grid-template-columns: 1fr;
            }

            .highlight-card {
                padding: 20px;
            }

            .comparison-table {
                font-size: 0.9em;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px;
            }

            /* 移动端图标优化 */
            .icon--large {
                width: 28px;
                height: 28px;
            }

            .chapter-header {
                gap: 10px;
            }

            .highlight-card .highlight-icon .icon {
                width: 32px;
                height: 32px;
            }

            /* 移动端模态窗口优化 */
            .modal-content {
                width: 95%;
                padding: 20px;
                margin: 10px;
            }

            .modal-header h2 {
                font-size: 1.5em;
            }

            .scoring-options {
                grid-template-columns: 1fr 1fr;
            }

            .btn-group {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 200px;
            }

            .score-display {
                font-size: 2.5em;
            }

            /* 移动端费用计算器优化 */
            .tool-panel > div {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }

            .calculator-settings,
            .calculator-results {
                padding: 20px;
            }

            .treatment-category {
                padding: 15px;
            }

            .checkbox-group label {
                padding: 10px;
                font-size: 0.9em;
            }

            /* 移动端方案对比优化 */
            .comparison-table-container {
                overflow-x: auto;
            }

            .comparison-plan-card {
                min-width: 280px;
            }
        }

        /* 治疗方案对比样式 */
        .comparison-table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        .comparison-table {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            min-width: 100%;
        }

        .comparison-plan-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .comparison-plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .comparison-plan-card.recommended {
            border-color: #ffd700;
            background: linear-gradient(135deg, #fffaf0 0%, #ffffff 100%);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }

        .comparison-plan-card.recommended::before {
            content: '⭐ 推荐';
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            padding: 6px 20px;
            font-size: 0.85em;
            font-weight: 700;
            border-bottom-left-radius: 12px;
        }

        .comparison-plan-card.special {
            border-color: #e74c3c;
            background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
        }

        .comparison-plan-card.special::after {
            content: '黄金三件套';
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 6px 16px;
            font-size: 0.8em;
            font-weight: 600;
            border-bottom-right-radius: 12px;
        }

        .plan-name {
            font-size: 1.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 12px;
            margin-top: 8px;
        }

        .plan-cost {
            font-size: 1.3em;
            color: #e74c3c;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .comparison-row {
            margin: 18px 0;
        }

        .comparison-label {
            font-size: 0.9em;
            color: #7f8c8d;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .comparison-value {
            font-size: 1em;
            color: #2c3e50;
            font-weight: 500;
        }

        .progress-bar-container {
            width: 100%;
            height: 24px;
            background: #ecf0f1;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db 0%, #2ecc71 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            transition: width 0.6s ease;
        }

        .progress-bar-text {
            font-size: 0.8em;
            color: white;
            font-weight: 700;
        }

        .star-rating {
            display: flex;
            gap: 4px;
            font-size: 1.2em;
        }

        .star-rating .star {
            color: #ffd700;
        }

        .star-rating .star.empty {
            color: #ddd;
        }

        .treatment-list {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
        }

        .treatment-list li {
            padding: 8px 0;
            color: #2c3e50;
            font-size: 0.95em;
            position: relative;
            padding-left: 24px;
        }

        .treatment-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #2ecc71;
            font-weight: 700;
            font-size: 1.1em;
        }

        .pros-cons-toggle {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pros-cons-toggle:hover {
            background: #e8eaed;
            border-color: #3498db;
        }

        .pros-cons-toggle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #2c3e50;
        }

        .pros-cons-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .pros-cons-content.active {
            max-height: 500px;
            margin-top: 12px;
        }

        .pros-list, .cons-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }

        .pros-list li {
            padding: 6px 0;
            color: #27ae60;
            font-size: 0.9em;
            position: relative;
            padding-left: 20px;
        }

        .pros-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            font-weight: 700;
        }

        .cons-list li {
            padding: 6px 0;
            color: #e74c3c;
            font-size: 0.9em;
            position: relative;
            padding-left: 20px;
        }

        .cons-list li::before {
            content: '✗';
            position: absolute;
            left: 0;
            font-weight: 700;
        }

        .suitable-info {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #2c3e50;
        }

        .consult-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .consult-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
    </style>
</head>
<body>
    <!-- 主题切换按钮 -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="切换主题">
        <span class="theme-icon" id="themeIcon">🌙</span>
    </button>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-logo">
                    <img src="logo.png" alt="联合丽格">
                </div>
                <div class="header-title">
                    <h1>痘痘再见，再也不见</h1>
                    <p>联合丽格西南中心 · 专业医美科普</p>
                </div>
            </div>
        </header>

        <!-- 收藏/书签浮动按钮 -->
        <div id="bookmarkFloatBtn" onclick="toggleBookmarkPanel()" style="position: fixed; bottom: 80px; right: 30px; width: 60px; height: 60px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 5px 20px rgba(245,87,108,0.4); z-index: 1000; transition: all 0.3s;">
            <div style="position: relative;">
                <span style="font-size: 1.8em;">⭐</span>
                <span id="bookmarkCount" style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.7em; font-weight: bold;">0</span>
            </div>
        </div>

        <!-- 收藏列表面板 -->
        <div id="bookmarkPanel" style="display: none; position: fixed; top: 0; right: 0; width: 400px; height: 100vh; background: white; box-shadow: -5px 0 20px rgba(0,0,0,0.2); z-index: 1001; overflow-y: auto; animation: slideInRight 0.3s;">
            <div style="position: sticky; top: 0; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; z-index: 10;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="margin: 0; font-size: 1.3em;">我的收藏 ⭐</h3>
                    <button onclick="toggleBookmarkPanel()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2em; display: flex; align-items: center; justify-content: center;">
                        ×
                    </button>
                </div>
                <p style="margin: 10px 0 0 0; opacity: 0.9; font-size: 0.9em;">共 <span id="bookmarkTotalCount">0</span> 个收藏</p>
            </div>

            <!-- 分类标签 -->
            <div style="padding: 20px; border-bottom: 1px solid #e0e0e0;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="bookmark-tab-btn active" data-tab="all" onclick="switchBookmarkTab('all')" style="padding: 8px 16px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: all 0.3s;">
                        全部
                    </button>
                    <button class="bookmark-tab-btn" data-tab="treatment" onclick="switchBookmarkTab('treatment')" style="padding: 8px 16px; background: #f0f0f0; color: #666; border: none; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: all 0.3s;">
                        治疗项目
                    </button>
                    <button class="bookmark-tab-btn" data-tab="chapter" onclick="switchBookmarkTab('chapter')" style="padding: 8px 16px; background: #f0f0f0; color: #666; border: none; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: all 0.3s;">
                        电子书章节
                    </button>
                </div>
            </div>

            <!-- 收藏列表 -->
            <div id="bookmarkList" style="padding: 20px;">
                <!-- 空状态 -->
                <div id="bookmarkEmpty" style="text-align: center; padding: 60px 20px; color: #95a5a6;">
                    <div style="font-size: 4em; margin-bottom: 15px;">📚</div>
                    <p style="font-size: 1.1em;">还没有收藏任何内容</p>
                    <p style="font-size: 0.9em; margin-top: 8px; opacity: 0.7;">点击内容上的⭐按钮即可收藏</p>
                </div>
            </div>

            <style>
                @keyframes slideInRight {
                    from { transform: translateX(100%); }
                    to { transform: translateX(0); }
                }
                #bookmarkFloatBtn:hover {
                    transform: scale(1.1);
                    box-shadow: 0 8px 30px rgba(245,87,108,0.5);
                }
                .bookmark-tab-btn.active {
                    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
                    color: white !important;
                }
                .bookmark-tab-btn:hover {
                    transform: translateY(-2px);
                }
                .bookmark-item {
                    background: #f8f9fa;
                    padding: 15px;
                    border-radius: 10px;
                    margin-bottom: 12px;
                    position: relative;
                    transition: all 0.3s;
                    border-left: 4px solid #f093fb;
                }
                .bookmark-item:hover {
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                    transform: translateX(5px);
                }
                .bookmark-remove-btn {
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    background: #e74c3c;
                    color: white;
                    border: none;
                    width: 25px;
                    height: 25px;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: 0.8em;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                @media (max-width: 768px) {
                    #bookmarkPanel {
                        width: 100% !important;
                    }
                    #bookmarkFloatBtn {
                        bottom: 20px !important;
                        right: 20px !important;
                        width: 50px !important;
                        height: 50px !important;
                    }
                }
            </style>
        </div>

        <!-- 收藏遮罩层 -->
        <div id="bookmarkBackdrop" onclick="toggleBookmarkPanel()" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;"></div>

        <!-- 增强版全局搜索区域 -->
        <div class="enhanced-search-section" style="background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
            <div class="search-header" style="text-align: center; margin-bottom: 25px;">
                <h3 style="color: #2c3e50; font-size: 1.6em; margin-bottom: 8px;">🔍 智能搜索</h3>
                <p style="color: #7f8c8d; font-size: 0.95em;">搜索章节、治疗方案、常见问题</p>
            </div>

            <!-- 增强搜索框 -->
            <div class="enhanced-search-box" style="position: relative; max-width: 700px; margin: 0 auto 20px;">
                <input type="text" id="enhancedSearchInput" placeholder="输入关键词：痘痘、激光、水杨酸、费用..."
                    style="width: 100%; padding: 18px 55px 18px 20px; font-size: 1.05em; border: 2px solid #e0e0e0; border-radius: 50px; outline: none; transition: all 0.3s;"
                    onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 5px 20px rgba(102,126,234,0.2)'"
                    onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none'">
                <button onclick="performEnhancedSearch()" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); width: 45px; height: 45px; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <circle cx="11" cy="11" r="7" stroke="white" stroke-width="2.5" fill="none"/>
                        <path d="m21 21-4.35-4.35" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <!-- 热门搜索词标签（分类展示） -->
            <div style="margin-bottom: 20px;">
                <div style="text-align: center; margin-bottom: 15px;">
                    <span style="color: #7f8c8d; font-size: 0.9em; font-weight: 600;">🔥 热门搜索</span>
                </div>

                <!-- 痤疮类型相关 -->
                <div style="margin-bottom: 15px;">
                    <div style="text-align: center; color: #95a5a6; font-size: 0.85em; margin-bottom: 8px;">痤疮类型</div>
                    <div class="quick-search-tags" style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                        <button onclick="quickSearch('轻度痘痘')" class="tag-btn" style="background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); color: white; border: none; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; box-shadow: 0 2px 8px rgba(86,171,47,0.2);">😊 轻度痘痘</button>
                        <button onclick="quickSearch('中度痤疮')" class="tag-btn" style="background: linear-gradient(135deg, #ffd89b 0%, #f39c12 100%); color: white; border: none; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; box-shadow: 0 2px 8px rgba(243,156,18,0.2);">😐 中度痤疮</button>
                        <button onclick="quickSearch('重度痤疮')" class="tag-btn" style="background: linear-gradient(135deg, #ff9a9e 0%, #e74c3c 100%); color: white; border: none; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; box-shadow: 0 2px 8px rgba(231,76,60,0.2);">😰 重度痤疮</button>
                        <button onclick="quickSearch('痘坑痘印')" class="tag-btn" style="background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); color: white; border: none; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; box-shadow: 0 2px 8px rgba(108,92,231,0.2);">🏔️ 痘坑痘印</button>
                    </div>
                </div>

                <!-- 治疗方式相关 -->
                <div style="margin-bottom: 15px;">
                    <div style="text-align: center; color: #95a5a6; font-size: 0.85em; margin-bottom: 8px;">治疗方式</div>
                    <div class="quick-search-tags" style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                        <button onclick="quickSearch('激光治疗')" class="tag-btn" style="background: #fff; color: #667eea; border: 2px solid #667eea; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">💡 激光治疗</button>
                        <button onclick="quickSearch('水杨酸')" class="tag-btn" style="background: #fff; color: #667eea; border: 2px solid #667eea; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">🧪 水杨酸</button>
                        <button onclick="quickSearch('果酸焕肤')" class="tag-btn" style="background: #fff; color: #667eea; border: 2px solid #667eea; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">🍋 果酸焕肤</button>
                        <button onclick="quickSearch('光动力')" class="tag-btn" style="background: #fff; color: #667eea; border: 2px solid #667eea; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">💫 光动力</button>
                        <button onclick="quickSearch('微针')" class="tag-btn" style="background: #fff; color: #667eea; border: 2px solid #667eea; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">💉 微针</button>
                    </div>
                </div>

                <!-- 关心问题相关 -->
                <div>
                    <div style="text-align: center; color: #95a5a6; font-size: 0.85em; margin-bottom: 8px;">常见问题</div>
                    <div class="quick-search-tags" style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                        <button onclick="quickSearch('费用价格')" class="tag-btn" style="background: #f8f9fa; color: #555; border: 1px solid #dee2e6; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">💰 费用价格</button>
                        <button onclick="quickSearch('恢复期')" class="tag-btn" style="background: #f8f9fa; color: #555; border: 1px solid #dee2e6; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">⏰ 恢复期</button>
                        <button onclick="quickSearch('副作用')" class="tag-btn" style="background: #f8f9fa; color: #555; border: 1px solid #dee2e6; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">⚠️ 副作用</button>
                        <button onclick="quickSearch('护理方法')" class="tag-btn" style="background: #f8f9fa; color: #555; border: 1px solid #dee2e6; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">🌱 护理方法</button>
                        <button onclick="quickSearch('治疗周期')" class="tag-btn" style="background: #f8f9fa; color: #555; border: 1px solid #dee2e6; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">📅 治疗周期</button>
                        <button onclick="quickSearch('效果对比')" class="tag-btn" style="background: #f8f9fa; color: #555; border: 1px solid #dee2e6; padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">📊 效果对比</button>
                    </div>
                </div>
            </div>

            <!-- 搜索提示 -->
            <div style="text-align: center; color: #95a5a6; font-size: 0.85em; margin-top: 15px;">
                <span style="opacity: 0.8;">💡 提示：点击标签快速搜索，或在上方输入框自定义搜索</span>
            </div>

            <!-- 搜索结果显示区域 -->
            <div id="searchResults" style="display: none; margin-top: 25px; max-height: 400px; overflow-y: auto; background: #f8f9fa; border-radius: 15px; padding: 20px;"></div>
        </div>

        <!-- 症状自测对照库 -->
        <div class="symptom-guide-section" style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">🩺 症状自测对照库</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 35px;">根据GAGS评分标准，帮助您快速判断痤疮严重程度</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                <!-- 轻度痤疮 -->
                <div class="symptom-card" onclick="showSymptomDetail('mild')" style="background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 20px rgba(86,171,47,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">😊</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">轻度痤疮</h4>
                    <p style="font-size: 0.9em; opacity: 0.95; line-height: 1.6;">粉刺、少量丘疹</p>
                    <div style="margin-top: 15px; font-size: 0.85em; opacity: 0.9;">
                        <div>• 闭口粉刺 &lt; 20个</div>
                        <div>• 炎性丘疹 &lt; 10个</div>
                        <div>• 无结节或囊肿</div>
                    </div>
                    <button style="margin-top: 15px; background: rgba(255,255,255,0.3); border: 1px solid white; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">查看详情 →</button>
                </div>

                <!-- 中度痤疮 -->
                <div class="symptom-card" onclick="showSymptomDetail('moderate')" style="background: linear-gradient(135deg, #ffd89b 0%, #f39c12 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 20px rgba(243,156,18,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">😐</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">中度痤疮</h4>
                    <p style="font-size: 0.9em; opacity: 0.95; line-height: 1.6;">较多丘疹、脓疱</p>
                    <div style="margin-top: 15px; font-size: 0.85em; opacity: 0.9;">
                        <div>• 粉刺 20-50个</div>
                        <div>• 丘疹/脓疱 10-40个</div>
                        <div>• 少量结节 &lt; 5个</div>
                    </div>
                    <button style="margin-top: 15px; background: rgba(255,255,255,0.3); border: 1px solid white; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">查看详情 →</button>
                </div>

                <!-- 重度痤疮 -->
                <div class="symptom-card" onclick="showSymptomDetail('severe')" style="background: linear-gradient(135deg, #ff9a9e 0%, #e74c3c 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 20px rgba(231,76,60,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">😟</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">重度痤疮</h4>
                    <p style="font-size: 0.9em; opacity: 0.95; line-height: 1.6;">大量结节、囊肿</p>
                    <div style="margin-top: 15px; font-size: 0.85em; opacity: 0.9;">
                        <div>• 粉刺 &gt; 50个</div>
                        <div>• 丘疹/脓疱 &gt; 40个</div>
                        <div>• 结节/囊肿 &gt; 5个</div>
                    </div>
                    <button style="margin-top: 15px; background: rgba(255,255,255,0.3); border: 1px solid white; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">查看详情 →</button>
                </div>

                <!-- 极重度痤疮 -->
                <div class="symptom-card" onclick="showSymptomDetail('very-severe')" style="background: linear-gradient(135deg, #a18cd1 0%, #8e44ad 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 20px rgba(142,68,173,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">😰</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">极重度痤疮</h4>
                    <p style="font-size: 0.9em; opacity: 0.95; line-height: 1.6;">聚合性、暴发性</p>
                    <div style="margin-top: 15px; font-size: 0.85em; opacity: 0.9;">
                        <div>• 大量结节囊肿</div>
                        <div>• 多处融合瘢痕</div>
                        <div>• 疼痛、炎症严重</div>
                    </div>
                    <button style="margin-top: 15px; background: rgba(255,255,255,0.3); border: 1px solid white; color: white; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold;">查看详情 →</button>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 12px; border-left: 4px solid #ffc107;">
                <div style="font-weight: bold; color: #856404; margin-bottom: 8px;">💡 温馨提示</div>
                <div style="color: #856404; line-height: 1.6; font-size: 0.95em;">
                    以上分级仅供参考。准确诊断需要专业医生评估，建议您预约专业皮肤科医生进行详细检查。
                </div>
            </div>
        </div>

        <!-- 智能治疗方案推荐系统 -->
        <div class="smart-recommendation-section" style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">🎯 智能治疗方案推荐系统</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 35px;">基于GAGS评分，为您量身定制最适合的治疗方案</p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                <!-- 左侧：GAGS自测表单 -->
                <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                    <h4 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.3em; border-bottom: 2px solid #667eea; padding-bottom: 10px;">📋 GAGS自测评分</h4>

                    <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px; border-left: 4px solid #2196f3;">
                        <div style="font-weight: bold; color: #1976d2; margin-bottom: 8px;">评分标准：</div>
                        <div style="font-size: 0.9em; color: #424242; line-height: 1.6;">
                            <div>0分 = 无病灶</div>
                            <div>1分 = 仅粉刺（≥1个）</div>
                            <div>2分 = 丘疹（≥1个）</div>
                            <div>3分 = 脓疱（≥1个）</div>
                            <div>4分 = 结节/囊肿（≥1个）</div>
                        </div>
                    </div>

                    <!-- 6个分区评分 -->
                    <div id="gagsScoreForm">
                        <!-- 额头 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px;">额头（×2倍权重）</label>
                            <select id="forehead" onchange="calculateGAGS()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                                <option value="0">0分 - 无病灶</option>
                                <option value="1">1分 - 仅粉刺</option>
                                <option value="2">2分 - 丘疹</option>
                                <option value="3">3分 - 脓疱</option>
                                <option value="4">4分 - 结节/囊肿</option>
                            </select>
                        </div>

                        <!-- 右脸颊 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px;">右脸颊（×2倍权重）</label>
                            <select id="rightCheek" onchange="calculateGAGS()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                                <option value="0">0分 - 无病灶</option>
                                <option value="1">1分 - 仅粉刺</option>
                                <option value="2">2分 - 丘疹</option>
                                <option value="3">3分 - 脓疱</option>
                                <option value="4">4分 - 结节/囊肿</option>
                            </select>
                        </div>

                        <!-- 左脸颊 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px;">左脸颊（×2倍权重）</label>
                            <select id="leftCheek" onchange="calculateGAGS()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                                <option value="0">0分 - 无病灶</option>
                                <option value="1">1分 - 仅粉刺</option>
                                <option value="2">2分 - 丘疹</option>
                                <option value="3">3分 - 脓疱</option>
                                <option value="4">4分 - 结节/囊肿</option>
                            </select>
                        </div>

                        <!-- 鼻部 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px;">鼻部（×1倍权重）</label>
                            <select id="nose" onchange="calculateGAGS()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                                <option value="0">0分 - 无病灶</option>
                                <option value="1">1分 - 仅粉刺</option>
                                <option value="2">2分 - 丘疹</option>
                                <option value="3">3分 - 脓疱</option>
                                <option value="4">4分 - 结节/囊肿</option>
                            </select>
                        </div>

                        <!-- 下巴 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px;">下巴（×1倍权重）</label>
                            <select id="chin" onchange="calculateGAGS()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                                <option value="0">0分 - 无病灶</option>
                                <option value="1">1分 - 仅粉刺</option>
                                <option value="2">2分 - 丘疹</option>
                                <option value="3">3分 - 脓疱</option>
                                <option value="4">4分 - 结节/囊肿</option>
                            </select>
                        </div>

                        <!-- 胸背部 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 8px;">胸背部（×3倍权重）</label>
                            <select id="chest" onchange="calculateGAGS()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                                <option value="0">0分 - 无病灶</option>
                                <option value="1">1分 - 仅粉刺</option>
                                <option value="2">2分 - 丘疹</option>
                                <option value="3">3分 - 脓疱</option>
                                <option value="4">4分 - 结节/囊肿</option>
                            </select>
                        </div>
                    </div>

                    <!-- GAGS总分显示 -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; text-align: center;">
                        <div style="color: white; font-size: 0.9em; margin-bottom: 8px; opacity: 0.9;">GAGS总分</div>
                        <div id="gagsTotal" style="color: white; font-size: 3em; font-weight: bold;">0</div>
                        <div id="gagsSeverity" style="color: white; font-size: 1.1em; margin-top: 8px; opacity: 0.95;">暂无评估</div>
                    </div>
                </div>

                <!-- 右侧：推荐结果 -->
                <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                    <h4 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.3em; border-bottom: 2px solid #00b894; padding-bottom: 10px;">💡 推荐治疗方案</h4>

                    <div id="recommendationResults" style="min-height: 400px;">
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 400px; color: #95a5a6;">
                            <div style="font-size: 4em; margin-bottom: 15px;">📊</div>
                            <div style="font-size: 1.1em; text-align: center; line-height: 1.6;">
                                请在左侧完成GAGS自测评分<br>系统将自动为您推荐最适合的治疗方案
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 响应式样式 -->
            <style>
                @media (max-width: 768px) {
                    .smart-recommendation-section > div:first-of-type {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>
        </div>

        <!-- 互动式治疗决策树 -->
        <div class="decision-tree-section" style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">🌳 智能治疗决策助手</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 35px;">回答几个简单问题，为您定制最适合的治疗方案</p>

            <!-- 决策树容器 -->
            <div id="decisionTreeContainer" style="max-width: 800px; margin: 0 auto;">
                <!-- 开始页面 -->
                <div id="dtStart" class="dt-screen">
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 5em; margin-bottom: 20px;">🎯</div>
                        <h4 style="color: #2c3e50; font-size: 1.5em; margin-bottom: 15px;">开始个性化方案定制</h4>
                        <p style="color: #7f8c8d; line-height: 1.8; margin-bottom: 30px;">
                            通过回答6个简单问题，我们将根据您的实际情况、预算和需求，<br>
                            为您推荐最适合的痤疮治疗方案。
                        </p>
                        <button onclick="startDecisionTree()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; border-radius: 25px; font-size: 1.1em; cursor: pointer; font-weight: bold; box-shadow: 0 5px 20px rgba(102,126,234,0.3); transition: all 0.3s;">
                            开始问答 →
                        </button>
                    </div>
                </div>

                <!-- 问题页面 -->
                <div id="dtQuestions" class="dt-screen" style="display: none;">
                    <!-- 进度条 -->
                    <div style="margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-size: 0.9em; color: #7f8c8d;">问题进度</span>
                            <span id="dtProgress" style="font-size: 0.9em; color: #667eea; font-weight: bold;">1/6</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="dtProgressBar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; width: 16.67%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <!-- 问题内容 -->
                    <div id="dtQuestionContent" style="min-height: 350px;">
                        <!-- 问题将通过JavaScript动态生成 -->
                    </div>

                    <!-- 导航按钮 -->
                    <div style="display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                        <button id="dtPrevBtn" onclick="previousQuestion()" style="background: #f0f0f0; color: #666; border: none; padding: 12px 30px; border-radius: 20px; font-size: 1em; cursor: pointer; font-weight: bold; display: none;">
                            ← 上一题
                        </button>
                        <button id="dtNextBtn" onclick="nextQuestion()" disabled style="background: #ccc; color: white; border: none; padding: 12px 30px; border-radius: 20px; font-size: 1em; cursor: not-allowed; font-weight: bold; margin-left: auto;">
                            下一题 →
                        </button>
                    </div>
                </div>

                <!-- 结果页面 -->
                <div id="dtResults" class="dt-screen" style="display: none;">
                    <!-- 结果将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 前后对比案例展示系统 -->
        <div class="before-after-cases-section" style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">📸 真实案例对比</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 35px;">看看其他患者的治疗效果，为您的治疗之路增添信心</p>

            <!-- 筛选器 -->
            <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;">
                <button class="case-filter-btn active" data-filter="all" onclick="filterCases('all')" style="padding: 10px 20px; border: 2px solid #667eea; background: #667eea; color: white; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                    全部案例
                </button>
                <button class="case-filter-btn" data-filter="mild" onclick="filterCases('mild')" style="padding: 10px 20px; border: 2px solid #56ab2f; background: white; color: #56ab2f; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                    轻度痤疮
                </button>
                <button class="case-filter-btn" data-filter="moderate" onclick="filterCases('moderate')" style="padding: 10px 20px; border: 2px solid #f39c12; background: white; color: #f39c12; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                    中度痤疮
                </button>
                <button class="case-filter-btn" data-filter="severe" onclick="filterCases('severe')" style="padding: 10px 20px; border: 2px solid #e74c3c; background: white; color: #e74c3c; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                    重度痤疮
                </button>
                <button class="case-filter-btn" data-filter="scar" onclick="filterCases('scar')" style="padding: 10px 20px; border: 2px solid #9b59b6; background: white; color: #9b59b6; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                    痘坑修复
                </button>
            </div>

            <!-- 案例卡片网格 -->
            <div id="casesGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px;">
                <!-- 案例将通过JavaScript动态生成 -->
            </div>

            <style>
                .case-filter-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
                }
                .case-filter-btn.active {
                    background: #667eea !important;
                    color: white !important;
                }
                .case-card {
                    background: white;
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                    transition: all 0.3s;
                    cursor: pointer;
                }
                .case-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
                }
                .before-after-container {
                    position: relative;
                    width: 100%;
                    padding-top: 75%;
                    background: #f8f9fa;
                    overflow: hidden;
                }
                .before-after-images {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: flex;
                }
                .before-image, .after-image {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 3em;
                    position: relative;
                }
                .before-image {
                    background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
                }
                .after-image {
                    background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%);
                }
                .image-label {
                    position: absolute;
                    top: 10px;
                    left: 10px;
                    background: rgba(0,0,0,0.6);
                    color: white;
                    padding: 5px 12px;
                    border-radius: 15px;
                    font-size: 0.3em;
                    font-weight: bold;
                }
                @media (max-width: 768px) {
                    #casesGrid {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>
        </div>

        <!-- 治疗时间线规划器 -->
        <div class="timeline-planner-section" style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">📅 治疗时间线规划器</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 35px;">智能规划您的疗程安排，合理分配治疗时间和间隔</p>

            <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px; max-width: 1200px; margin: 0 auto;">
                <!-- 左侧：配置面板 -->
                <div class="timeline-config" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 30px; border-radius: 15px;">
                    <h4 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.2em;">⚙️ 规划设置</h4>

                    <!-- 选择治疗项目 -->
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; color: #34495e; font-weight: 600; margin-bottom: 10px;">选择治疗项目：</label>
                        <select id="timelineTreatmentSelect" onchange="updateTimelinePreview()" style="width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 10px; font-size: 1em; background: white; cursor: pointer;">
                            <option value="">-- 请选择项目 --</option>
                        </select>
                    </div>

                    <!-- 开始日期 -->
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; color: #34495e; font-weight: 600; margin-bottom: 10px;">计划开始日期：</label>
                        <input type="date" id="timelineStartDate" onchange="updateTimelinePreview()" style="width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 10px; font-size: 1em;">
                    </div>

                    <!-- 疗程次数 -->
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; color: #34495e; font-weight: 600; margin-bottom: 10px;">计划疗程次数：</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="timelineSessionCount" min="1" max="12" value="3" oninput="document.getElementById('sessionCountDisplay').textContent = this.value; updateTimelinePreview();" style="flex: 1;">
                            <span id="sessionCountDisplay" style="font-size: 1.5em; font-weight: bold; color: #667eea; min-width: 40px; text-align: center;">3</span>
                            <span style="color: #7f8c8d;">次</span>
                        </div>
                    </div>

                    <!-- 治疗间隔 -->
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; color: #34495e; font-weight: 600; margin-bottom: 10px;">治疗间隔（天）：</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="timelineInterval" min="7" max="60" value="21" step="7" oninput="document.getElementById('intervalDisplay').textContent = this.value; updateTimelinePreview();" style="flex: 1;">
                            <span id="intervalDisplay" style="font-size: 1.5em; font-weight: bold; color: #667eea; min-width: 40px; text-align: center;">21</span>
                            <span style="color: #7f8c8d;">天</span>
                        </div>
                    </div>

                    <!-- 项目信息卡片 -->
                    <div id="selectedTreatmentInfo" style="display: none; margin-top: 25px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid #667eea;">
                        <h5 style="color: #2c3e50; margin: 0 0 12px 0;">项目信息</h5>
                        <div id="treatmentInfoContent"></div>
                    </div>

                    <!-- 重置按钮 -->
                    <button onclick="resetTimeline()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 1em; font-weight: bold; cursor: pointer; margin-top: 20px; transition: all 0.3s;">
                        🔄 重置规划
                    </button>
                </div>

                <!-- 右侧：时间线预览 -->
                <div class="timeline-preview" style="background: #ffffff; padding: 30px; border-radius: 15px; border: 2px solid #ecf0f1;">
                    <h4 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.2em;">📊 疗程时间线</h4>

                    <!-- 空状态提示 -->
                    <div id="timelineEmptyState" style="text-align: center; padding: 60px 20px; color: #95a5a6;">
                        <div style="font-size: 4em; margin-bottom: 15px;">📅</div>
                        <p style="font-size: 1.1em; margin: 0;">请选择治疗项目和开始日期</p>
                        <p style="font-size: 0.9em; margin-top: 8px; opacity: 0.7;">系统将自动为您生成疗程时间表</p>
                    </div>

                    <!-- 时间线内容 -->
                    <div id="timelineContent" style="display: none;">
                        <!-- 疗程概览 -->
                        <div id="timelineOverview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                                <div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">总疗程时长</div>
                                    <div id="totalDuration" style="font-size: 1.8em; font-weight: bold; margin-top: 5px;">--</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">治疗次数</div>
                                    <div id="totalSessions" style="font-size: 1.8em; font-weight: bold; margin-top: 5px;">--</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">预计结束</div>
                                    <div id="endDate" style="font-size: 1.1em; font-weight: bold; margin-top: 5px;">--</div>
                                </div>
                            </div>
                        </div>

                        <!-- 时间线列表 -->
                        <div id="timelineList" style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
                            <!-- 时间线项将通过JavaScript动态生成 -->
                        </div>

                        <!-- 提示说明 -->
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
                            <p style="margin: 0; color: #856404; font-size: 0.9em;">
                                <strong>💡 温馨提示：</strong>实际治疗计划需根据个人皮肤状况和医生建议进行调整，此规划仅供参考。
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                .timeline-config select:hover,
                .timeline-config input[type="date"]:hover {
                    border-color: #667eea;
                }
                .timeline-config button:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 5px 20px rgba(102,126,234,0.4);
                }
                .timeline-item {
                    position: relative;
                    padding: 20px;
                    background: #f8f9fa;
                    border-radius: 12px;
                    margin-bottom: 15px;
                    border-left: 4px solid #667eea;
                    transition: all 0.3s;
                }
                .timeline-item:hover {
                    transform: translateX(5px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }
                .timeline-item.recovery {
                    border-left-color: #3498db;
                    background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
                }
                .timeline-item-number {
                    position: absolute;
                    left: -15px;
                    top: 15px;
                    width: 30px;
                    height: 30px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    font-size: 0.9em;
                    box-shadow: 0 3px 10px rgba(102,126,234,0.4);
                }
                @media (max-width: 768px) {
                    .timeline-planner-section > div {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>
        </div>

        <!-- 常见问题FAQ系统 -->
        <div class="faq-section" style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">❓ 常见问题解答</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 35px;">快速找到您关心的问题答案</p>

            <!-- 搜索和分类筛选 -->
            <div style="max-width: 900px; margin: 0 auto 30px;">
                <!-- 搜索框 -->
                <div style="position: relative; margin-bottom: 20px;">
                    <input type="text" id="faqSearch" placeholder="🔍 搜索问题关键词..." onkeyup="searchFAQ()" style="width: 100%; padding: 15px 50px 15px 20px; border: 2px solid #e0e0e0; border-radius: 25px; font-size: 1em; transition: all 0.3s;">
                    <button onclick="document.getElementById('faqSearch').value=''; searchFAQ();" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 1.2em; cursor: pointer; color: #999;">✕</button>
                </div>

                <!-- 分类标签 -->
                <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                    <button class="faq-category-btn active" data-category="all" onclick="filterFAQCategory('all')" style="padding: 8px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                        全部问题
                    </button>
                    <button class="faq-category-btn" data-category="treatment" onclick="filterFAQCategory('treatment')" style="padding: 8px 20px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                        治疗相关
                    </button>
                    <button class="faq-category-btn" data-category="price" onclick="filterFAQCategory('price')" style="padding: 8px 20px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                        价格费用
                    </button>
                    <button class="faq-category-btn" data-category="effect" onclick="filterFAQCategory('effect')" style="padding: 8px 20px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                        效果周期
                    </button>
                    <button class="faq-category-btn" data-category="safety" onclick="filterFAQCategory('safety')" style="padding: 8px 20px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                        安全副作用
                    </button>
                    <button class="faq-category-btn" data-category="care" onclick="filterFAQCategory('care')" style="padding: 8px 20px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s;">
                        护理建议
                    </button>
                </div>
            </div>

            <!-- FAQ列表 -->
            <div id="faqList" style="max-width: 900px; margin: 0 auto;">
                <!-- FAQ项将通过JavaScript动态生成 -->
            </div>

            <!-- 无结果提示 -->
            <div id="faqNoResults" style="display: none; text-align: center; padding: 60px 20px; color: #95a5a6;">
                <div style="font-size: 4em; margin-bottom: 15px;">🔍</div>
                <p style="font-size: 1.1em; margin: 0;">没有找到相关问题</p>
                <p style="font-size: 0.9em; margin-top: 8px; opacity: 0.7;">尝试使用其他关键词或浏览全部问题</p>
            </div>

            <style>
                #faqSearch:focus {
                    outline: none;
                    border-color: #667eea;
                    box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
                }
                .faq-category-btn.active {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                    color: white !important;
                    border-color: transparent !important;
                }
                .faq-category-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 15px rgba(102,126,234,0.3);
                }
                .faq-item {
                    background: #f8f9fa;
                    border-radius: 12px;
                    margin-bottom: 15px;
                    overflow: hidden;
                    border-left: 4px solid #667eea;
                    transition: all 0.3s;
                }
                .faq-item:hover {
                    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                    transform: translateX(5px);
                }
                .faq-question {
                    padding: 20px;
                    cursor: pointer;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    background: white;
                    transition: background 0.3s;
                }
                .faq-question:hover {
                    background: #f8f9fa;
                }
                .faq-question-text {
                    font-size: 1.05em;
                    font-weight: 600;
                    color: #2c3e50;
                    flex: 1;
                    padding-right: 20px;
                }
                .faq-icon {
                    font-size: 1.5em;
                    color: #667eea;
                    transition: transform 0.3s;
                }
                .faq-item.active .faq-icon {
                    transform: rotate(180deg);
                }
                .faq-answer {
                    max-height: 0;
                    overflow: hidden;
                    transition: max-height 0.3s ease-out, padding 0.3s ease-out;
                    background: white;
                }
                .faq-item.active .faq-answer {
                    max-height: 1000px;
                    padding: 0 20px 20px 20px;
                }
                .faq-answer-content {
                    color: #555;
                    line-height: 1.8;
                    font-size: 0.95em;
                }
                .faq-answer-content strong {
                    color: #667eea;
                    font-weight: 600;
                }
                .faq-category-tag {
                    display: inline-block;
                    padding: 4px 12px;
                    background: rgba(102,126,234,0.1);
                    color: #667eea;
                    border-radius: 12px;
                    font-size: 0.85em;
                    font-weight: 600;
                    margin-right: 10px;
                }
                @media (max-width: 768px) {
                    .faq-section {
                        padding: 25px 15px !important;
                    }
                    .faq-category-btn {
                        font-size: 0.9em !important;
                        padding: 6px 15px !important;
                    }
                }
            </style>
        </div>

        <!-- 痤疮常见误区专题 -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 2em; margin-bottom: 10px;">⚠️ 痤疮治疗常见误区</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 40px;">科学辟谣，避免踩坑，正确治疗痤疮</p>

            <!-- 误区卡片网格 -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px;">

                <!-- 误区1：挤痘痘能快速消除 -->
                <div style="border: 2px solid #e74c3c; border-radius: 15px; padding: 25px; background: linear-gradient(135deg, #fff5f5 0%, #fff 100%); box-shadow: 0 4px 15px rgba(231,76,60,0.1); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(231,76,60,0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(231,76,60,0.1)';">
                    <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2.5em;">❌</div>
                        <div style="flex: 1;">
                            <h4 style="color: #e74c3c; margin: 0 0 10px 0; font-size: 1.2em;">误区：用手挤痘痘能快速消除</h4>
                            <p style="color: #555; margin: 0; line-height: 1.6;">很多人认为把痘痘挤出来就能快速痊愈，甚至觉得"挤得越干净越好"。</p>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5em;">✅</span>
                            <strong style="color: #27ae60;">正确做法：</strong>
                        </div>
                        <p style="color: #555; margin: 0; line-height: 1.6;">不要用手挤压痘痘。如需清洁粉刺，应到正规医疗机构由专业医师使用无菌器械操作。</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">⚠️ 危害说明：</strong>
                        <p style="color: #856404; margin: 10px 0 0 0; line-height: 1.6;">手部细菌+不当挤压 = 感染扩散、炎症加重、永久性痘坑痘印。严重可能引发颅内感染！</p>
                    </div>
                </div>

                <!-- 误区2：牙膏能治痘痘 -->
                <div style="border: 2px solid #e74c3c; border-radius: 15px; padding: 25px; background: linear-gradient(135deg, #fff5f5 0%, #fff 100%); box-shadow: 0 4px 15px rgba(231,76,60,0.1); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(231,76,60,0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(231,76,60,0.1)';">
                    <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2.5em;">❌</div>
                        <div style="flex: 1;">
                            <h4 style="color: #e74c3c; margin: 0 0 10px 0; font-size: 1.2em;">误区：涂牙膏、芦荟胶能治痘痘</h4>
                            <p style="color: #555; margin: 0; line-height: 1.6;">网传各种"祛痘神器"：牙膏、芦荟胶、大蒜、白醋等，号称纯天然无副作用。</p>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5em;">✅</span>
                            <strong style="color: #27ae60;">正确做法：</strong>
                        </div>
                        <p style="color: #555; margin: 0; line-height: 1.6;">使用医学认证的祛痘产品（如过氧化苯甲酰、水杨酸等），或到医院就诊使用处方药物。</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">⚠️ 危害说明：</strong>
                        <p style="color: #856404; margin: 10px 0 0 0; line-height: 1.6;">这些偏方非但无效，还可能导致接触性皮炎、刺激性皮炎，使痘痘恶化，甚至烧伤皮肤！</p>
                    </div>
                </div>

                <!-- 误区3：痘痘会自己好 -->
                <div style="border: 2px solid #e74c3c; border-radius: 15px; padding: 25px; background: linear-gradient(135deg, #fff5f5 0%, #fff 100%); box-shadow: 0 4px 15px rgba(231,76,60,0.1); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(231,76,60,0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(231,76,60,0.1)';">
                    <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2.5em;">❌</div>
                        <div style="flex: 1;">
                            <h4 style="color: #e74c3c; margin: 0 0 10px 0; font-size: 1.2em;">误区：痘痘过了青春期自然会好</h4>
                            <p style="color: #555; margin: 0; line-height: 1.6;">认为痤疮是青春期正常现象，不需要治疗，等成年后会自动消失。</p>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5em;">✅</span>
                            <strong style="color: #27ae60;">正确做法：</strong>
                        </div>
                        <p style="color: #555; margin: 0; line-height: 1.6;">及时就医治疗，轻度痤疮3个月内未好转应就诊，中重度痤疮应立即就医，避免留疤。</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">⚠️ 危害说明：</strong>
                        <p style="color: #856404; margin: 10px 0 0 0; line-height: 1.6;">延误治疗会导致炎症加重、色素沉着、永久性痘坑。30%以上成年人仍有痤疮困扰！</p>
                    </div>
                </div>

                <!-- 误区4：频繁洗脸能控油祛痘 -->
                <div style="border: 2px solid #e74c3c; border-radius: 15px; padding: 25px; background: linear-gradient(135deg, #fff5f5 0%, #fff 100%); box-shadow: 0 4px 15px rgba(231,76,60,0.1); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(231,76,60,0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(231,76,60,0.1)';">
                    <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2.5em;">❌</div>
                        <div style="flex: 1;">
                            <h4 style="color: #e74c3c; margin: 0 0 10px 0; font-size: 1.2em;">误区：一天洗脸5-6次能控油祛痘</h4>
                            <p style="color: #555; margin: 0; line-height: 1.6;">觉得脸上油腻就是痘痘元凶，于是频繁洗脸、使用强力去油产品。</p>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5em;">✅</span>
                            <strong style="color: #27ae60;">正确做法：</strong>
                        </div>
                        <p style="color: #555; margin: 0; line-height: 1.6;">每天早晚各洗一次脸，使用温和洁面产品。避免过度清洁破坏皮肤屏障。</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">⚠️ 危害说明：</strong>
                        <p style="color: #856404; margin: 10px 0 0 0; line-height: 1.6;">过度清洁破坏皮脂膜，导致皮肤更油、更敏感，形成"越洗越油"的恶性循环！</p>
                    </div>
                </div>

                <!-- 误区5：不能化妆和防晒 -->
                <div style="border: 2px solid #e74c3c; border-radius: 15px; padding: 25px; background: linear-gradient(135deg, #fff5f5 0%, #fff 100%); box-shadow: 0 4px 15px rgba(231,76,60,0.1); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(231,76,60,0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(231,76,60,0.1)';">
                    <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2.5em;">❌</div>
                        <div style="flex: 1;">
                            <h4 style="color: #e74c3c; margin: 0 0 10px 0; font-size: 1.2em;">误区：长痘期间不能化妆、不能防晒</h4>
                            <p style="color: #555; margin: 0; line-height: 1.6;">认为化妆品和防晒霜会堵塞毛孔，加重痘痘，所以完全不用。</p>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5em;">✅</span>
                            <strong style="color: #27ae60;">正确做法：</strong>
                        </div>
                        <p style="color: #555; margin: 0; line-height: 1.6;">选择标注"非致痘配方"的产品。防晒必须做，可选择物理防晒+轻薄防晒霜。淡妆可以接受。</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">⚠️ 危害说明：</strong>
                        <p style="color: #856404; margin: 10px 0 0 0; line-height: 1.6;">不防晒会导致炎症后色素沉着加重，痘印更难消！紫外线是痤疮恶化的重要因素。</p>
                    </div>
                </div>

                <!-- 误区6：只用药膏不用护肤品 -->
                <div style="border: 2px solid #e74c3c; border-radius: 15px; padding: 25px; background: linear-gradient(135deg, #fff5f5 0%, #fff 100%); box-shadow: 0 4px 15px rgba(231,76,60,0.1); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(231,76,60,0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(231,76,60,0.1)';">
                    <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 2.5em;">❌</div>
                        <div style="flex: 1;">
                            <h4 style="color: #e74c3c; margin: 0 0 10px 0; font-size: 1.2em;">误区：治疗期只用祛痘药，不用护肤品</h4>
                            <p style="color: #555; margin: 0; line-height: 1.6;">认为护肤品会影响药效，所以只涂药膏，皮肤干燥脱皮也不管。</p>
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5em;">✅</span>
                            <strong style="color: #27ae60;">正确做法：</strong>
                        </div>
                        <p style="color: #555; margin: 0; line-height: 1.6;">治疗期间配合使用温和保湿产品，先护肤后用药。维持皮肤屏障完整才能更好吸收药物。</p>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">⚠️ 危害说明：</strong>
                        <p style="color: #856404; margin: 10px 0 0 0; line-height: 1.6;">祛痘药物多有刺激性，不保湿会导致皮肤屏障受损、敏感、脱皮，反而影响治疗效果！</p>
                    </div>
                </div>

            </div>

            <!-- 科学治疗建议 -->
            <div style="margin-top: 40px; padding: 25px; background: linear-gradient(135deg, #d4f1f4 0%, #d4edfc 100%); border-radius: 15px; border-left: 5px solid #3498db;">
                <h4 style="color: #2c3e50; margin: 0 0 20px 0; font-size: 1.3em;">💡 科学治疗痤疮的正确步骤</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div>
                        <strong style="color: #3498db;">1️⃣ 及时就医</strong>
                        <p style="color: #555; margin: 5px 0 0 0;">出现中度以上痤疮立即就诊</p>
                    </div>
                    <div>
                        <strong style="color: #3498db;">2️⃣ 规范治疗</strong>
                        <p style="color: #555; margin: 5px 0 0 0;">遵医嘱用药，不自行停药换药</p>
                    </div>
                    <div>
                        <strong style="color: #3498db;">3️⃣ 温和护肤</strong>
                        <p style="color: #555; margin: 5px 0 0 0;">做好清洁、保湿、防晒三步骤</p>
                    </div>
                    <div>
                        <strong style="color: #3498db;">4️⃣ 健康生活</strong>
                        <p style="color: #555; margin: 5px 0 0 0;">规律作息、均衡饮食、避免熬夜</p>
                    </div>
                </div>
            </div>

            <!-- 咨询提示 -->
            <div style="margin-top: 25px; text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <p style="color: #555; margin: 0 0 15px 0; font-size: 1.1em;">
                    ⚕️ <strong>专业提醒：</strong>每个人的痤疮类型和严重程度不同，治疗方案因人而异。
                </p>
                <button onclick="scrollToAppointment()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102,126,234,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102,126,234,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102,126,234,0.3)';">
                    立即咨询专业医生 →
                </button>
            </div>
        </div>

        <!-- 个性化治疗方案生成器 -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 50px 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(102,126,234,0.3); color: white;">
            <div style="text-align: center; margin-bottom: 40px;">
                <h3 style="font-size: 2em; margin-bottom: 10px;">📋 生成我的治疗方案</h3>
                <p style="opacity: 0.95; font-size: 1.05em;">综合您的评估数据，生成专属PDF治疗方案报告</p>
            </div>

            <div style="background: rgba(255,255,255,0.15); border-radius: 15px; padding: 30px; backdrop-filter: blur(10px); margin-bottom: 30px;">
                <h4 style="margin: 0 0 20px 0; font-size: 1.3em;">📊 方案将包含以下内容：</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em;">✅</div>
                        <div>
                            <strong>GAGS评分结果</strong>
                            <p style="margin: 3px 0 0 0; opacity: 0.9; font-size: 0.9em;">痤疮严重程度评估</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em;">💊</div>
                        <div>
                            <strong>推荐治疗方案</strong>
                            <p style="margin: 3px 0 0 0; opacity: 0.9; font-size: 0.9em;">个性化治疗项目清单</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em;">📅</div>
                        <div>
                            <strong>治疗时间规划</strong>
                            <p style="margin: 3px 0 0 0; opacity: 0.9; font-size: 0.9em;">疗程次数与时间安排</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em;">💰</div>
                        <div>
                            <strong>预估费用范围</strong>
                            <p style="margin: 3px 0 0 0; opacity: 0.9; font-size: 0.9em;">治疗总费用预算参考</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em;">🌱</div>
                        <div>
                            <strong>护理注意事项</strong>
                            <p style="margin: 3px 0 0 0; opacity: 0.9; font-size: 0.9em;">术前准备与术后护理</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.3em;">⚕️</div>
                        <div>
                            <strong>专家建议</strong>
                            <p style="margin: 3px 0 0 0; opacity: 0.9; font-size: 0.9em;">医生专业指导意见</p>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align: center;">
                <button onclick="generatePDFReport()" style="background: white; color: #667eea; border: none; padding: 18px 50px; border-radius: 30px; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 8px 25px rgba(0,0,0,0.2);" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 12px 35px rgba(0,0,0,0.3)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.2)';">
                    📥 立即生成PDF方案报告
                </button>
                <p style="margin-top: 15px; opacity: 0.9; font-size: 0.9em;">
                    💡 提示：报告基于您已填写的GAGS评分、决策树选择等数据生成
                </p>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; border-left: 4px solid rgba(255,255,255,0.5);">
                <p style="margin: 0; font-size: 0.95em; line-height: 1.6;">
                    <strong>📌 温馨提示：</strong>生成的PDF报告仅供参考，具体治疗方案需要面诊后由专业医师根据您的实际情况制定。建议携带此报告到院咨询，以便医生更好地了解您的需求。
                </p>
            </div>
        </div>

        <!-- 预约咨询表单 -->
        <div class="appointment-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 50px 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(102,126,234,0.3); color: white;">
            <h3 style="text-align: center; font-size: 1.8em; margin-bottom: 10px;">📞 在线预约咨询</h3>
            <p style="text-align: center; opacity: 0.9; margin-bottom: 40px;">专业医师团队为您提供个性化治疗方案</p>

            <div style="display: grid; grid-template-columns: 1.2fr 1fr; gap: 40px; max-width: 1200px; margin: 0 auto;">
                <!-- 左侧：预约表单 -->
                <div class="appointment-form" style="background: white; padding: 35px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                    <h4 style="color: #2c3e50; margin-bottom: 25px; font-size: 1.3em;">填写预约信息</h4>

                    <form id="appointmentForm" onsubmit="submitAppointment(event)">
                        <!-- 姓名 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">您的姓名 *</label>
                            <input type="text" id="appointmentName" required style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; transition: all 0.3s;">
                        </div>

                        <!-- 手机号 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">手机号码 *</label>
                            <input type="tel" id="appointmentPhone" required pattern="1[3-9]\d{9}" placeholder="请输入11位手机号" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; transition: all 0.3s;">
                        </div>

                        <!-- 预约项目 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">预约项目 *</label>
                            <select id="appointmentService" required style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; background: white; cursor: pointer; transition: all 0.3s;">
                                <option value="">-- 请选择预约项目 --</option>
                                <option value="面诊评估">面诊评估（免费）</option>
                                <option value="光子嫩肤">光子嫩肤</option>
                                <option value="果酸焕肤">果酸焕肤</option>
                                <option value="水杨酸焕肤">水杨酸焕肤</option>
                                <option value="红蓝光治疗">红蓝光治疗</option>
                                <option value="激光祛痘">激光祛痘</option>
                                <option value="点阵激光">点阵激光（痘坑修复）</option>
                                <option value="光动力治疗">光动力治疗</option>
                                <option value="其他咨询">其他咨询</option>
                            </select>
                        </div>

                        <!-- 预约日期 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">期望日期 *</label>
                            <input type="date" id="appointmentDate" required style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; transition: all 0.3s;">
                        </div>

                        <!-- 期望时间段 -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">期望时间段 *</label>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                <label style="display: flex; align-items: center; padding: 10px; background: #f8f9fa; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="radio" name="appointmentTime" value="上午 (9:00-12:00)" required style="margin-right: 8px;">
                                    <span style="font-size: 0.9em; color: #555;">上午</span>
                                </label>
                                <label style="display: flex; align-items: center; padding: 10px; background: #f8f9fa; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="radio" name="appointmentTime" value="下午 (14:00-17:00)" style="margin-right: 8px;">
                                    <span style="font-size: 0.9em; color: #555;">下午</span>
                                </label>
                                <label style="display: flex; align-items: center; padding: 10px; background: #f8f9fa; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                                    <input type="radio" name="appointmentTime" value="晚上 (18:00-20:00)" style="margin-right: 8px;">
                                    <span style="font-size: 0.9em; color: #555;">晚上</span>
                                </label>
                            </div>
                        </div>

                        <!-- 备注 -->
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">备注说明（选填）</label>
                            <textarea id="appointmentNote" rows="3" placeholder="您可以描述您的皮肤问题、预算范围或其他需求..." style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; resize: vertical; transition: all 0.3s;"></textarea>
                        </div>

                        <!-- 提交按钮 -->
                        <button type="submit" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                            提交预约
                        </button>

                        <!-- 提示 -->
                        <p style="text-align: center; color: #999; font-size: 0.85em; margin-top: 15px;">
                            提交后我们会在24小时内联系您确认预约时间
                        </p>
                    </form>
                </div>

                <!-- 右侧：联系方式 -->
                <div class="contact-info" style="color: white;">
                    <h4 style="margin-bottom: 25px; font-size: 1.3em;">其他联系方式</h4>

                    <!-- 微信咨询 -->
                    <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8em;">
                                💬
                            </div>
                            <div>
                                <h5 style="margin: 0; font-size: 1.1em;">微信咨询</h5>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 0.9em;">即时响应，专业解答</p>
                            </div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                            <p style="color: #667eea; font-weight: bold; font-size: 1.1em; margin: 0 0 10px 0;">微信号: AcneCare2024</p>
                            <button onclick="alert('请打开微信，搜索公众号或微信号：AcneCare2024')" style="padding: 10px 20px; background: #07c160; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                添加微信
                            </button>
                        </div>
                    </div>

                    <!-- 电话咨询 -->
                    <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8em;">
                                📞
                            </div>
                            <div>
                                <h5 style="margin: 0; font-size: 1.1em;">电话预约</h5>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 0.9em;">周一至周日 9:00-20:00</p>
                            </div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                            <p style="color: #667eea; font-weight: bold; font-size: 1.3em; margin: 0;">400-888-6666</p>
                        </div>
                    </div>

                    <!-- 到店咨询 -->
                    <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8em;">
                                📍
                            </div>
                            <div>
                                <h5 style="margin: 0; font-size: 1.1em;">到店咨询</h5>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 0.9em;">欢迎到院面诊</p>
                            </div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <p style="color: #555; margin: 0; line-height: 1.6; font-size: 0.95em;">
                                <strong style="color: #667eea;">联合丽格西南中心</strong><br>
                                成都市锦江区红星路三段1号<br>
                                IFS国际金融中心7楼
                            </p>
                        </div>
                    </div>

                    <!-- 温馨提示 -->
                    <div style="margin-top: 25px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; border-left: 4px solid rgba(255,255,255,0.5);">
                        <p style="margin: 0; opacity: 0.9; line-height: 1.8; font-size: 0.9em;">
                            <strong>💡 温馨提示：</strong><br>
                            • 首次面诊建议提前预约，避免等待<br>
                            • 可携带近期照片和既往病历<br>
                            • 就诊前请勿化妆，便于医生诊断<br>
                            • 建议避开月经期进行治疗
                        </p>
                    </div>
                </div>
            </div>

            <style>
                .appointment-form input:focus,
                .appointment-form select:focus,
                .appointment-form textarea:focus {
                    outline: none;
                    border-color: #667eea;
                    box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
                }
                .appointment-form button[type="submit"]:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(102,126,234,0.4);
                }
                .appointment-form label:has(input[type="radio"]):hover {
                    border-color: #667eea;
                    background: rgba(102,126,234,0.05);
                }
                .appointment-form input[type="radio"]:checked + span {
                    color: #667eea;
                    font-weight: bold;
                }
                .appointment-form label:has(input[type="radio"]:checked) {
                    border-color: #667eea;
                    background: rgba(102,126,234,0.1);
                }
                @media (max-width: 768px) {
                    .appointment-section {
                        padding: 30px 20px !important;
                    }
                    .appointment-section > div {
                        grid-template-columns: 1fr !important;
                    }
                    .contact-info {
                        margin-top: 30px;
                    }
                }
            </style>
        </div>

        <!-- 术后护理指南 -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 2em; margin-bottom: 10px;">🩹 术后护理指南</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 40px;">专业护理建议 | 分项目详解 | 助力最佳疗效</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <!-- 激光类护理 -->
                <div onclick="showCareGuide('laser')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102,126,234,0.3);" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(102,126,234,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102,126,234,0.3)';">
                    <div style="font-size: 2em; margin-bottom: 10px;">✨</div>
                    <h4 style="margin: 0 0 8px 0; font-size: 1.1em;">激光类项目</h4>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">点阵激光、光子嫩肤</p>
                </div>

                <!-- 刷酸类护理 -->
                <div onclick="showCareGuide('acid')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(245,87,108,0.3);" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(245,87,108,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(245,87,108,0.3)';">
                    <div style="font-size: 2em; margin-bottom: 10px;">💧</div>
                    <h4 style="margin: 0 0 8px 0; font-size: 1.1em;">刷酸类项目</h4>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">水杨酸、果酸焕肤</p>
                </div>

                <!-- 微针类护理 -->
                <div onclick="showCareGuide('microneedle')" style="background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(86,171,47,0.3);" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(86,171,47,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(86,171,47,0.3)';">
                    <div style="font-size: 2em; margin-bottom: 10px;">⚡</div>
                    <h4 style="margin: 0 0 8px 0; font-size: 1.1em;">微针类项目</h4>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">黄金微针、射频微针</p>
                </div>

                <!-- 光动力护理 -->
                <div onclick="showCareGuide('photodynamic')" style="background: linear-gradient(135deg, #ffd89b 0%, #f39c12 100%); color: white; padding: 20px; border-radius: 12px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(243,156,18,0.3);" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(243,156,18,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(243,156,18,0.3)';">
                    <div style="font-size: 2em; margin-bottom: 10px;">💡</div>
                    <h4 style="margin: 0 0 8px 0; font-size: 1.1em;">光动力疗法</h4>
                    <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">ALA-PDT光动力</p>
                </div>
            </div>

            <div style="margin-top: 25px; padding: 20px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
                <div style="font-weight: bold; color: #856404; margin-bottom: 8px;">⚠️ 重要提示</div>
                <div style="color: #856404; font-size: 0.9em; line-height: 1.8;">
                    • 术后护理直接影响治疗效果，请严格遵医嘱<br>
                    • 不同项目护理要求不同，请选择对应项目查看<br>
                    • 如出现异常反应，请立即联系医生
                </div>
            </div>
        </div>

        <!-- 术后护理详情弹窗 -->
        <div id="careGuideModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow-y: auto; padding: 20px;">
            <div style="max-width: 900px; margin: 40px auto; background: white; border-radius: 20px; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                <!-- 关闭按钮 -->
                <button onclick="closeCareGuide()" style="position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%; border: none; background: #f0f0f0; cursor: pointer; font-size: 1.5em; color: #666; transition: all 0.3s;" onmouseover="this.style.background='#e74c3c'; this.style.color='white';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">×</button>

                <!-- 内容区域 -->
                <div id="careGuideContent" style="padding: 40px;">
                    <!-- 内容将由JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 医生团队介绍 -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 2em; margin-bottom: 10px;">👨‍⚕️ 专家团队</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 40px;">资深皮肤科医师 | 专业经验丰富 | 个性化诊疗</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                <!-- 医生1：李明 -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 25px; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.08);" onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 15px 35px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.08)';">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 120px; height: 120px; margin: 0 auto 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3em; color: white; box-shadow: 0 8px 20px rgba(102,126,234,0.3);">
                            👩‍⚕️
                        </div>
                        <h4 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 1.3em;">李明医生</h4>
                        <p style="color: #667eea; margin: 0; font-weight: bold;">主任医师 | 皮肤科专家</p>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">📚 专业背景</div>
                        <div style="color: #555; font-size: 0.9em; line-height: 1.8;">
                            • 北京协和医学院皮肤科硕士<br>
                            • 三甲医院皮肤科工作15年<br>
                            • 中国医师协会皮肤科分会会员
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">💡 擅长领域</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">痤疮治疗</span>
                            <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">激光美容</span>
                            <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">光电治疗</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
                        <div style="color: #856404; font-size: 0.85em; line-height: 1.6;">
                            💬 "每位患者都是独特的，需要个性化的治疗方案。"
                        </div>
                    </div>

                    <button onclick="scrollToAppointment()" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px; border-radius: 25px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102,126,234,0.3);" onmouseover="this.style.transform='scale(1.05)';" onmouseout="this.style.transform='scale(1)';">
                        预约李医生 →
                    </button>
                </div>

                <!-- 医生2：张伟 -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 25px; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.08);" onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 15px 35px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.08)';">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 120px; height: 120px; margin: 0 auto 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3em; color: white; box-shadow: 0 8px 20px rgba(245,87,108,0.3);">
                            👨‍⚕️
                        </div>
                        <h4 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 1.3em;">张伟医生</h4>
                        <p style="color: #f5576c; margin: 0; font-weight: bold;">副主任医师 | 美容皮肤科</p>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">📚 专业背景</div>
                        <div style="color: #555; font-size: 0.9em; line-height: 1.8;">
                            • 上海交通大学医学院博士<br>
                            • 皮肤美容临床经验12年<br>
                            • 国际激光医学会认证医师
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">💡 擅长领域</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <span style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">痘坑修复</span>
                            <span style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">微针治疗</span>
                            <span style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">化学焕肤</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: #d1ecf1; border-radius: 10px; border-left: 4px solid #17a2b8;">
                        <div style="color: #0c5460; font-size: 0.85em; line-height: 1.6;">
                            💬 "结合最新技术，为患者提供安全有效的治疗。"
                        </div>
                    </div>

                    <button onclick="scrollToAppointment()" style="width: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; padding: 12px; border-radius: 25px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(245,87,108,0.3);" onmouseover="this.style.transform='scale(1.05)';" onmouseout="this.style.transform='scale(1)';">
                        预约张医生 →
                    </button>
                </div>

                <!-- 医生3：王芳 -->
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 25px; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.08);" onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 15px 35px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.08)';">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 120px; height: 120px; margin: 0 auto 15px; background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3em; color: white; box-shadow: 0 8px 20px rgba(86,171,47,0.3);">
                            👩‍⚕️
                        </div>
                        <h4 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 1.3em;">王芳医生</h4>
                        <p style="color: #56ab2f; margin: 0; font-weight: bold;">主治医师 | 痤疮专科</p>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">📚 专业背景</div>
                        <div style="color: #555; font-size: 0.9em; line-height: 1.8;">
                            • 四川大学华西医学院硕士<br>
                            • 专注痤疮治疗研究8年<br>
                            • 发表SCI论文5篇
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">💡 擅长领域</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <span style="background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">重度痤疮</span>
                            <span style="background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">药物治疗</span>
                            <span style="background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.85em;">光动力</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px; padding: 15px; background: #d4edda; border-radius: 10px; border-left: 4px solid #28a745;">
                        <div style="color: #155724; font-size: 0.85em; line-height: 1.6;">
                            💬 "循证医学+个性化方案=最佳治疗效果。"
                        </div>
                    </div>

                    <button onclick="scrollToAppointment()" style="width: 100%; background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); color: white; border: none; padding: 12px; border-radius: 25px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(86,171,47,0.3);" onmouseover="this.style.transform='scale(1.05)';" onmouseout="this.style.transform='scale(1)';">
                        预约王医生 →
                    </button>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #667eea15 0%, #764ba230 100%); border-radius: 15px; text-align: center;">
                <h4 style="color: #2c3e50; margin: 0 0 15px 0;">为什么选择我们的专家团队？</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div>
                        <div style="font-size: 2em; margin-bottom: 8px;">🎓</div>
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">学历背景深厚</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">名校毕业，专业扎实</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; margin-bottom: 8px;">💼</div>
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">临床经验丰富</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">平均从业10年以上</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; margin-bottom: 8px;">🏆</div>
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">专业资质认证</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">国内外权威认证</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; margin-bottom: 8px;">❤️</div>
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">患者好评如潮</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">满意度98%以上</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 治疗效果跟踪系统 -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 2em; margin-bottom: 10px;">📊 治疗效果跟踪</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">记录治疗过程 | 对比前后变化 | 见证改善历程</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                <div onclick="openTrackingSystem()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 20px rgba(102,126,234,0.3); text-align: center;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(102,126,234,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 20px rgba(102,126,234,0.3)';">
                    <div style="font-size: 3em; margin-bottom: 15px;">📷</div>
                    <h4 style="margin: 0 0 10px 0; font-size: 1.3em;">打开跟踪系统</h4>
                    <p style="margin: 0; opacity: 0.9; font-size: 0.9em;">记录治疗进度，查看效果对比</p>
                </div>

                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-size: 2.5em; color: #667eea;">📈</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #2c3e50; margin-bottom: 5px;" id="trackingRecordCount">0</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">治疗记录</div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="font-size: 2.5em; color: #f5576c;">🎯</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #2c3e50; margin-bottom: 5px;" id="trackingDaysCount">0</div>
                        <div style="color: #7f8c8d; font-size: 0.9em;">治疗天数</div>
                    </div>
                </div>
            </div>

            <div style="padding: 20px; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-radius: 10px; border-left: 4px solid #ffc107;">
                <div style="font-weight: bold; color: #856404; margin-bottom: 8px;">💡 使用提示</div>
                <div style="color: #856404; font-size: 0.9em; line-height: 1.8;">
                    • 建议每周记录一次治疗进展<br>
                    • 保持拍摄角度和光线一致，便于对比<br>
                    • 可添加备注记录治疗项目和感受<br>
                    • 数据保存在本地，保护您的隐私
                </div>
            </div>
        </div>

        <!-- 治疗效果跟踪弹窗 -->
        <div id="trackingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; overflow-y: auto;">
            <div style="max-width: 1000px; margin: 40px auto; background: white; border-radius: 20px; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                <!-- 关闭按钮 -->
                <button onclick="closeTrackingSystem()" style="position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%; border: none; background: #f0f0f0; cursor: pointer; font-size: 1.5em; color: #666; transition: all 0.3s; z-index: 10;" onmouseover="this.style.background='#e74c3c'; this.style.color='white';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">×</button>

                <!-- 头部 -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 40px; border-radius: 20px 20px 0 0;">
                    <h2 style="margin: 0 0 10px 0;">📊 治疗效果跟踪系统</h2>
                    <p style="margin: 0; opacity: 0.9;">记录每一步改变，见证蜕变之路</p>
                </div>

                <!-- 内容区 -->
                <div style="padding: 30px 40px;">
                    <!-- 添加记录按钮 -->
                    <button onclick="showAddRecordForm()" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 25px; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102,126,234,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102,126,234,0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102,126,234,0.3)';">
                        ➕ 添加新记录
                    </button>

                    <!-- 添加记录表单（默认隐藏） -->
                    <div id="addRecordForm" style="display: none; background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                        <h4 style="color: #2c3e50; margin: 0 0 20px 0;">记录治疗进展</h4>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">记录日期</label>
                            <input type="date" id="recordDate" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" />
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">治疗项目（可选）</label>
                            <input type="text" id="recordTreatment" placeholder="例如：果酸焕肤第3次" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;" />
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">痘痘数量评估</label>
                            <select id="recordAcneCount" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                                <option value="0-5">0-5个</option>
                                <option value="6-10">6-10个</option>
                                <option value="11-20">11-20个</option>
                                <option value="20+">20个以上</option>
                            </select>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">严重程度</label>
                            <select id="recordSeverity" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                                <option value="轻度">轻度（粉刺为主）</option>
                                <option value="中度">中度（丘疹脓疱）</option>
                                <option value="重度">重度（结节囊肿）</option>
                            </select>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">备注</label>
                            <textarea id="recordNotes" placeholder="记录今天的感受、副作用、护理情况等..." rows="3" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; resize: vertical;"></textarea>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button onclick="saveTrackingRecord()" style="flex: 1; background: #28a745; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer;">保存记录</button>
                            <button onclick="hideAddRecordForm()" style="background: #6c757d; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer;">取消</button>
                        </div>
                    </div>

                    <!-- 记录列表 -->
                    <div id="trackingRecordsList">
                        <!-- 空状态 -->
                        <div id="trackingEmptyState" style="text-align: center; padding: 60px 20px; color: #95a5a6;">
                            <div style="font-size: 4em; margin-bottom: 15px;">📋</div>
                            <p style="font-size: 1.1em; margin: 0;">还没有治疗记录</p>
                            <p style="margin: 10px 0 0 0;">点击上方"添加新记录"开始记录您的治疗历程</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 痘痘问题分类专题 -->
        <div class="acne-categories-section" style="margin-bottom: 30px;">
            <h3 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 25px;">📚 痘痘问题分类专题</h3>

            <div class="categories-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                <!-- 分类卡片 -->
                <div class="category-card" onclick="showCategoryContent('understanding')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 5px 20px rgba(102,126,234,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">🔬</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">认识痘痘</h4>
                    <p style="font-size: 0.95em; opacity: 0.9; margin-bottom: 15px;">了解痘痘的成因、类型和发展过程</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span class="mini-tag">成因分析</span>
                        <span class="mini-tag">类型分级</span>
                        <span class="mini-tag">发病机制</span>
                    </div>
                </div>

                <div class="category-card" onclick="showCategoryContent('treatment')" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 5px 20px rgba(245,87,108,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">💊</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">治疗方案</h4>
                    <p style="font-size: 0.95em; opacity: 0.9; margin-bottom: 15px;">专业医学治疗和医美项目</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span class="mini-tag">口服药物</span>
                        <span class="mini-tag">激光治疗</span>
                        <span class="mini-tag">刷酸项目</span>
                    </div>
                </div>

                <div class="category-card" onclick="showCategoryContent('daily_care')" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 5px 20px rgba(79,172,254,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">🧴</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">日常护理</h4>
                    <p style="font-size: 0.95em; opacity: 0.9; margin-bottom: 15px;">护肤、化妆、生活方式管理</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span class="mini-tag">护肤方法</span>
                        <span class="mini-tag">化妆技巧</span>
                        <span class="mini-tag">饮食调理</span>
                    </div>
                </div>

                <div class="category-card" onclick="showCategoryContent('psychology')" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 25px; border-radius: 15px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 5px 20px rgba(250,112,154,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">💝</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">心理支持</h4>
                    <p style="font-size: 0.95em; opacity: 0.9; margin-bottom: 15px;">重建自信、心理疏导、社交应对</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span class="mini-tag">自信重建</span>
                        <span class="mini-tag">社交应对</span>
                        <span class="mini-tag">家庭支持</span>
                    </div>
                </div>

                <div class="category-card" onclick="showCategoryContent('scar_repair')" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #2c3e50; padding: 25px; border-radius: 15px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 5px 20px rgba(168,237,234,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">🔧</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">痘坑修复</h4>
                    <p style="font-size: 0.95em; opacity: 0.9; margin-bottom: 15px;">痘印痘坑的专业修复方案</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span class="mini-tag" style="background: rgba(102,126,234,0.2); color: #667eea;">点阵激光</span>
                        <span class="mini-tag" style="background: rgba(102,126,234,0.2); color: #667eea;">小针刀</span>
                        <span class="mini-tag" style="background: rgba(102,126,234,0.2); color: #667eea;">微针治疗</span>
                    </div>
                </div>

                <div class="category-card" onclick="showCategoryContent('special_groups')" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #2c3e50; padding: 25px; border-radius: 15px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 5px 20px rgba(252,182,159,0.3);">
                    <div style="font-size: 2.5em; margin-bottom: 10px;">👥</div>
                    <h4 style="font-size: 1.3em; margin-bottom: 10px;">特殊人群</h4>
                    <p style="font-size: 0.95em; opacity: 0.9; margin-bottom: 15px;">青少年、成年女性专属指南</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span class="mini-tag" style="background: rgba(102,126,234,0.2); color: #667eea;">青少年</span>
                        <span class="mini-tag" style="background: rgba(102,126,234,0.2); color: #667eea;">成年女性</span>
                        <span class="mini-tag" style="background: rgba(102,126,234,0.2); color: #667eea;">职场人士</span>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .tag-btn {
                padding: 8px 18px;
                background: #f0f0f0;
                border: none;
                border-radius: 20px;
                cursor: pointer;
                font-size: 0.9em;
                color: #555;
                transition: all 0.3s;
            }
            .tag-btn:hover {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102,126,234,0.3);
            }
            .mini-tag {
                display: inline-block;
                padding: 4px 10px;
                background: rgba(255,255,255,0.25);
                border-radius: 12px;
                font-size: 0.85em;
            }
            .category-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 15px 40px rgba(0,0,0,0.2) !important;
            }

            /* 症状卡片样式 */
            .symptom-card:hover {
                transform: translateY(-8px) scale(1.02);
                box-shadow: 0 15px 50px rgba(0,0,0,0.25) !important;
            }
            .symptom-card button:hover {
                background: rgba(255,255,255,0.5) !important;
                transform: scale(1.05);
            }

            @media (max-width: 768px) {
                .enhanced-search-section { padding: 20px 15px !important; }
                .quick-search-tags { justify-content: flex-start !important; }
                .categories-grid { grid-template-columns: 1fr !important; gap: 15px !important; }
                .category-card { padding: 20px !important; }
                .search-header h3 { font-size: 1.3em !important; }
            }
        </style>

        <div class="book-info">
            <h3>关于本书</h3>
            <p>这是一本由专业女性皮肤科医生撰写的痘痘管理指南，涵盖医学诊疗、日常护理、心理支持等多个维度。本书以中国现实生活为背景，为受痘痘困扰的读者提供科学、实用、温暖的指导。</p>
        </div>

        <!-- 继续阅读按钮 -->
        <button
            id="continueReadingBtn"
            onclick="continueReading()"
            style="display: none; width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 20px 25px; border-radius: 15px; cursor: pointer; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(102,126,234,0.3); transition: all 0.3s; font-size: 1em; text-align: left;"
            onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 40px rgba(102,126,234,0.4)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(102,126,234,0.3)';">
            <!-- 按钮内容将由JavaScript动态生成 -->
        </button>

        <div class="medical-beauty-section">
            <h3>专业医美指南</h3>
            <div class="medical-beauty-highlights">
                <div class="highlight-card golden-combo" onclick="showGoldenComboPage()">
                    <div class="highlight-icon">
                        <div class="icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L12 6" stroke="var(--icon-color, #2c3e50)" stroke-width="2" stroke-linecap="round"/>
                                <path d="M12 18L12 22" stroke="var(--icon-color, #2c3e50)" stroke-width="2" stroke-linecap="round"/>
                                <circle cx="12" cy="12" r="4" stroke="var(--icon-color, #2c3e50)" stroke-width="2" fill="none"/>
                                <path d="M8 8L10 10" stroke="var(--icon-color, #2c3e50)" stroke-width="2" stroke-linecap="round"/>
                                <path d="M14 14L16 16" stroke="var(--icon-color, #2c3e50)" stroke-width="2" stroke-linecap="round"/>
                                <path d="M16 8L14 10" stroke="var(--icon-color, #2c3e50)" stroke-width="2" stroke-linecap="round"/>
                                <path d="M10 14L8 16" stroke="var(--icon-color, #2c3e50)" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <h4>三件套治疗方案</h4>
                    <p>口服药物 + 微针激光 + 刷酸系统的黄金组合</p>

                    <!-- 快速预览弹窗 -->
                    <div class="quick-preview">
                        <div class="preview-header">
                            <h5>黄金三件套详情</h5>
                            <p>专业医美联合治疗方案</p>
                        </div>

                        <div class="preview-items">
                            <div class="preview-item">
                                <div class="preview-item-icon">💊</div>
                                <div class="preview-item-text">口服药物</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-item-icon">🔬</div>
                                <div class="preview-item-text">微针激光</div>
                            </div>
                            <div class="preview-item">
                                <div class="preview-item-icon">🧪</div>
                                <div class="preview-item-text">刷酸治疗</div>
                            </div>
                        </div>

                        <div class="preview-benefits">
                            <h6>协同优势</h6>
                            <ul>
                                <li>95%有效缓解炎症</li>
                                <li>显著减少复发率</li>
                                <li>改善皮肤质感</li>
                                <li>缩短治疗周期</li>
                            </ul>
                        </div>

                        <div class="preview-cta">
                            <button class="preview-btn" onclick="event.stopPropagation(); showGoldenComboPage();">
                                查看完整指南
                            </button>
                        </div>
                    </div>
                </div>
                <div class="highlight-card" onclick="showSelfTest()">
                    <div class="highlight-icon">
                        <div class="icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 12L11 14L15 10" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <rect x="3" y="5" width="18" height="14" rx="2" stroke="var(--icon-color, white)" stroke-width="2" fill="none"/>
                                <path d="M8 3V7" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round"/>
                                <path d="M16 3V7" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <h4>痤疮严重程度自测</h4>
                    <p>专业分诊工具，精准评估您的痤疮类型</p>
                </div>
                <div class="highlight-card" onclick="showCostCalculator()">
                    <div class="highlight-icon">
                        <div class="icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="9" stroke="var(--icon-color, white)" stroke-width="2" fill="none"/>
                                <path d="M14.5 9.5C14 8.5 13 8 12 8S10 8.5 9.5 9.5" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round"/>
                                <path d="M12 12V16" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round"/>
                                <path d="M10.5 16H13.5" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <h4>费用预算计算器</h4>
                    <p>根据治疗方案智能估算年度费用</p>
                </div>
                <div class="highlight-card" onclick="showTreatmentComparison()">
                    <div class="highlight-icon">
                        <div class="icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 3V21H21" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 16L12 11L16 15L21 10" stroke="var(--icon-color, white)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <h4>治疗方案对比</h4>
                    <p>不同预算下的最优治疗组合推荐</p>
                </div>
            </div>
        </div>

        <!-- 电子书目录区域 -->
        <div style="margin-bottom: 20px;">
            <h2 style="text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">📚 电子书目录</h2>
            <p style="text-align: center; color: #7f8c8d; font-size: 0.95em;">选择章节开始阅读</p>
        </div>

        <div id="tableOfContents" class="toc">
            <!-- 章节列表将通过JavaScript生成 -->
        </div>

        <div id="contentArea" class="content-area">
            <button class="back-btn" onclick="showTableOfContents()">
                <div class="icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="var(--icon-color, #3498db)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                返回目录
            </button>
            <div id="chapterContent" class="content"></div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number">15万</div>
                <div class="stat-label">总字数</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">14</div>
                <div class="stat-label">主要章节</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">4</div>
                <div class="stat-label">实用附录</div>
            </div>
        </div>

        <!-- 实际项目列表区域 -->
        <div style="background: white; border-radius: 20px; padding: 40px; margin: 40px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
            <h3 style="text-align: center; color: #2c3e50; font-size: 2em; margin-bottom: 10px;">💉 实际治疗项目</h3>
            <p style="text-align: center; color: #7f8c8d; margin-bottom: 40px;">联合丽格西南中心真实医美项目 | 价格透明 | 专业定制</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- 单品项目快速预览 -->
                <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                    <h4 style="color: #667eea; margin-bottom: 15px; font-size: 1.3em;">🔬 单品治疗项目</h4>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="padding: 8px 0; color: #555; border-bottom: 1px solid rgba(255,255,255,0.5);">• 激光针清/湿敷舒敏 <span style="float: right; color: #e74c3c; font-weight: bold;">¥99起</span></li>
                        <li style="padding: 8px 0; color: #555; border-bottom: 1px solid rgba(255,255,255,0.5);">• 博乐达水杨酸面部 <span style="float: right; color: #e74c3c; font-weight: bold;">¥680起</span></li>
                        <li style="padding: 8px 0; color: #555; border-bottom: 1px solid rgba(255,255,255,0.5);">• 1565/1550点阵激光 <span style="float: right; color: #e74c3c; font-weight: bold;">¥980起</span></li>
                        <li style="padding: 8px 0; color: #555; border-bottom: 1px solid rgba(255,255,255,0.5);">• CO2点阵激光 <span style="float: right; color: #e74c3c; font-weight: bold;">¥1280起</span></li>
                        <li style="padding: 8px 0; color: #555; border-bottom: 1px solid rgba(255,255,255,0.5);">• 黄金微针4.0 <span style="float: right; color: #e74c3c; font-weight: bold;">¥1680起</span></li>
                        <li style="padding: 8px 0; color: #7f8c8d; text-align: center;">...共8个项目</li>
                    </ul>
                </div>

                <!-- 套餐方案快速预览 -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(102,126,234,0.3); color: white;">
                    <h4 style="margin-bottom: 15px; font-size: 1.3em;">📦 综合治疗套餐</h4>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">• 痘清清A（基础） <span style="float: right; font-weight: bold;">¥980起</span></li>
                        <li style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">• 痘清清B（标准） <span style="float: right; font-weight: bold;">¥1280起</span></li>
                        <li style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">• 痘清清C（高端） <span style="float: right; font-weight: bold;">¥2580起</span></li>
                        <li style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">• 毛孔痘坑卡1.0 <span style="float: right; font-weight: bold;">¥2580起</span></li>
                        <li style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.3);">• 毛孔痘坑卡3.0 <span style="float: right; font-weight: bold;">¥3980起</span></li>
                        <li style="padding: 8px 0; opacity: 0.8; text-align: center;">5个套餐全部展示</li>
                    </ul>
                </div>
            </div>

            <!-- 查看完整价格表按钮 -->
            <div style="text-align: center;">
                <a href="treatments.html" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 18px 45px; border-radius: 50px; text-decoration: none; font-size: 1.2em; font-weight: bold; box-shadow: 0 10px 30px rgba(102,126,234,0.4); transition: all 0.3s;">
                    📋 查看完整项目价格表 →
                </a>
                <p style="margin-top: 15px; color: #7f8c8d; font-size: 0.9em;">
                    包含详细项目描述 | 单次价格 | 3次套餐价 | 专业建议
                </p>
            </div>
        </div>

        <footer>
            <div class="footer-content">
                <div class="footer-company">
                    <h4>联合丽格西南中心</h4>
                    <p>重庆联合丽格科技有限公司</p>
                </div>

                <div class="footer-info">
                    <div class="footer-item">
                        <strong>备案号：</strong>
                        <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">渝ICP备2024023473号</a>
                    </div>
                    <div class="footer-item">
                        <strong>电话：</strong>023-63326559
                    </div>
                    <div class="footer-item">
                        <strong>邮箱：</strong>
                        <a href="mailto:yuxiaodong@beaucare.org">yuxiaodong@beaucare.org</a>
                    </div>
                    <div class="footer-item">
                        <strong>微信：</strong>@sooogooo
                    </div>
                </div>

                <div class="footer-copyright">
                    <p>&copy; 2025 重庆联合丽格第五医疗美容医院 | 痘痘诊疗指南 | 温暖陪伴成长</p>
                    <p style="font-size: 0.9em; color: #95a5a6; margin-top: 8px;">本书仅供科普参考，具体治疗请咨询专业医生</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- 自测模态窗口 -->
    <div id="selfTestModal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="closeSelfTest()">&times;</button>
            <div class="modal-header">
                <h2>痤疮严重程度自测</h2>
                <p class="subtitle">基于GAGS国际标准评分系统</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                <div id="progressText" class="progress-text">第 1 步，共 6 步</div>
            </div>

            <!-- 步骤1：介绍 -->
            <div id="step0" class="assessment-step active">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">欢迎使用专业痤疮评估系统</div>
                    <div class="step-description">本测试基于GAGS(Global Acne Grading System)国际标准，将帮助您准确评估痤疮严重程度并给出专业建议</div>
                </div>
                <div class="question-container">
                    <div class="question-title">评估说明</div>
                    <ul style="text-align: left; padding-left: 20px;">
                        <li>本测试将评估您面部4个主要区域的痤疮状况</li>
                        <li>每个区域根据痤疮类型和数量进行评分</li>
                        <li>总评分将确定您的痤疮严重程度等级</li>
                        <li>测试结果将提供个性化的治疗建议</li>
                        <li>整个过程大约需要3-5分钟</li>
                    </ul>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="nextStep()">开始评估</button>
                </div>
            </div>

            <!-- 步骤2：右脸颊评分 -->
            <div id="step1" class="assessment-step">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">右脸颊区域评估</div>
                    <div class="step-description">请根据您右脸颊区域的实际情况选择最符合的选项</div>
                </div>
                <div class="scoring-area">
                    <div class="area-title">右脸颊</div>
                    <div class="scoring-options" id="rightCheekOptions">
                        <div class="score-option" data-score="0" onclick="selectScore('rightCheek', 0, this)">
                            <div class="score-value">0分</div>
                            <div class="score-label">无痤疮</div>
                            <div class="score-description">皮肤清洁，无明显痤疮病变</div>
                        </div>
                        <div class="score-option" data-score="2" onclick="selectScore('rightCheek', 2, this)">
                            <div class="score-value">2分</div>
                            <div class="score-label">轻度</div>
                            <div class="score-description">少量粉刺、丘疹，< 10个病变</div>
                        </div>
                        <div class="score-option" data-score="4" onclick="selectScore('rightCheek', 4, this)">
                            <div class="score-value">4分</div>
                            <div class="score-label">中度</div>
                            <div class="score-description">中等数量丘疹、脓疱，10-40个病变</div>
                        </div>
                        <div class="score-option" data-score="6" onclick="selectScore('rightCheek', 6, this)">
                            <div class="score-value">6分</div>
                            <div class="score-label">重度</div>
                            <div class="score-description">大量炎性病变，结节，> 40个病变</div>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                    <button class="btn btn-primary" onclick="nextStep()" id="step1Next" disabled>下一步</button>
                </div>
            </div>

            <!-- 步骤3：左脸颊评分 -->
            <div id="step2" class="assessment-step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">左脸颊区域评估</div>
                    <div class="step-description">请根据您左脸颊区域的实际情况选择最符合的选项</div>
                </div>
                <div class="scoring-area">
                    <div class="area-title">左脸颊</div>
                    <div class="scoring-options" id="leftCheekOptions">
                        <div class="score-option" data-score="0" onclick="selectScore('leftCheek', 0, this)">
                            <div class="score-value">0分</div>
                            <div class="score-label">无痤疮</div>
                            <div class="score-description">皮肤清洁，无明显痤疮病变</div>
                        </div>
                        <div class="score-option" data-score="2" onclick="selectScore('leftCheek', 2, this)">
                            <div class="score-value">2分</div>
                            <div class="score-label">轻度</div>
                            <div class="score-description">少量粉刺、丘疹，< 10个病变</div>
                        </div>
                        <div class="score-option" data-score="4" onclick="selectScore('leftCheek', 4, this)">
                            <div class="score-value">4分</div>
                            <div class="score-label">中度</div>
                            <div class="score-description">中等数量丘疹、脓疱，10-40个病变</div>
                        </div>
                        <div class="score-option" data-score="6" onclick="selectScore('leftCheek', 6, this)">
                            <div class="score-value">6分</div>
                            <div class="score-label">重度</div>
                            <div class="score-description">大量炎性病变，结节，> 40个病变</div>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                    <button class="btn btn-primary" onclick="nextStep()" id="step2Next" disabled>下一步</button>
                </div>
            </div>

            <!-- 步骤4：鼻子和眉心评分 -->
            <div id="step3" class="assessment-step">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">鼻部和眉心区域评估</div>
                    <div class="step-description">请根据您鼻子和眉心区域的实际情况选择最符合的选项</div>
                </div>
                <div class="scoring-area">
                    <div class="area-title">鼻部和眉心</div>
                    <div class="scoring-options" id="noseOptions">
                        <div class="score-option" data-score="0" onclick="selectScore('nose', 0, this)">
                            <div class="score-value">0分</div>
                            <div class="score-label">无痤疮</div>
                            <div class="score-description">皮肤清洁，无明显痤疮病变</div>
                        </div>
                        <div class="score-option" data-score="1" onclick="selectScore('nose', 1, this)">
                            <div class="score-value">1分</div>
                            <div class="score-label">轻度</div>
                            <div class="score-description">少量粉刺、丘疹，< 5个病变</div>
                        </div>
                        <div class="score-option" data-score="2" onclick="selectScore('nose', 2, this)">
                            <div class="score-value">2分</div>
                            <div class="score-label">中度</div>
                            <div class="score-description">中等数量丘疹、脓疱，5-20个病变</div>
                        </div>
                        <div class="score-option" data-score="3" onclick="selectScore('nose', 3, this)">
                            <div class="score-value">3分</div>
                            <div class="score-label">重度</div>
                            <div class="score-description">大量炎性病变，结节，> 20个病变</div>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                    <button class="btn btn-primary" onclick="nextStep()" id="step3Next" disabled>下一步</button>
                </div>
            </div>

            <!-- 步骤5：下巴评分 -->
            <div id="step4" class="assessment-step">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title">下巴区域评估</div>
                    <div class="step-description">请根据您下巴区域的实际情况选择最符合的选项</div>
                </div>
                <div class="scoring-area">
                    <div class="area-title">下巴</div>
                    <div class="scoring-options" id="chinOptions">
                        <div class="score-option" data-score="0" onclick="selectScore('chin', 0, this)">
                            <div class="score-value">0分</div>
                            <div class="score-label">无痤疮</div>
                            <div class="score-description">皮肤清洁，无明显痤疮病变</div>
                        </div>
                        <div class="score-option" data-score="1" onclick="selectScore('chin', 1, this)">
                            <div class="score-value">1分</div>
                            <div class="score-label">轻度</div>
                            <div class="score-description">少量粉刺、丘疹，< 5个病变</div>
                        </div>
                        <div class="score-option" data-score="2" onclick="selectScore('chin', 2, this)">
                            <div class="score-value">2分</div>
                            <div class="score-label">中度</div>
                            <div class="score-description">中等数量丘疹、脓疱，5-20个病变</div>
                        </div>
                        <div class="score-option" data-score="3" onclick="selectScore('chin', 3, this)">
                            <div class="score-value">3分</div>
                            <div class="score-label">重度</div>
                            <div class="score-description">大量炎性病变，结节，> 20个病变</div>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="prevStep()">上一步</button>
                    <button class="btn btn-primary" onclick="nextStep()" id="step4Next" disabled>下一步</button>
                </div>
            </div>

            <!-- 步骤6：结果显示 -->
            <div id="step5" class="assessment-step">
                <div class="result-container">
                    <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-title">评估结果</div>
                    </div>

                    <div id="resultScore" class="result-score">
                        <div id="scoreDisplay" class="score-display">0</div>
                        <div id="severityLevel" class="severity-level">评估中...</div>
                        <div id="severityDescription" class="severity-description">正在计算您的痤疮严重程度...</div>
                    </div>

                    <div id="treatmentRecommendation" class="treatment-recommendation">
                        <div class="recommendation-title">个性化治疗建议</div>
                        <ul id="recommendationList" class="recommendation-list">
                            <!-- 动态生成 -->
                        </ul>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="restartTest()">重新测试</button>
                        <button class="btn btn-primary" onclick="closeSelfTest()">完成</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 三件套专题页面 -->
    <div id="goldenComboModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 1000px;">
            <button class="close-btn" onclick="closeGoldenComboPage()">&times;</button>
            <div class="golden-combo-header">
                <div class="combo-hero">
                    <div class="hero-badge">⭐ 黄金组合</div>
                    <h1>三件套治疗方案</h1>
                    <p class="hero-subtitle">口服药物 + 微针激光 + 刷酸系统</p>
                    <div class="hero-stats">
                        <div class="stat">
                            <span class="stat-number">95%</span>
                            <span class="stat-label">有效率</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">3-6</span>
                            <span class="stat-label">个月见效</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">80%</span>
                            <span class="stat-label">复发率降低</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="treatment-timeline">
                <h2>治疗时间轴</h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker">1</div>
                        <div class="timeline-content">
                            <h3>第1-2周：启动期</h3>
                            <p>开始口服药物治疗，建立基础治疗方案</p>
                            <ul>
                                <li>开始口服抗生素或维A酸类药物</li>
                                <li>温和清洁，避免过度刺激</li>
                                <li>监测皮肤反应</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker">2</div>
                        <div class="timeline-content">
                            <h3>第3-4周：加强期</h3>
                            <p>加入微针激光治疗，增强治疗效果</p>
                            <ul>
                                <li>开始第一次微针激光治疗</li>
                                <li>继续口服药物治疗</li>
                                <li>加强保湿和防晒</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker">3</div>
                        <div class="timeline-content">
                            <h3>第5-8周：系统期</h3>
                            <p>引入刷酸治疗，形成完整治疗体系</p>
                            <ul>
                                <li>开始低浓度刷酸治疗</li>
                                <li>继续微针激光治疗（间隔2-3周）</li>
                                <li>调整口服药物剂量</li>
                            </ul>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker">4</div>
                        <div class="timeline-content">
                            <h3>第9-24周：维持期</h3>
                            <p>巩固治疗效果，预防复发</p>
                            <ul>
                                <li>维持性口服药物治疗</li>
                                <li>定期微针激光维持</li>
                                <li>家用刷酸护理</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="treatment-methods">
                <h2>三大治疗方法详解</h2>
                <div class="methods-grid">
                    <div class="method-card">
                        <div class="method-icon">💊</div>
                        <h3>口服药物治疗</h3>
                        <div class="method-description">
                            <p><strong>作用机制：</strong>从内部调节激素水平，控制皮脂分泌</p>
                            <p><strong>主要药物：</strong></p>
                            <ul>
                                <li>四环素类抗生素（多西环素）</li>
                                <li>维A酸类（异维A酸）</li>
                                <li>激素调节剂（螺内酯）</li>
                            </ul>
                            <p><strong>治疗周期：</strong>3-6个月</p>
                            <p><strong>有效率：</strong>85-90%</p>
                        </div>
                    </div>

                    <div class="method-card">
                        <div class="method-icon">🔬</div>
                        <h3>微针激光治疗</h3>
                        <div class="method-description">
                            <p><strong>作用机制：</strong>促进皮肤更新，减少炎症，改善质感</p>
                            <p><strong>治疗方式：</strong></p>
                            <ul>
                                <li>点阵激光：改善痘坑痘印</li>
                                <li>射频微针：深层重塑胶原</li>
                                <li>光动力：杀灭痤疮丙酸杆菌</li>
                            </ul>
                            <p><strong>治疗间隔：</strong>2-3周一次</p>
                            <p><strong>总疗程：</strong>4-6次</p>
                        </div>
                    </div>

                    <div class="method-card">
                        <div class="method-icon">🧪</div>
                        <h3>刷酸系统治疗</h3>
                        <div class="method-description">
                            <p><strong>作用机制：</strong>加速角质代谢，疏通毛孔，预防复发</p>
                            <p><strong>酸类选择：</strong></p>
                            <ul>
                                <li>水杨酸：疏通毛孔，抗炎</li>
                                <li>果酸：促进更新，改善质感</li>
                                <li>维A酸：调节角化，预防复发</li>
                            </ul>
                            <p><strong>使用频率：</strong>初期每周1-2次</p>
                            <p><strong>维持期：</strong>每周2-3次</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="combo-advantages">
                <h2>三件套协同优势</h2>
                <div class="advantages-grid">
                    <div class="advantage-item">
                        <div class="advantage-icon">🎯</div>
                        <h3>多靶点治疗</h3>
                        <p>同时作用于痤疮发病的多个环节，从根源解决问题</p>
                    </div>
                    <div class="advantage-item">
                        <div class="advantage-icon">⚡</div>
                        <h3>快速见效</h3>
                        <p>口服药物快速控制炎症，激光加速修复，效果更显著</p>
                    </div>
                    <div class="advantage-item">
                        <div class="advantage-icon">🔄</div>
                        <h3>降低复发</h3>
                        <p>刷酸维持治疗效果，口服药物调节内分泌，有效预防复发</p>
                    </div>
                    <div class="advantage-item">
                        <div class="advantage-icon">✨</div>
                        <h3>全面改善</h3>
                        <p>不仅治疗痤疮，还改善肌理、缩小毛孔、淡化痘印</p>
                    </div>
                </div>
            </div>

            <div class="success-cases">
                <h2>成功案例展示</h2>
                <div class="cases-grid">
                    <div class="case-item">
                        <div class="case-info">
                            <h3>案例一：重度囊肿性痤疮</h3>
                            <p><strong>年龄：</strong>25岁 女性</p>
                            <p><strong>治疗前：</strong>面部大量囊肿、结节，炎症严重</p>
                            <p><strong>治疗方案：</strong>异维A酸 + 点阵激光 + 水杨酸</p>
                            <p><strong>治疗周期：</strong>6个月</p>
                            <p><strong>治疗效果：</strong>痤疮完全消退，肌理显著改善</p>
                        </div>
                    </div>
                    <div class="case-item">
                        <div class="case-info">
                            <h3>案例二：顽固性成人痤疮</h3>
                            <p><strong>年龄：</strong>28岁 女性</p>
                            <p><strong>治疗前：</strong>反复发作5年，下颌部集中</p>
                            <p><strong>治疗方案：</strong>螺内酯 + 射频微针 + 维A酸</p>
                            <p><strong>治疗周期：</strong>4个月</p>
                            <p><strong>治疗效果：</strong>痤疮控制良好，1年内无复发</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="price-guide">
                <h2>费用预算指南</h2>
                <div class="price-table">
                    <div class="price-item">
                        <h3>口服药物</h3>
                        <div class="price-range">
                            <span class="price">¥500-2000</span>
                            <span class="period">/月</span>
                        </div>
                        <ul>
                            <li>多西环素：¥100-300/月</li>
                            <li>异维A酸：¥800-1500/月</li>
                            <li>螺内酯：¥200-500/月</li>
                        </ul>
                    </div>
                    <div class="price-item">
                        <h3>微针激光</h3>
                        <div class="price-range">
                            <span class="price">¥1500-5000</span>
                            <span class="period">/次</span>
                        </div>
                        <ul>
                            <li>点阵激光：¥2000-4000/次</li>
                            <li>射频微针：¥2500-5000/次</li>
                            <li>光动力：¥1500-3000/次</li>
                        </ul>
                    </div>
                    <div class="price-item">
                        <h3>刷酸治疗</h3>
                        <div class="price-range">
                            <span class="price">¥200-800</span>
                            <span class="period">/月</span>
                        </div>
                        <ul>
                            <li>医用刷酸：¥500-1500/次</li>
                            <li>家用酸类：¥200-500/月</li>
                            <li>配套护肤：¥300-800/月</li>
                        </ul>
                    </div>
                </div>
                <div class="total-cost">
                    <h3>总体预算：</h3>
                    <p>完整6个月治疗周期：<strong>¥15,000-35,000</strong></p>
                    <p>年度维持费用：<strong>¥8,000-15,000</strong></p>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showSelfTest()">
                    <span>🔬</span> 先进行痤疮评估
                </button>
                <button class="btn btn-secondary" onclick="showCostCalculator()">
                    <span>💰</span> 费用计算器
                </button>
                <button class="btn" onclick="loadChapter('medical_beauty_guide.md', '专业医美指南：痤疮医美治疗完全指南')">
                    <span>📖</span> 查看详细指南
                </button>
                <button class="btn" onclick="closeGoldenComboPage()" style="background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);">
                    <span>🏠</span> 返回首页
                </button>
            </div>
        </div>
    </div>

    <!-- 治疗方案对比模态窗口 -->
    <div id="comparisonModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 1200px; position: relative;">
            <button class="close-btn" onclick="closeComparisonModal()">&times;</button>

            <div class="modal-header">
                <h2>治疗方案对比分析</h2>
                <p class="subtitle">根据您的需求选择最适合的治疗方案</p>
            </div>

            <div class="comparison-filters" style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 600;">预算范围</label>
                        <input type="range" id="budgetSlider" min="3000" max="60000" step="1000" value="60000"
                               oninput="filterPlansByBudget(this.value)"
                               style="width: 100%; cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.85em; color: #7f8c8d; margin-top: 5px;">
                            <span>¥3,000</span>
                            <span id="budgetValue" style="font-weight: 600; color: #e74c3c;">¥60,000+</span>
                            <span>¥60,000+</span>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: 600;">排序方式</label>
                        <select onchange="sortPlans(this.value)" style="padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; cursor: pointer; background: white;">
                            <option value="default">默认排序</option>
                            <option value="effectiveness">按效果排序</option>
                            <option value="cost">按费用排序</option>
                            <option value="duration">按周期排序</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="comparisonTable" class="comparison-table-container">
                <!-- 动态生成的对比表格 -->
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 12px; border-left: 4px solid #ffc107;">
                <h3 style="color: #856404; margin-top: 0;">智能推荐说明</h3>
                <p style="color: #856404; margin: 0;">
                    如果您已完成痤疮自测评估，系统会根据您的GAGS评分和预算自动推荐最适合的方案（高亮显示）。
                    未完成评估的用户可以点击下方按钮先进行评估。
                </p>
            </div>

            <div class="action-buttons" style="margin-top: 25px;">
                <button class="btn btn-primary" onclick="closeComparisonAndShowSelfTest()">
                    <span>🔬</span> 先进行痤疮评估
                </button>
                <button class="btn btn-secondary" onclick="closeComparisonModal(); showCostCalculator();">
                    <span>💰</span> 打开费用计算器
                </button>
            </div>
        </div>
    </div>

    <!-- 费用计算器模态窗口 -->
    <div id="costCalculatorModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 1100px;">
            <button class="close-btn" onclick="closeCostCalculator()">&times;</button>

            <div class="tool-header">
                <h2>痤疮治疗费用预算计算器</h2>
                <p>根据您选择的治疗方案，智能计算预期费用</p>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                <!-- 左侧：治疗选择区 -->
                <div class="calculator-settings">
                    <h3 style="margin-bottom: 20px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">治疗方案设置</h3>

                    <!-- 治疗类型选择 -->
                    <div class="form-group">
                        <label>治疗类型</label>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                            <div class="treatment-type-btn active" data-type="basic" onclick="updateTreatmentType('basic')">
                                <div style="font-weight: bold; margin-bottom: 5px;">基础型</div>
                                <div style="font-size: 0.85em; opacity: 0.8;">口服药物为主</div>
                            </div>
                            <div class="treatment-type-btn" data-type="standard" onclick="updateTreatmentType('standard')">
                                <div style="font-weight: bold; margin-bottom: 5px;">标准型</div>
                                <div style="font-size: 0.85em; opacity: 0.8;">药物+刷酸</div>
                            </div>
                            <div class="treatment-type-btn" data-type="premium" onclick="updateTreatmentType('premium')">
                                <div style="font-weight: bold; margin-bottom: 5px;">高端型</div>
                                <div style="font-size: 0.85em; opacity: 0.8;">完整三件套</div>
                            </div>
                        </div>
                    </div>

                    <!-- 口服药物组 -->
                    <div class="treatment-category">
                        <h4>口服药物治疗</h4>
                        <div class="treatment-options">
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="isotretinoin" onchange="calculateTotal()">
                                <span>异维A酸（异维A酸胶囊）</span>
                                <span class="price-tag">¥300-800/月</span>
                            </label>
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="minocycline" onchange="calculateTotal()">
                                <span>米诺环素（抗生素）</span>
                                <span class="price-tag">¥100-300/月</span>
                            </label>
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="doxycycline" onchange="calculateTotal()">
                                <span>多西环素（抗生素）</span>
                                <span class="price-tag">¥80-250/月</span>
                            </label>
                        </div>
                    </div>

                    <!-- 激光治疗组 -->
                    <div class="treatment-category">
                        <h4>激光治疗项目</h4>
                        <div class="treatment-options">
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="fractional" onchange="calculateTotal()">
                                <span>点阵激光</span>
                                <span class="price-tag">¥1500-3000/次</span>
                            </label>
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="rfMicroneedling" onchange="calculateTotal()">
                                <span>射频微针</span>
                                <span class="price-tag">¥2000-5000/次</span>
                            </label>
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="goldMicroneedling" onchange="calculateTotal()">
                                <span>黄金微针</span>
                                <span class="price-tag">¥1800-4000/次</span>
                            </label>
                        </div>
                    </div>

                    <!-- 刷酸治疗组 -->
                    <div class="treatment-category">
                        <h4>刷酸治疗项目</h4>
                        <div class="treatment-options">
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="aha" onchange="calculateTotal()">
                                <span>果酸焕肤</span>
                                <span class="price-tag">¥300-800/次</span>
                            </label>
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="bha" onchange="calculateTotal()">
                                <span>水杨酸焕肤</span>
                                <span class="price-tag">¥200-600/次</span>
                            </label>
                            <label class="treatment-checkbox">
                                <input type="checkbox" id="mandelic" onchange="calculateTotal()">
                                <span>杏仁酸焕肤</span>
                                <span class="price-tag">¥250-700/次</span>
                            </label>
                        </div>
                    </div>

                    <!-- 治疗周期选择 -->
                    <div class="form-group">
                        <label>治疗周期</label>
                        <select id="duration" onchange="calculateTotal()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                            <option value="3">3个月（短期治疗）</option>
                            <option value="6" selected>6个月（标准疗程）</option>
                            <option value="12">12个月（完整疗程+维持）</option>
                        </select>
                    </div>

                    <!-- 城市级别选择 -->
                    <div class="form-group">
                        <label>所在城市级别</label>
                        <select id="cityLevel" onchange="calculateTotal()" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                            <option value="1.2">一线城市（北上广深）</option>
                            <option value="1.0" selected>二线城市（省会/经济发达城市）</option>
                            <option value="0.8">三线及以下城市</option>
                        </select>
                    </div>
                </div>

                <!-- 右侧：费用结果展示 -->
                <div class="calculator-results">
                    <h3 style="margin-bottom: 20px; color: #2c3e50; border-bottom: 2px solid #00b894; padding-bottom: 10px;">费用预算结果</h3>

                    <div class="result-card" style="margin-bottom: 20px;">
                        <h3>总体预算</h3>
                        <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0; text-align: center;" id="totalCost">
                            ¥0 - ¥0
                        </div>
                        <div style="text-align: center; opacity: 0.9; font-size: 0.95em;">
                            完整治疗周期预估费用
                        </div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <h4 style="margin-bottom: 15px; color: #2c3e50;">费用明细</h4>
                        <div id="costBreakdown">
                            <div style="text-align: center; color: #7f8c8d; padding: 30px;">
                                请选择治疗项目
                            </div>
                        </div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <h4 style="margin-bottom: 15px; color: #2c3e50;">费用分析</h4>
                        <div id="costAnalysis">
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;">
                                <span>月均费用：</span>
                                <span id="monthlyCost" style="font-weight: bold; color: #3498db;">¥0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;">
                                <span>药物费用占比：</span>
                                <span id="oralPercent" style="font-weight: bold; color: #9b59b6;">0%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;">
                                <span>激光费用占比：</span>
                                <span id="laserPercent" style="font-weight: bold; color: #e74c3c;">0%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                                <span>刷酸费用占比：</span>
                                <span id="peelingPercent" style="font-weight: bold; color: #f39c12;">0%</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <div style="font-weight: bold; margin-bottom: 5px; color: #856404;">温馨提示</div>
                        <div style="font-size: 0.9em; color: #856404; line-height: 1.5;">
                            以上费用为预估值，实际费用可能因医院等级、医生资质、设备品牌等因素有所差异。建议就诊前咨询具体医疗机构获取准确报价。
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="resetCalculator()" style="width: 100%; padding: 15px; font-size: 1.1em;">
                            重置计算器
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== 扩展的痤疮治疗项目数据（智能搜索版本） ==========
        const ACNE_REAL_DATA = {
            singleItems: [
                {
                    id: 'item_1', name: '激光针清/湿敷舒敏/红蓝光', category: '基础治疗',
                    desc: '用于轻度痘肌问题，消炎去红，激光开口更卫生',
                    price_single: 99, price_triple: 199,
                    symptoms: ['炎性痘痘', '红肿痘痘', '闭口粉刺'],
                    areas: ['全脸', '额头', '脸颊', '下巴'],
                    severity: ['轻度'],
                    duration: '单次治疗',
                    recovery: '无恢复期',
                    适应症: '轻度痘痘、炎性丘疹、闭口粉刺',
                    禁忌症: '严重感染、孕妇',
                    详细说明: '使用专业激光设备进行针清，配合红蓝光消炎，适合轻度痘痘肌肤的日常护理。红光促进愈合，蓝光杀菌消炎。'
                },
                {
                    id: 'item_2', name: '博乐达水杨酸面部', category: '刷酸治疗',
                    desc: '抑制皮脂分泌、松解角质、抗炎、促进皮损消退',
                    price_single: 680, price_triple: 1680,
                    symptoms: ['油性皮肤', '毛孔粗大', '黑头', '闭口粉刺', '痘痘'],
                    areas: ['全脸', 'T区', '额头', '鼻子', '下巴'],
                    severity: ['轻度', '中度'],
                    duration: '3-6次为一疗程',
                    recovery: '轻微脱皮2-3天',
                    适应症: '油性皮肤、毛孔粗大、黑头粉刺、轻中度痤疮',
                    禁忌症: '敏感肌、孕妇、哺乳期、皮肤屏障受损',
                    详细说明: '博乐达超分子水杨酸，温和有效。20%浓度适合面部，能深入毛孔溶解角质栓，抑制油脂分泌，改善粉刺和痘痘。'
                },
                {
                    id: 'item_3', name: '小针刀剥离', category: '痘坑修复',
                    desc: '真皮层剥离技术，降低组织粘连，加速痘坑治疗',
                    price_single: 980, price_triple: 2580,
                    symptoms: ['痘坑', '凹陷性瘢痕', '萎缩性痘印'],
                    areas: ['全脸', '脸颊', '太阳穴', '额头'],
                    severity: ['中度', '重度'],
                    duration: '3-5次为一疗程',
                    recovery: '术后红肿3-7天',
                    适应症: '冰锥型痘坑、车厢型痘坑、深层凹陷瘢痕',
                    禁忌症: '瘢痕体质、凝血功能障碍、活动性感染',
                    详细说明: '使用专业小针刀进行皮下粘连剥离，松解瘢痕组织，为后续激光治疗打好基础。需要专业医生操作。'
                },
                {
                    id: 'item_4', name: '1565非剥脱点阵', category: '激光治疗',
                    desc: '1565nm波长激光，适合浅中层痘坑、毛孔粗大',
                    price_single: 980, price_triple: 2580,
                    symptoms: ['浅层痘坑', '毛孔粗大', '痘印', '皮肤粗糙'],
                    areas: ['全脸', '脸颊', '额头', '鼻翼'],
                    severity: ['轻度', '中度'],
                    duration: '3-5次为一疗程',
                    recovery: '术后轻微红肿1-2天',
                    适应症: '浅中层痘坑、毛孔粗大、皮肤粗糙、轻度色沉',
                    禁忌症: '光敏性皮肤、近期暴晒、孕妇、皮肤感染',
                    详细说明: '1565nm波长穿透深度适中，刺激真皮层胶原再生，改善浅中层痘坑和毛孔问题。非剥脱技术，恢复期短。'
                },
                {
                    id: 'item_5', name: '1550非剥脱点阵激光', category: '激光治疗',
                    desc: '穿透较深，适合中深层痘坑、萎缩性瘢痕',
                    price_single: 1280, price_triple: 2980,
                    symptoms: ['中深层痘坑', '萎缩性瘢痕', '皮肤凹陷'],
                    areas: ['全脸', '脸颊', '太阳穴', '额头'],
                    severity: ['中度', '重度'],
                    duration: '4-6次为一疗程',
                    recovery: '术后红肿2-4天',
                    适应症: '中深层痘坑、车厢型痘坑、萎缩性瘢痕',
                    禁忌症: '瘢痕体质、皮肤感染、孕期哺乳期',
                    详细说明: '1550nm波长穿透更深，能到达真皮深层，强力刺激胶原重塑，适合较深的痘坑和瘢痕治疗。'
                },
                {
                    id: 'item_6', name: '二氧化碳点阵激光', category: '激光治疗',
                    desc: '强效胶原纤维合成及重塑，用于痘坑治疗',
                    price_single: 1280, price_triple: 2980,
                    symptoms: ['重度痘坑', '增生性瘢痕', '深层凹陷'],
                    areas: ['全脸', '局部痘坑区域'],
                    severity: ['重度', '极重度'],
                    duration: '3-5次为一疗程',
                    recovery: '术后结痂7-10天',
                    适应症: '重度痘坑、冰锥型痘坑、严重瘢痕',
                    禁忌症: '瘢痕体质、皮肤感染、近期服用光敏药物',
                    详细说明: 'CO2激光是痘坑治疗的金标准，通过汽化表皮、刺激胶原强力重塑。效果显著但恢复期较长，需做好术后护理。'
                },
                {
                    id: 'item_7', name: '三明治祛痘嫩肤', category: '综合治疗',
                    desc: '多层促渗祛痘抗炎，配合水杨酸促进角质脱落',
                    price_single: 1380, price_triple: 2980,
                    symptoms: ['活动性痘痘', '油性皮肤', '毛孔粗大', '肤色暗沉'],
                    areas: ['全脸'],
                    severity: ['轻度', '中度'],
                    duration: '4-6次为一疗程',
                    recovery: '无恢复期',
                    适应症: '活动性痤疮、油性皮肤、毛孔粗大、肤质粗糙',
                    禁忌症: '敏感肌、皮肤屏障受损、孕期哺乳期',
                    详细说明: '结合导入、刷酸、光疗的综合治疗方案。多层渗透抗炎成分，配合水杨酸溶解角质，最后红蓝光消炎镇定。'
                },
                {
                    id: 'item_8', name: '黄金微针4.0', category: '射频微针',
                    desc: '射频能量作用皮脂腺，抑制油脂分泌，刺激胶原新生',
                    price_single: 1680, price_triple: 4580,
                    symptoms: ['活动性痘痘', '痘坑', '毛孔粗大', '皮肤松弛', '油性皮肤'],
                    areas: ['全脸', '局部重点区域'],
                    severity: ['中度', '重度', '极重度'],
                    duration: '3-4次为一疗程',
                    recovery: '术后红肿3-5天',
                    适应症: '活动性痤疮、痘坑、毛孔粗大、皮肤松弛老化',
                    禁忌症: '瘢痕体质、金属过敏、心脏起搏器、孕期',
                    详细说明: '黄金微针结合射频能量，精准控制深度和温度。既能控油祛痘，又能刺激胶原、修复痘坑，是综合性很强的治疗方式。'
                }
            ],
            packages: [
                {
                    id: 'pkg_a', name: '痘清清A', level: '基础套餐',
                    price_single: 980, price_triple: 2580,
                    items: '1565/1550点阵+博乐达水杨酸',
                    desc: '深浅层结合，光热杀菌+水杨酸消炎控油',
                    symptoms: ['痘痘', '痘坑', '毛孔粗大', '油性皮肤'],
                    areas: ['全脸'],
                    severity: ['轻度', '中度'],
                    duration: '3次为一疗程',
                    recovery: '轻微红肿2-3天',
                    适应症: '轻中度痤疮+浅层痘坑+毛孔粗大',
                    详细说明: '基础组合套餐，激光+刷酸双管齐下，既控油祛痘，又改善痘坑毛孔。适合预算有限的轻中度痘肌。'
                },
                {
                    id: 'pkg_b', name: '痘清清B', level: '标准套餐',
                    price_single: 1280, price_triple: 2980,
                    items: '芬生源208+博乐达水杨酸+OPT光子/点阵激光',
                    desc: '三项综合治疗，抗炎抑菌导入+激光胶原再生',
                    symptoms: ['痘痘', '痘印', '痘坑', '红血丝', '肤色不均'],
                    areas: ['全脸'],
                    severity: ['中度'],
                    duration: '3次为一疗程',
                    recovery: '术后红肿2-4天',
                    适应症: '中度痤疮+色素沉着+浅中层痘坑',
                    详细说明: '标准三联方案：导入抗炎+刷酸控油+光子/激光修复。全面应对痘痘、痘印、痘坑问题。'
                },
                {
                    id: 'pkg_c', name: '痘清清C', level: '高端套餐',
                    price_single: 2580, price_triple: 5980,
                    items: '博乐达水杨酸+激光治疗+战痘套组+LED/湿敷/针清',
                    desc: '包含战痘套组，促进皮肤高效恢复',
                    symptoms: ['痘痘', '痘印', '痘坑', '皮肤粗糙', '暗沉'],
                    areas: ['全脸'],
                    severity: ['中度', '重度'],
                    duration: '3次为一疗程',
                    recovery: '术后护理更完善',
                    适应症: '中重度痤疮需要全面管理',
                    详细说明: '高端全套方案，包含战痘套组（医用护肤品），提供完整的治疗+护理解决方案。'
                },
                {
                    id: 'pkg_d', name: '毛孔痘坑卡1.0', level: '痘坑专项',
                    price_single: 2580, price_triple: 5980,
                    items: 'CO2点阵激光+博乐达水杨酸+小针刀剥离+针清/照光',
                    desc: 'CO2点阵磨削表皮+刺激深层胶原',
                    symptoms: ['痘坑', '毛孔粗大', '皮肤凹陷', '瘢痕'],
                    areas: ['全脸', '局部重点区域'],
                    severity: ['重度'],
                    duration: '3-5次为一疗程',
                    recovery: '术后结痂7-10天',
                    适应症: '中重度痘坑+增生/萎缩性瘢痕',
                    详细说明: '痘坑专项治疗，小针刀剥离+CO2激光，强力重塑胶原，针对顽固痘坑。需要严格术后护理。'
                },
                {
                    id: 'pkg_e', name: '毛孔痘坑卡3.0', level: '顶级套餐',
                    price_single: 3980, price_triple: 8800,
                    items: '黄金微针+CO2点阵+战痘套组+博乐达水杨酸×2+小针刀×2+针清/照光×6',
                    desc: '综合全方案，医生定制，针对严重问题',
                    symptoms: ['重度痘痘', '严重痘坑', '多种皮肤问题'],
                    areas: ['全脸', '多部位综合治疗'],
                    severity: ['重度', '极重度'],
                    duration: '3次为一个大疗程',
                    recovery: '分阶段恢复',
                    适应症: '重度痤疮+严重痘坑+综合性皮肤问题',
                    详细说明: '顶级全套方案，包含所有主流治疗手段。医生根据个人情况定制治疗计划，适合严重痘坑和综合性问题。'
                }
            ]
        };

        // 章节配置
        const chapters = [
            { file: '00_preface.md', title: '前言：我与痘痘的不解之缘', desc: '医生的从医经历与写作初衷', icon: 'icons/chapters/preface.svg' },
            { file: '01_true_face.md', title: '第一章：痘痘的真面目', desc: '揭示成年痘的真相，破除青春痘迷思', icon: 'icons/chapters/chapter01.svg' },
            { file: '02_hidden_culprits.md', title: '第二章：痘痘背后的"幕后黑手"', desc: '深度分析内分泌、压力、饮食等影响因素', icon: 'icons/chapters/chapter02.svg' },
            { file: '03_psychological_impact.md', title: '第三章：痘痘的心理影响', desc: '颜值焦虑、社交恐惧的成因与应对', icon: 'icons/chapters/chapter03.svg' },
            { file: '04_professional_treatment.md', title: '第四章：专业诊疗方案', desc: '医院就诊指导与各种治疗方法详解', icon: 'icons/chapters/chapter04.svg' },
            { file: 'medical_beauty_guide.md', title: '专业医美指南：痤疮医美治疗完全指南', desc: '口服药物治疗、微针激光、刷酸系统与分诊应用完整方案', icon: 'icons/medical/treatment_types.svg', isSpecial: true },
            { file: '05_skincare_methods.md', title: '第五章：日常护肤的科学方法', desc: '破除护肤误区，建立科学护理体系', icon: 'icons/chapters/chapter05.svg' },
            { file: '06_makeup_guide.md', title: '第六章：化妆技巧与注意事项', desc: '痘痘肌化妆秘籍与产品选择指南', icon: 'icons/chapters/chapter06.svg' },
            { file: '07_scar_treatment.md', title: '第七章：痘印痘坑的修复', desc: '疤痕分类、治疗方法与心理调适', icon: 'icons/chapters/chapter07.svg' },
            { file: '08_diet_nutrition.md', title: '第八章：饮食调理与营养支持', desc: '科学饮食指导与一周食谱推荐', icon: 'icons/chapters/chapter08.svg' },
            { file: '09_lifestyle_stress.md', title: '第九章：作息调整与压力管理', desc: '适合996工作制的生活优化方案', icon: 'icons/chapters/chapter09.svg' },
            { file: '10_exercise_health.md', title: '第十章：运动与皮肤健康', desc: '运动对皮肤的影响与护理指导', icon: 'icons/chapters/chapter10.svg' },
            { file: '11_rebuild_confidence.md', title: '第十一章：重建自信心', desc: '心理重建与自我价值重新认知', icon: 'icons/chapters/chapter11.svg' },
            { file: '12_family_social_support.md', title: '第十二章：家庭支持与社会适应', desc: '家庭沟通与社交技巧指导', icon: 'icons/chapters/chapter12.svg' },
            { file: '13_teenage_management.md', title: '第十三章：青少年痘痘管理', desc: '青春期特殊管理与家长指导', icon: 'icons/chapters/chapter13.svg' },
            { file: '14_adult_women_management.md', title: '第十四章：成年女性痘痘管理', desc: '职场女性的专业形象与生活平衡', icon: 'icons/chapters/chapter14.svg' },
            { file: '15_appendix_a.md', title: '附录A：药物与成分表', desc: '常用药物成分详解与选择指南', icon: 'icons/chapters/appendix_a.svg' },
            { file: '16_appendix_b.md', title: '附录B：应急处理方案', desc: '突发情况的快速处理方法', icon: 'icons/chapters/appendix_b.svg' },
            { file: '17_appendix_c.md', title: '附录C：专业资源', desc: '医院推荐与求助渠道汇总', icon: 'icons/chapters/appendix_c.svg' },
            { file: '18_appendix_d.md', title: '附录D：常见问题解答', desc: '50个常见问题的专业解答', icon: 'icons/chapters/appendix_c.svg' },
            { file: '19_conclusion.md', title: '结语：美丽人生，从接纳开始', desc: '未来展望与温暖鼓励', icon: 'icons/chapters/conclusion.svg' }
        ];

        // SVG图标缓存
        const iconCache = new Map();

        // SVG图标加载函数
        async function loadSVG(iconPath) {
            // 检查缓存
            if (iconCache.has(iconPath)) {
                return iconCache.get(iconPath);
            }

            try {
                const response = await fetch(iconPath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const svgContent = await response.text();

                // 缓存SVG内容
                iconCache.set(iconPath, svgContent);
                return svgContent;
            } catch (error) {
                console.error('Failed to load SVG:', iconPath, error);
                // 返回默认图标
                const defaultIcon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="3" stroke="var(--icon-color, #e74c3c)" stroke-width="2" fill="none"/><path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="var(--icon-color, #e74c3c)" stroke-width="2" stroke-linecap="round"/></svg>';
                iconCache.set(iconPath, defaultIcon);
                return defaultIcon;
            }
        }

        // 生成目录
        async function generateTableOfContents() {
            const toc = document.getElementById('tableOfContents');

            for (const chapter of chapters) {
                const card = document.createElement('div');
                card.className = chapter.isSpecial ? 'chapter-card special' : 'chapter-card';
                card.style.position = 'relative';

                // 加载SVG图标
                const svgContent = await loadSVG(chapter.icon);

                const chapterData = { id: chapters.indexOf(chapter), title: chapter.title, desc: chapter.desc, file: chapter.file };
                const bookmarked = isBookmarked('chapter', chapterData.id);

                card.innerHTML = `
                    <button class="chapter-bookmark-btn"
                            data-chapter-id="${chapterData.id}"
                            style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 1.5em; cursor: pointer; padding: 5px; z-index: 10; transition: transform 0.2s;"
                            title="收藏"
                            onmouseover="this.style.transform='scale(1.2)'"
                            onmouseout="this.style.transform='scale(1)'">
                        ${bookmarked ? '⭐' : '☆'}
                    </button>
                    <div class="chapter-header">
                        <div class="chapter-icon icon icon--large">
                            ${svgContent}
                        </div>
                        <div class="chapter-title">${chapter.title}</div>
                    </div>
                    <div class="chapter-desc">${chapter.desc}</div>
                `;

                // 添加收藏按钮点击事件
                const bookmarkBtn = card.querySelector('.chapter-bookmark-btn');
                bookmarkBtn.onclick = (e) => {
                    e.stopPropagation();
                    const success = addBookmark('chapter', chapterData);
                    bookmarkBtn.textContent = success ? '⭐' : '☆';
                };

                card.onclick = () => loadChapter(chapter.file, chapter.title);
                toc.appendChild(card);
            }
        }

        // 加载章节内容
        async function loadChapter(filename, title) {
            try {
                const response = await fetch(filename);
                const text = await response.text();
                const content = markdownToHtml(text);

                document.getElementById('chapterContent').innerHTML = `
                    <h1>${title}</h1>
                    ${content}
                `;
                document.getElementById('tableOfContents').style.display = 'none';
                document.getElementById('contentArea').classList.add('active');
                document.querySelector('.book-info').style.display = 'none';
                document.querySelector('.stats').style.display = 'none';

                // 保存阅读进度
                saveReadingProgress(filename, title);

                // 滚动到内容区域，确保用户能看到加载的章节
                setTimeout(() => {
                    const contentArea = document.getElementById('contentArea');
                    if (contentArea) {
                        contentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }

                    // 恢复滚动位置
                    restoreScrollPosition(filename);
                    // 启动滚动监听
                    startScrollTracking(filename);
                }, 100);
            } catch (error) {
                document.getElementById('chapterContent').innerHTML = `
                    <h1>加载失败</h1>
                    <p>抱歉，无法加载章节内容。请稍后重试。</p>
                `;
                document.getElementById('contentArea').classList.add('active');

                // 确保错误信息也在可视区域
                setTimeout(() => {
                    const contentArea = document.getElementById('contentArea');
                    if (contentArea) {
                        contentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
        }

        // 完全重写的Markdown转HTML函数
        function markdownToHtml(markdown) {
            if (!markdown) return '';

            // 统一换行符处理
            let text = markdown.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

            // 按行分割
            let lines = text.split('\n');
            let result = [];
            let inUnorderedList = false;
            let inOrderedList = false;
            let inTable = false;
            let inCodeBlock = false;
            let inBlockquote = false;
            let codeBlockContent = [];
            let codeBlockLang = '';

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                let trimmedLine = line.trim();

                // 处理代码块
                if (trimmedLine.startsWith('```')) {
                    if (!inCodeBlock) {
                        // 开始代码块 - 先结束其他状态
                        if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                        if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                        if (inBlockquote) { result.push('</blockquote>'); inBlockquote = false; }

                        inCodeBlock = true;
                        codeBlockLang = trimmedLine.substring(3).trim();
                        codeBlockContent = [];
                        continue;
                    } else {
                        // 结束代码块
                        inCodeBlock = false;
                        let codeHtml = codeBlockContent.join('\n')
                            .replace(/&/g, '&amp;')
                            .replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;');
                        result.push(`<pre><code class="language-${codeBlockLang}">${codeHtml}</code></pre>`);
                        codeBlockContent = [];
                        codeBlockLang = '';
                        continue;
                    }
                }

                // 如果在代码块中，直接添加内容
                if (inCodeBlock) {
                    codeBlockContent.push(line);
                    continue;
                }

                // 处理引用块
                if (trimmedLine.startsWith('>')) {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }

                    if (!inBlockquote) {
                        result.push('<blockquote>');
                        inBlockquote = true;
                    }
                    let content = trimmedLine.substring(1).trim();
                    content = processInlineFormatting(content);
                    result.push(`<p>${content}</p>`);
                    continue;
                } else if (inBlockquote) {
                    result.push('</blockquote>');
                    inBlockquote = false;
                }

                // 处理水平分隔线
                if (trimmedLine.match(/^[\-\*_]{3,}$/)) {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                    result.push('<hr>');
                    continue;
                }

                // 处理表格
                if (trimmedLine.startsWith('|') && trimmedLine.endsWith('|')) {
                    // 检查是否是分隔行 (|---|---|)
                    if (trimmedLine.match(/^\|[\s\-:]+\|$/)) {
                        continue;
                    }

                    // 如果还未开始表格，检查下一行是否是分隔行
                    if (!inTable) {
                        if (i + 1 < lines.length && lines[i + 1].trim().match(/^\|[\s\-:]+\|$/)) {
                            if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                            if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }

                            // 开始表格，这是表头
                            result.push('<table class="markdown-table">');
                            result.push('<thead>');
                            let cells = trimmedLine.split('|').filter(cell => cell.trim() !== '');
                            let headerRow = '<tr>' + cells.map(cell => `<th>${processInlineFormatting(cell.trim())}</th>`).join('') + '</tr>';
                            result.push(headerRow);
                            result.push('</thead>');
                            result.push('<tbody>');
                            inTable = true;
                            i++; // 跳过下一行（分隔行）
                            continue;
                        }
                    } else {
                        // 在表格中，这是数据行
                        let cells = trimmedLine.split('|').filter(cell => cell.trim() !== '');
                        let dataRow = '<tr>' + cells.map(cell => `<td>${processInlineFormatting(cell.trim())}</td>`).join('') + '</tr>';
                        result.push(dataRow);
                        continue;
                    }
                } else if (inTable) {
                    // 遇到非表格行，结束表格
                    result.push('</tbody>');
                    result.push('</table>');
                    inTable = false;
                }

                // 处理空行 - 结束当前列表状态
                if (trimmedLine === '') {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                    if (result.length > 0 && result[result.length - 1] !== '') {
                        result.push('');
                    }
                    continue;
                }

                // 处理标题 - 按照优先级从长到短匹配
                if (trimmedLine.match(/^#### /)) {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                    let title = trimmedLine.replace(/^#### /, '');
                    result.push(`<h4>${processInlineFormatting(title)}</h4>`);
                    continue;
                }
                if (trimmedLine.match(/^### /)) {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                    let title = trimmedLine.replace(/^### /, '');
                    result.push(`<h3>${processInlineFormatting(title)}</h3>`);
                    continue;
                }
                if (trimmedLine.match(/^## /)) {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                    let title = trimmedLine.replace(/^## /, '');
                    result.push(`<h2>${processInlineFormatting(title)}</h2>`);
                    continue;
                }
                if (trimmedLine.match(/^# /)) {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                    let title = trimmedLine.replace(/^# /, '');
                    result.push(`<h1>${processInlineFormatting(title)}</h1>`);
                    continue;
                }

                // 处理无序列表 - 支持 -, *, + 三种标记
                let unorderedMatch = trimmedLine.match(/^[\-\*\+]\s+(.+)/);
                if (unorderedMatch) {
                    if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }
                    if (!inUnorderedList) {
                        result.push('<ul>');
                        inUnorderedList = true;
                    }
                    result.push(`<li>${processInlineFormatting(unorderedMatch[1])}</li>`);
                    continue;
                }

                // 处理有序列表
                let orderedMatch = trimmedLine.match(/^\d+\.\s+(.+)/);
                if (orderedMatch) {
                    if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                    if (!inOrderedList) {
                        result.push('<ol>');
                        inOrderedList = true;
                    }
                    result.push(`<li>${processInlineFormatting(orderedMatch[1])}</li>`);
                    continue;
                }

                // 如果到这里，说明不是列表项，需要结束当前的列表
                if (inUnorderedList) { result.push('</ul>'); inUnorderedList = false; }
                if (inOrderedList) { result.push('</ol>'); inOrderedList = false; }

                // 处理普通段落
                if (trimmedLine) {
                    result.push(`<p>${processInlineFormatting(trimmedLine)}</p>`);
                }
            }

            // 确保所有块级元素都被正确关闭
            if (inUnorderedList) result.push('</ul>');
            if (inOrderedList) result.push('</ol>');
            if (inTable) { result.push('</tbody>'); result.push('</table>'); }
            if (inBlockquote) result.push('</blockquote>');

            // 连接结果并清理
            return result.join('\n').replace(/\n{3,}/g, '\n\n').trim();
        }

        // 处理行内格式化（粗体、斜体、链接等）
        function processInlineFormatting(text) {
            if (!text) return '';

            // 转义HTML特殊字符（除了已经是HTML标签的）
            text = text.replace(/&/g, '&amp;')
                      .replace(/</g, '&lt;')
                      .replace(/>/g, '&gt;');

            // 处理链接 [文本](url)
            text = text.replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

            // 处理图片 ![alt](url)
            text = text.replace(/!\[([^\]]*)\]\(([^\)]+)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto;">');

            // 处理粗体 **text** 或 __text__
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/__(.+?)__/g, '<strong>$1</strong>');

            // 处理斜体 *text* 或 _text_（但不匹配粗体）
            // 先处理下划线斜体，避免和粗体冲突
            text = text.replace(/(?<!_)_([^_]+?)_(?!_)/g, '<em>$1</em>');
            // 处理星号斜体，使用更简单的方法
            text = text.replace(/\*([^\*]+?)\*/g, '<em>$1</em>');

            // 处理删除线 ~~text~~
            text = text.replace(/~~(.+?)~~/g, '<del>$1</del>');

            // 处理行内代码 `code`
            text = text.replace(/`([^`]+?)`/g, '<code>$1</code>');

            // 还原被转义的HTML（在链接和图片中）
            text = text.replace(/&lt;a /g, '<a ')
                      .replace(/&lt;\/a&gt;/g, '</a>')
                      .replace(/&lt;img /g, '<img ');

            return text;
        }

        // 返回目录
        function showTableOfContents() {
            document.getElementById('tableOfContents').style.display = 'grid';
            document.getElementById('contentArea').classList.remove('active');
            document.querySelector('.book-info').style.display = 'block';
            document.querySelector('.stats').style.display = 'block';

            // 停止滚动位置跟踪
            stopScrollTracking();
        }

        // 数字滚动动画
        function animateNumber(element, finalNumber, duration = 2000) {
            const startNumber = 0;
            const startTime = performance.now();

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // 使用缓动函数
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentNumber = Math.floor(startNumber + (finalNumber - startNumber) * easeOutQuart);

                if (element.textContent.includes('%')) {
                    element.textContent = currentNumber + '%';
                } else if (element.textContent.includes('-')) {
                    element.textContent = currentNumber + '-' + (currentNumber + 3);
                } else {
                    element.textContent = currentNumber + '%';
                }

                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }

            requestAnimationFrame(updateNumber);
        }

        // 三件套专题页面功能
        function showGoldenComboPage() {
            const modal = document.getElementById('goldenComboModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            // 添加进入动画
            setTimeout(() => {
                modal.querySelector('.modal-content').style.transform = 'scale(1)';

                // 启动数字动画
                const statNumbers = modal.querySelectorAll('.stat-number');
                setTimeout(() => {
                    animateNumber(statNumbers[0], 95, 2000); // 95%
                    animateNumber(statNumbers[1], 3, 2000);  // 3-6
                    animateNumber(statNumbers[2], 80, 2000); // 80%
                }, 500);
            }, 50);

            // 隐藏其他界面
            document.getElementById('tableOfContents').style.display = 'none';
            document.querySelector('.book-info').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            document.querySelector('.medical-beauty-section').style.display = 'none';
        }

        function closeGoldenComboPage() {
            const modal = document.getElementById('goldenComboModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';

            // 显示其他界面
            document.getElementById('tableOfContents').style.display = 'grid';
            document.querySelector('.book-info').style.display = 'block';
            document.querySelector('.stats').style.display = 'block';
            document.querySelector('.medical-beauty-section').style.display = 'block';
        }

        // 自测功能
        let currentStep = 0;
        let assessmentData = {
            rightCheek: null,
            leftCheek: null,
            nose: null,
            chin: null
        };

        function showSelfTest() {
            const modal = document.getElementById('selfTestModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            // 重置测试
            currentStep = 0;
            assessmentData = {
                rightCheek: null,
                leftCheek: null,
                nose: null,
                chin: null
            };

            showStep(0);
            updateProgress();
        }

        function closeSelfTest() {
            const modal = document.getElementById('selfTestModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function nextStep() {
            if (currentStep < 5) {
                currentStep++;
                showStep(currentStep);
                updateProgress();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
                updateProgress();
            }
        }

        function showStep(stepNumber) {
            // 隐藏所有步骤
            document.querySelectorAll('.assessment-step').forEach(step => {
                step.classList.remove('active');
            });

            // 显示当前步骤
            const currentStepElement = document.getElementById(`step${stepNumber}`);
            if (currentStepElement) {
                currentStepElement.classList.add('active');
            }

            // 如果是结果步骤，计算并显示结果
            if (stepNumber === 5) {
                calculateAndShowResults();
            }
        }

        function selectScore(area, score, element) {
            assessmentData[area] = score;

            // 清除同组的选中状态
            const options = element.parentNode.querySelectorAll('.score-option');
            options.forEach(option => option.classList.remove('selected'));

            // 标记当前选中
            element.classList.add('selected');

            // 启用下一步按钮
            const nextButton = document.getElementById(`step${currentStep}Next`);
            if (nextButton) {
                nextButton.disabled = false;
            }
        }

        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            const progress = ((currentStep + 1) / 6) * 100;
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `第 ${currentStep + 1} 步，共 6 步`;
        }

        function calculateAndShowResults() {
            const totalScore = (assessmentData.rightCheek || 0) +
                             (assessmentData.leftCheek || 0) +
                             (assessmentData.nose || 0) +
                             (assessmentData.chin || 0);

            // 保存GAGS评分用于方案推荐
            lastGagsScore = totalScore;

            let severity, description, recommendations;

            if (totalScore <= 2) {
                severity = "轻度痤疮";
                description = "皮肤状况良好，痤疮程度较轻";
                recommendations = [
                    "温和清洁，使用氨基酸洁面乳",
                    "外用维A酸类药物（阿达帕林凝胶）",
                    "注意防晒和保湿",
                    "避免挤压痘痘",
                    "调整作息，保持充足睡眠"
                ];
            } else if (totalScore <= 6) {
                severity = "轻中度痤疮";
                description = "需要积极治疗，建议就医咨询";
                recommendations = [
                    "外用维A酸类 + 过氧化苯甲酰",
                    "考虑口服抗生素（多西环素）",
                    "定期进行专业清洁护理",
                    "低糖低奶制品饮食",
                    "考虑轻度化学剥脱治疗"
                ];
            } else if (totalScore <= 12) {
                severity = "中重度痤疮";
                description = "需要系统性治疗，强烈建议就医";
                recommendations = [
                    "口服异维A酸或抗生素",
                    "外用维A酸 + 抗菌药物",
                    "考虑激光或光动力治疗",
                    "🌟 推荐：三件套联合治疗（点击查看详情）",
                    "心理支持和生活方式调整"
                ];
            } else {
                severity = "重度痤疮";
                description = "需要立即就医，接受系统治疗";
                recommendations = [
                    "立即就医，专业医生制定治疗方案",
                    "口服异维A酸治疗",
                    "激光、光动力等医美治疗",
                    "🌟 强烈推荐：三件套联合治疗（点击查看详情）",
                    "长期随访和维持治疗",
                    "心理健康关注和支持"
                ];
            }

            // 更新结果显示
            document.getElementById('scoreDisplay').textContent = totalScore;
            document.getElementById('severityLevel').textContent = severity;
            document.getElementById('severityDescription').textContent = description;

            const recommendationList = document.getElementById('recommendationList');
            recommendationList.innerHTML = '';
            recommendations.forEach(rec => {
                const li = document.createElement('li');

                if (rec.includes('三件套')) {
                    li.innerHTML = rec;
                    li.style.cursor = 'pointer';
                    li.style.background = 'linear-gradient(135deg, #ffd700 0%, #ff8c00 100%)';
                    li.style.color = '#2c3e50';
                    li.style.fontWeight = 'bold';
                    li.style.borderLeft = '4px solid #ff6b6b';
                    li.style.transform = 'translateX(5px)';
                    li.addEventListener('click', function() {
                        closeSelfTest();
                        setTimeout(() => {
                            showGoldenComboPage();
                        }, 300);
                    });
                } else {
                    li.textContent = rec;
                }

                recommendationList.appendChild(li);
            });
        }

        function restartTest() {
            currentStep = 0;
            assessmentData = {
                rightCheek: null,
                leftCheek: null,
                nose: null,
                chin: null
            };

            // 清除所有选择
            document.querySelectorAll('.score-option').forEach(option => {
                option.classList.remove('selected');
            });

            // 禁用下一步按钮
            document.querySelectorAll('[id$="Next"]').forEach(btn => {
                btn.disabled = true;
            });

            showStep(0);
            updateProgress();
        }

        // 费用计算器功能

        // 价格数据库
        const treatmentPrices = {
            oral: {
                isotretinoin: { name: '异维A酸', min: 300, max: 800, unit: '月', frequency: 1 },
                minocycline: { name: '米诺环素', min: 100, max: 300, unit: '月', frequency: 1 },
                doxycycline: { name: '多西环素', min: 80, max: 250, unit: '月', frequency: 1 }
            },
            laser: {
                fractional: { name: '点阵激光', min: 1500, max: 3000, unit: '次', frequency: 4 },
                rfMicroneedling: { name: '射频微针', min: 2000, max: 5000, unit: '次', frequency: 6 },
                goldMicroneedling: { name: '黄金微针', min: 1800, max: 4000, unit: '次', frequency: 6 }
            },
            peeling: {
                aha: { name: '果酸焕肤', min: 300, max: 800, unit: '次', frequency: 4 },
                bha: { name: '水杨酸焕肤', min: 200, max: 600, unit: '次', frequency: 4 },
                mandelic: { name: '杏仁酸焕肤', min: 250, max: 700, unit: '次', frequency: 4 }
            }
        };

        function showCostCalculator() {
            const modal = document.getElementById('costCalculatorModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            resetCalculator();
            calculateTotal();
        }

        function closeCostCalculator() {
            const modal = document.getElementById('costCalculatorModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function updateTreatmentType(type) {
            // 更新按钮状态
            document.querySelectorAll('.treatment-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // 根据类型自动勾选治疗项目
            const allCheckboxes = document.querySelectorAll('.treatment-checkbox input[type="checkbox"]');
            allCheckboxes.forEach(cb => cb.checked = false);

            if (type === 'basic') {
                // 基础型：只选口服药物
                document.getElementById('isotretinoin').checked = true;
            } else if (type === 'standard') {
                // 标准型：口服药物 + 刷酸
                document.getElementById('isotretinoin').checked = true;
                document.getElementById('aha').checked = true;
            } else if (type === 'premium') {
                // 高端型：三件套全选
                document.getElementById('isotretinoin').checked = true;
                document.getElementById('fractional').checked = true;
                document.getElementById('aha').checked = true;
            }

            calculateTotal();
        }

        function calculateTotal() {
            const duration = parseInt(document.getElementById('duration').value);
            const cityLevel = parseFloat(document.getElementById('cityLevel').value);

            let totalMin = 0;
            let totalMax = 0;
            let oralCost = { min: 0, max: 0 };
            let laserCost = { min: 0, max: 0 };
            let peelingCost = { min: 0, max: 0 };
            let breakdown = [];

            // 计算口服药物费用
            Object.keys(treatmentPrices.oral).forEach(key => {
                const checkbox = document.getElementById(key);
                if (checkbox && checkbox.checked) {
                    const item = treatmentPrices.oral[key];
                    const monthlyMin = item.min * cityLevel;
                    const monthlyMax = item.max * cityLevel;
                    const itemMin = monthlyMin * duration;
                    const itemMax = monthlyMax * duration;

                    oralCost.min += itemMin;
                    oralCost.max += itemMax;
                    totalMin += itemMin;
                    totalMax += itemMax;

                    breakdown.push({
                        name: item.name,
                        min: itemMin,
                        max: itemMax,
                        type: 'oral'
                    });
                }
            });

            // 计算激光治疗费用
            Object.keys(treatmentPrices.laser).forEach(key => {
                const checkbox = document.getElementById(key);
                if (checkbox && checkbox.checked) {
                    const item = treatmentPrices.laser[key];
                    const sessions = Math.ceil(duration / 3 * item.frequency / 4); // 根据周期计算疗程次数
                    const itemMin = item.min * sessions * cityLevel;
                    const itemMax = item.max * sessions * cityLevel;

                    laserCost.min += itemMin;
                    laserCost.max += itemMax;
                    totalMin += itemMin;
                    totalMax += itemMax;

                    breakdown.push({
                        name: `${item.name} (${sessions}次)`,
                        min: itemMin,
                        max: itemMax,
                        type: 'laser'
                    });
                }
            });

            // 计算刷酸治疗费用
            Object.keys(treatmentPrices.peeling).forEach(key => {
                const checkbox = document.getElementById(key);
                if (checkbox && checkbox.checked) {
                    const item = treatmentPrices.peeling[key];
                    const sessions = Math.ceil(duration / 3 * item.frequency / 4); // 根据周期计算疗程次数
                    const itemMin = item.min * sessions * cityLevel;
                    const itemMax = item.max * sessions * cityLevel;

                    peelingCost.min += itemMin;
                    peelingCost.max += itemMax;
                    totalMin += itemMin;
                    totalMax += itemMax;

                    breakdown.push({
                        name: `${item.name} (${sessions}次)`,
                        min: itemMin,
                        max: itemMax,
                        type: 'peeling'
                    });
                }
            });

            // 更新总费用显示
            const totalCostEl = document.getElementById('totalCost');
            if (totalMin === 0 && totalMax === 0) {
                totalCostEl.textContent = '¥0 - ¥0';
            } else {
                totalCostEl.textContent = `¥${totalMin.toLocaleString()} - ¥${totalMax.toLocaleString()}`;
            }

            // 更新费用明细
            const breakdownEl = document.getElementById('costBreakdown');
            if (breakdown.length === 0) {
                breakdownEl.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 30px;">请选择治疗项目</div>';
            } else {
                let html = '';
                breakdown.forEach(item => {
                    html += `
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <span style="color: #555;">${item.name}</span>
                            <span style="font-weight: bold; color: #2c3e50;">¥${item.min.toLocaleString()} - ¥${item.max.toLocaleString()}</span>
                        </div>
                    `;
                });
                breakdownEl.innerHTML = html;
            }

            // 更新费用分析
            const monthlyAvg = totalMin > 0 ? Math.round((totalMin + totalMax) / 2 / duration) : 0;
            const total = totalMin + totalMax;
            const oralPercent = total > 0 ? Math.round((oralCost.min + oralCost.max) / total * 100) : 0;
            const laserPercent = total > 0 ? Math.round((laserCost.min + laserCost.max) / total * 100) : 0;
            const peelingPercent = total > 0 ? Math.round((peelingCost.min + peelingCost.max) / total * 100) : 0;

            document.getElementById('monthlyCost').textContent = `¥${monthlyAvg.toLocaleString()}`;
            document.getElementById('oralPercent').textContent = `${oralPercent}%`;
            document.getElementById('laserPercent').textContent = `${laserPercent}%`;
            document.getElementById('peelingPercent').textContent = `${peelingPercent}%`;
        }

        function resetCalculator() {
            // 重置所有选择
            document.querySelectorAll('.treatment-checkbox input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });

            // 重置治疗类型为基础型
            document.querySelectorAll('.treatment-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.treatment-type-btn[data-type="basic"]').classList.add('active');

            // 重置周期和城市
            document.getElementById('duration').value = '6';
            document.getElementById('cityLevel').value = '1.0';

            // 重新计算
            calculateTotal();
        }

        // 治疗方案数据
        const treatmentPlans = [
            {
                id: 'economy',
                name: '经济型方案',
                costRange: '3,000-8,000元/年',
                costMin: 3000,
                costMax: 8000,
                effectiveness: '60-75%',
                effectivenessValue: 67.5,
                duration: '6-12个月',
                durationMonths: 9,
                safety: 5,
                convenience: 4,
                treatments: [
                    '外用维A酸类药物',
                    '抗生素类药膏',
                    '基础护肤品',
                    '生活方式调整'
                ],
                pros: [
                    '费用负担轻',
                    '安全性高',
                    '适合轻度痤疮',
                    '副作用小'
                ],
                cons: [
                    '见效较慢',
                    '需要长期坚持',
                    '不适合重度痤疮'
                ],
                suitable: '学生群体、轻度痤疮患者、预算有限者',
                isSpecial: false
            },
            {
                id: 'standard',
                name: '标准型方案',
                costRange: '8,000-20,000元/年',
                costMin: 8000,
                costMax: 20000,
                effectiveness: '75-85%',
                effectivenessValue: 80,
                duration: '4-8个月',
                durationMonths: 6,
                safety: 4,
                convenience: 4,
                treatments: [
                    '口服异维A酸',
                    '外用药物',
                    '定期刷酸治疗（4-6次）',
                    '医学护肤品'
                ],
                pros: [
                    '效果显著',
                    '适用范围广',
                    '性价比高',
                    '中度痤疮首选'
                ],
                cons: [
                    '需要医学监测',
                    '可能有副作用',
                    '需定期复诊'
                ],
                suitable: '中度痤疮患者、上班族、希望快速见效者',
                isSpecial: false
            },
            {
                id: 'premium',
                name: '高端型方案',
                costRange: '20,000-50,000元/年',
                costMin: 20000,
                costMax: 50000,
                effectiveness: '85-95%',
                effectivenessValue: 90,
                duration: '3-6个月',
                durationMonths: 4.5,
                safety: 4,
                convenience: 5,
                treatments: [
                    '口服药物治疗',
                    '点阵激光（4-6次）',
                    '射频微针（6-8次）',
                    '定期刷酸',
                    '高端医学护肤'
                ],
                pros: [
                    '效果最佳',
                    '见效快',
                    '全面改善肤质',
                    '专业监测'
                ],
                cons: [
                    '费用较高',
                    '需要时间配合',
                    '部分治疗有恢复期'
                ],
                suitable: '重度痤疮患者、经济条件好、追求快速效果者',
                isSpecial: false
            },
            {
                id: 'triplet',
                name: '黄金三件套',
                costRange: '25,000-60,000元/年',
                costMin: 25000,
                costMax: 60000,
                effectiveness: '90-95%',
                effectivenessValue: 92.5,
                duration: '3-6个月',
                durationMonths: 4.5,
                safety: 4,
                convenience: 4,
                treatments: [
                    '口服药物（异维A酸）',
                    '微针激光联合治疗',
                    '系统化刷酸方案',
                    '专业术后护理'
                ],
                pros: [
                    '多靶点协同',
                    '复发率最低',
                    '全面改善',
                    '效果持久'
                ],
                cons: [
                    '投入较大',
                    '治疗周期需配合',
                    '需严格遵医嘱'
                ],
                suitable: '重度囊肿性痤疮、顽固性痤疮、对效果要求高者',
                isSpecial: true
            }
        ];

        let currentPlans = [...treatmentPlans];
        let lastGagsScore = null;

        function showTreatmentComparison() {
            const modal = document.getElementById('comparisonModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            renderComparisonTable();
        }

        function closeComparisonModal() {
            const modal = document.getElementById('comparisonModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function closeComparisonAndShowSelfTest() {
            closeComparisonModal();
            setTimeout(() => showSelfTest(), 300);
        }

        function renderComparisonTable() {
            const container = document.getElementById('comparisonTable');
            const recommendedPlanId = getRecommendedPlan();

            let html = '<div class="comparison-table">';

            currentPlans.forEach(plan => {
                const isRecommended = plan.id === recommendedPlanId;
                const cardClass = `comparison-plan-card ${isRecommended ? 'recommended' : ''} ${plan.isSpecial ? 'special' : ''}`;

                html += `
                    <div class="${cardClass}" data-plan-id="${plan.id}">
                        <div class="plan-name">${plan.name}</div>
                        <div class="plan-cost">${plan.costRange}</div>

                        <div class="comparison-row">
                            <span class="comparison-label">治疗效果</span>
                            ${renderProgressBar(plan.effectivenessValue, plan.effectiveness)}
                        </div>

                        <div class="comparison-row">
                            <span class="comparison-label">治疗周期</span>
                            <div class="comparison-value">${plan.duration}</div>
                        </div>

                        <div class="comparison-row">
                            <span class="comparison-label">安全性评分</span>
                            ${renderStarRating(plan.safety)}
                        </div>

                        <div class="comparison-row">
                            <span class="comparison-label">便利程度</span>
                            ${renderStarRating(plan.convenience)}
                        </div>

                        <div class="comparison-row">
                            <span class="comparison-label">治疗项目</span>
                            <ul class="treatment-list">
                                ${plan.treatments.map(t => `<li>${t}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="pros-cons-toggle" onclick="toggleDetails('${plan.id}')">
                            <div class="pros-cons-toggle-header">
                                <span>查看优缺点</span>
                                <span id="toggle-icon-${plan.id}">▼</span>
                            </div>
                            <div class="pros-cons-content" id="details-${plan.id}">
                                <div>
                                    <strong style="color: #27ae60;">优点：</strong>
                                    <ul class="pros-list">
                                        ${plan.pros.map(p => `<li>${p}</li>`).join('')}
                                    </ul>
                                </div>
                                <div style="margin-top: 10px;">
                                    <strong style="color: #e74c3c;">缺点：</strong>
                                    <ul class="cons-list">
                                        ${plan.cons.map(c => `<li>${c}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="suitable-info">
                            <strong>适用人群：</strong><br>
                            ${plan.suitable}
                        </div>

                        <button class="consult-btn" onclick="alert('请联系专业皮肤科医生进行详细咨询')">
                            一键咨询
                        </button>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function renderProgressBar(percentage, label) {
            return `
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" style="width: ${percentage}%">
                        <span class="progress-bar-text">${label}</span>
                    </div>
                </div>
            `;
        }

        function renderStarRating(score) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += `<span class="star ${i <= score ? '' : 'empty'}">★</span>`;
            }
            return `<div class="star-rating">${stars}</div>`;
        }

        function toggleDetails(planId) {
            const content = document.getElementById(`details-${planId}`);
            const icon = document.getElementById(`toggle-icon-${planId}`);

            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.textContent = '▼';
            } else {
                content.classList.add('active');
                icon.textContent = '▲';
            }
        }

        function getRecommendedPlan() {
            // 如果没有评估数据，返回null
            if (!lastGagsScore) {
                return null;
            }

            const budgetSlider = document.getElementById('budgetSlider');
            const budget = budgetSlider ? parseInt(budgetSlider.value) : 60000;

            // 根据GAGS评分和预算推荐方案
            if (lastGagsScore <= 18) {
                return 'economy';
            } else if (lastGagsScore <= 30) {
                return budget > 15000 ? 'standard' : 'economy';
            } else if (lastGagsScore <= 38) {
                return budget > 25000 ? 'triplet' : 'standard';
            } else {
                return 'triplet';
            }
        }

        function filterPlansByBudget(value) {
            const budgetValue = document.getElementById('budgetValue');
            const budget = parseInt(value);

            if (budget >= 60000) {
                budgetValue.textContent = '¥60,000+';
            } else {
                budgetValue.textContent = `¥${budget.toLocaleString()}`;
            }

            // 筛选符合预算的方案
            currentPlans = treatmentPlans.filter(plan => plan.costMin <= budget);
            renderComparisonTable();
        }

        function sortPlans(sortBy) {
            switch(sortBy) {
                case 'effectiveness':
                    currentPlans.sort((a, b) => b.effectivenessValue - a.effectivenessValue);
                    break;
                case 'cost':
                    currentPlans.sort((a, b) => a.costMin - b.costMin);
                    break;
                case 'duration':
                    currentPlans.sort((a, b) => a.durationMonths - b.durationMonths);
                    break;
                default:
                    currentPlans = [...treatmentPlans];
            }
            renderComparisonTable();
        }

        // 搜索功能
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const cards = document.querySelectorAll('.chapter-card');

                    cards.forEach(card => {
                        const title = card.querySelector('.chapter-title').textContent.toLowerCase();
                        const desc = card.querySelector('.chapter-desc').textContent.toLowerCase();

                        if (title.includes(searchTerm) || desc.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = searchTerm ? 'none' : 'block';
                        }
                    });
                });
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', async function() {
            const toc = document.getElementById('tableOfContents');

            // 显示加载状态
            toc.innerHTML = '<div style="text-align: center; padding: 40px; color: #7f8c8d;"><div class="loading-icon icon icon--large"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2V6M12 18V22M4.93 4.93L7.76 7.76M16.24 16.24L19.07 19.07M2 12H6M18 12H22M4.93 19.07L7.76 16.24M16.24 7.76L19.07 4.93" stroke="var(--icon-color, #3498db)" stroke-width="2" stroke-linecap="round"/></svg></div><p>正在加载章节图标...</p></div>';

            try {
                // 清空加载提示，准备生成目录
                toc.innerHTML = '';

                await generateTableOfContents();
                setupSearch();
            } catch (error) {
                console.error('Failed to initialize:', error);
                toc.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;"><p>加载失败，请刷新页面重试</p></div>';
            }
        });
    </script>
    <script>
        // ========== 增强搜索功能 ==========
        const categoryData = {
            understanding: {
                title: '认识痘痘',
                chapters: ['01_true_face.md', '02_hidden_culprits.md'],
                keywords: ['成因', '类型', '分级', '发病机制', '轻度', '中度', '重度']
            },
            treatment: {
                title: '治疗方案',
                chapters: ['04_professional_treatment.md', 'medical_beauty_guide.md'],
                keywords: ['治疗', '药物', '激光', '点阵', '微针', '水杨酸', '刷酸']
            },
            daily_care: {
                title: '日常护理',
                chapters: ['05_skincare_methods.md', '06_makeup_guide.md', '08_diet_nutrition.md', '09_lifestyle_stress.md'],
                keywords: ['护肤', '化妆', '饮食', '作息', '压力管理']
            },
            psychology: {
                title: '心理支持',
                chapters: ['03_psychological_impact.md', '11_rebuild_confidence.md', '12_family_social_support.md'],
                keywords: ['心理', '自信', '焦虑', '社交', '家庭支持']
            },
            scar_repair: {
                title: '痘坑修复',
                chapters: ['07_scar_treatment.md', 'medical_beauty_guide.md'],
                keywords: ['痘坑', '痘印', '瘢痕', '修复', '小针刀']
            },
            special_groups: {
                title: '特殊人群',
                chapters: ['13_teenage_management.md', '14_adult_women_management.md'],
                keywords: ['青少年', '成年女性', '职场', '女性']
            }
        };

        function performEnhancedSearch() {
            const query = document.getElementById('enhancedSearchInput').value.trim();
            if (!query) {
                alert('请输入搜索关键词');
                return;
            }
            quickSearch(query);
        }

        function quickSearch(keyword) {
            document.getElementById('enhancedSearchInput').value = keyword;

            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div style="text-align: center; color: #667eea;"><p>🔍 搜索中...</p></div>';

            setTimeout(() => {
                // 搜索章节
                const matches = chapters.filter(chapter =>
                    chapter.title.includes(keyword) ||
                    chapter.desc.includes(keyword) ||
                    (chapter.file && chapter.file.includes(keyword.toLowerCase()))
                );

                // 搜索专题分类
                const categoryMatches = Object.entries(categoryData).filter(([key, data]) =>
                    data.keywords.some(k => k.includes(keyword) || keyword.includes(k))
                );

                // 搜索FAQ
                const faqMatches = FAQ_DATA.filter(faq =>
                    faq.question.includes(keyword) ||
                    faq.answer.includes(keyword) ||
                    faq.tags.some(tag => tag.includes(keyword) || keyword.includes(tag))
                );

                // 搜索护理指南
                const careGuideMatches = Object.entries(CARE_GUIDES).filter(([key, guide]) =>
                    guide.title.includes(keyword) ||
                    guide.projects.some(project => project.includes(keyword) || keyword.includes(project))
                );

                const totalResults = matches.length + categoryMatches.length + faqMatches.length + careGuideMatches.length;

                if (totalResults === 0) {
                    resultsDiv.innerHTML = '<div style="text-align: center; color: #95a5a6;"><p>😔 未找到相关内容</p><p style="font-size: 0.9em;">试试其他关键词，如：激光、水杨酸、心理</p></div>';
                    return;
                }

                let html = '<h4 style="color: #2c3e50; margin-bottom: 15px;">找到 ' + totalResults + ' 个相关结果：</h4>';

                // 显示章节结果
                matches.forEach(chapter => {
                    html += '<div onclick="loadChapter(\'' + chapter.file + '\', \'' + chapter.title + '\')" style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s; border-left: 4px solid #667eea;">';
                    html += '<h5 style="color: #667eea; margin-bottom: 5px;">📖 ' + chapter.title + '</h5>';
                    html += '<p style="font-size: 0.9em; color: #7f8c8d; margin: 0;">' + chapter.desc + '</p>';
                    html += '</div>';
                });

                // 显示专题分类结果
                categoryMatches.forEach(([key, data]) => {
                    html += '<div onclick="showCategoryContent(\'' + key + '\')" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer;">';
                    html += '<h5 style="color: #667eea; margin-bottom: 5px;">📁 ' + data.title + ' 专题</h5>';
                    html += '<p style="font-size: 0.9em; color: #555; margin: 0;">包含 ' + data.chapters.length + ' 个相关章节</p>';
                    html += '</div>';
                });

                // 显示FAQ结果
                faqMatches.forEach(faq => {
                    html += '<div onclick="scrollToFAQ(\'' + faq.category + '\', ' + faq.id + ')" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s;">';
                    html += '<h5 style="color: #e74c3c; margin-bottom: 5px;">❓ ' + faq.question + '</h5>';
                    html += '<p style="font-size: 0.9em; color: #555; margin: 0;">分类：' + faq.categoryName + '</p>';
                    html += '</div>';
                });

                // 显示护理指南结果
                careGuideMatches.forEach(([key, guide]) => {
                    html += '<div onclick="showCareGuide(\'' + key + '\')" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s;">';
                    html += '<h5 style="color: #e67e22; margin-bottom: 5px;">' + guide.icon + ' ' + guide.title + '</h5>';
                    html += '<p style="font-size: 0.9em; color: #555; margin: 0;">包含项目：' + guide.projects.join('、') + '</p>';
                    html += '</div>';
                });

                resultsDiv.innerHTML = html;
            }, 300);
        }

        // 滚动到FAQ问题
        function scrollToFAQ(category, faqId) {
            // 先滚动到FAQ区域
            const faqSection = document.querySelector('h2');
            if (faqSection && faqSection.textContent.includes('常见问题')) {
                faqSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // 延迟一点后打开对应的FAQ
            setTimeout(() => {
                // 渲染对应分类的FAQ
                renderFAQ(category);

                // 再延迟一点，找到对应的FAQ项并高亮
                setTimeout(() => {
                    const faqItems = document.querySelectorAll('.faq-item');
                    faqItems.forEach(item => {
                        const questionText = item.querySelector('h4');
                        const faq = FAQ_DATA.find(f => f.id === faqId);
                        if (faq && questionText && questionText.textContent.includes(faq.question)) {
                            item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            // 高亮效果
                            item.style.background = 'linear-gradient(135deg, #fff9e6 0%, #ffe6e6 100%)';
                            item.style.border = '2px solid #e74c3c';
                            setTimeout(() => {
                                item.style.background = 'white';
                                item.style.border = '1px solid #e0e0e0';
                            }, 2000);
                        }
                    });
                }, 500);
            }, 600);
        }

        function showCategoryContent(categoryKey) {
            const category = categoryData[categoryKey];
            if (!category) return;

            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            let html = '<div style="margin-bottom: 20px;">';
            html += '<h3 style="color: #2c3e50; margin-bottom: 10px;">📚 ' + category.title + '</h3>';
            html += '<p style="color: #7f8c8d; margin-bottom: 20px;">该专题包含以下章节：</p>';
            html += '</div>';

            category.chapters.forEach(chapterFile => {
                const chapter = chapters.find(c => c.file === chapterFile);
                if (chapter) {
                    html += '<div onclick="loadChapter(\'' + chapter.file + '\', \'' + chapter.title + '\')" style="background: white; padding: 18px; border-radius: 12px; margin-bottom: 12px; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 4px solid #667eea;">';
                    html += '<h4 style="color: #667eea; margin-bottom: 8px; font-size: 1.1em;">' + chapter.title + '</h4>';
                    html += '<p style="font-size: 0.9em; color: #7f8c8d; margin: 0;">' + chapter.desc + '</p>';
                    html += '</div>';
                }
            });

            html += '<button onclick="document.getElementById(\'searchResults\').style.display=\'none\'" style="width: 100%; padding: 12px; background: #f0f0f0; border: none; border-radius: 10px; cursor: pointer; margin-top: 15px;">关闭</button>';

            resultsDiv.innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('enhancedSearchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performEnhancedSearch();
                    }
                });
            }
        });

        // ========== 症状详情弹窗系统 ==========
        const SYMPTOM_DETAILS = {
            mild: {
                title: '轻度痤疮',
                emoji: '😊',
                gagsScore: '0-18分',
                color: '#56ab2f',
                description: '轻度痤疮主要表现为闭口粉刺和少量炎性丘疹，一般不会留下明显瘢痕。',
                symptoms: [
                    '闭口粉刺（白头）< 20个',
                    '开放性粉刺（黑头）< 20个',
                    '炎性丘疹 < 10个',
                    '无结节或囊肿',
                    '无明显疼痛感'
                ],
                gagsDetail: {
                    forehead: '0-2分',
                    rightCheek: '0-2分',
                    leftCheek: '0-2分',
                    nose: '0-2分',
                    chin: '0-2分',
                    chest: '0-2分'
                },
                recommendations: [
                    '定期清洁皮肤，选择温和洁面产品',
                    '使用含水杨酸或烟酰胺的护肤品',
                    '避免用手挤压痘痘',
                    '保持规律作息和健康饮食',
                    '定期进行基础医美项目维护'
                ],
                treatmentOptions: ['激光针清/湿敷舒敏/红蓝光', '博乐达水杨酸面部', '1565非剥脱点阵', '三明治祛痘嫩肤', '痘清清A']
            },
            moderate: {
                title: '中度痤疮',
                emoji: '😐',
                gagsScore: '19-30分',
                color: '#f39c12',
                description: '中度痤疮表现为较多丘疹和脓疱，可能出现少量结节，需要及时专业治疗。',
                symptoms: [
                    '粉刺数量 20-50个',
                    '炎性丘疹和脓疱 10-40个',
                    '少量结节 < 5个',
                    '偶有轻微疼痛',
                    '可能留下色素沉着'
                ],
                gagsDetail: {
                    forehead: '3-4分',
                    rightCheek: '3-4分',
                    leftCheek: '3-4分',
                    nose: '3-4分',
                    chin: '3-4分',
                    chest: '3-4分'
                },
                recommendations: [
                    '尽快就医，制定系统治疗方案',
                    '可能需要口服药物配合外用药',
                    '定期接受医美项目治疗',
                    '严格防晒，避免色素沉着加重',
                    '调整生活方式，减轻心理压力',
                    '避免使用刺激性化妆品'
                ],
                treatmentOptions: ['博乐达水杨酸面部', '小针刀剥离', '1565非剥脱点阵', '1550非剥脱点阵激光', '三明治祛痘嫩肤', '黄金微针4.0', '痘清清A', '痘清清B', '痘清清C']
            },
            severe: {
                title: '重度痤疮',
                emoji: '😟',
                gagsScore: '31-38分',
                color: '#e74c3c',
                description: '重度痤疮伴有大量结节和囊肿，炎症明显，极易留下永久性瘢痕，需要积极治疗。',
                symptoms: [
                    '粉刺数量 > 50个',
                    '炎性丘疹和脓疱 > 40个',
                    '结节和囊肿 > 5个',
                    '明显疼痛和压痛',
                    '已形成部分痘坑瘢痕',
                    '可能伴有色素沉着'
                ],
                gagsDetail: {
                    forehead: '5-8分',
                    rightCheek: '5-8分',
                    leftCheek: '5-8分',
                    nose: '5-8分',
                    chin: '5-8分',
                    chest: '5-8分'
                },
                recommendations: [
                    '立即就医，必须接受系统性治疗',
                    '需要口服药物（如异维A酸）',
                    '配合多种医美项目综合治疗',
                    '严格遵医嘱，定期复诊',
                    '做好心理辅导和支持',
                    '制定长期治疗和维护计划',
                    '术后护理至关重要'
                ],
                treatmentOptions: ['小针刀剥离', '1550非剥脱点阵激光', '二氧化碳点阵激光', '黄金微针4.0', '痘清清C', '毛孔痘坑卡1.0', '毛孔痘坑卡3.0']
            },
            'very-severe': {
                title: '极重度痤疮',
                emoji: '😰',
                gagsScore: '> 38分',
                color: '#8e44ad',
                description: '极重度痤疮为聚合性或暴发性痤疮，多处融合、炎症剧烈，会留下严重瘢痕，必须立即接受专业治疗。',
                symptoms: [
                    '大面积聚合性痤疮',
                    '多处结节囊肿融合',
                    '严重炎症和疼痛',
                    '已形成显著瘢痕',
                    '可能伴有全身症状（发热、淋巴结肿大）',
                    '心理压力巨大'
                ],
                gagsDetail: {
                    forehead: '> 8分',
                    rightCheek: '> 8分',
                    leftCheek: '> 8分',
                    nose: '> 8分',
                    chin: '> 8分',
                    chest: '> 8分'
                },
                recommendations: [
                    '紧急就医，由专业皮肤科医生制定方案',
                    '必须系统性口服药物治疗',
                    '可能需要多种医美项目联合治疗',
                    '长期治疗计划（6-12个月以上）',
                    '需要专业心理咨询支持',
                    '家庭支持和理解至关重要',
                    '严格遵医嘱，切勿自行用药',
                    '制定瘢痕修复的后续方案'
                ],
                treatmentOptions: ['二氧化碳点阵激光', '黄金微针4.0', '毛孔痘坑卡1.0', '毛孔痘坑卡3.0']
            }
        };

        function showSymptomDetail(severity) {
            const detail = SYMPTOM_DETAILS[severity];
            if (!detail) return;

            const modal = document.getElementById('symptomDetailModal');
            const modalBody = document.getElementById('symptomDetailModalBody');

            // 从ACNE_REAL_DATA中筛选推荐的治疗方案
            const recommendedItems = [];
            detail.treatmentOptions.forEach(optionName => {
                // 在singleItems中查找
                const singleItem = ACNE_REAL_DATA.singleItems.find(item => item.name === optionName);
                if (singleItem) {
                    recommendedItems.push({ ...singleItem, type: 'single' });
                }
                // 在packages中查找
                const packageItem = ACNE_REAL_DATA.packages.find(pkg => pkg.name === optionName);
                if (packageItem) {
                    recommendedItems.push({ ...packageItem, type: 'package' });
                }
            });

            let content = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 4em; margin-bottom: 15px;">${detail.emoji}</div>
                    <h2 style="color: ${detail.color}; font-size: 2em; margin-bottom: 10px;">${detail.title}</h2>
                    <div style="display: inline-block; background: ${detail.color}; color: white; padding: 8px 20px; border-radius: 20px; font-weight: bold;">
                        GAGS评分：${detail.gagsScore}
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px; border-left: 4px solid ${detail.color};">
                    <p style="color: #2c3e50; line-height: 1.8; margin: 0; font-size: 1.05em;">${detail.description}</p>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${detail.color};">
                        📋 典型症状特征
                    </h3>
                    <div style="display: grid; gap: 10px;">
                        ${detail.symptoms.map(symptom => `
                            <div style="background: white; padding: 12px 18px; border-radius: 8px; border-left: 3px solid ${detail.color};">
                                <span style="color: ${detail.color}; margin-right: 8px;">•</span>
                                <span style="color: #34495e;">${symptom}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${detail.color};">
                        📊 GAGS分区评分标准
                    </h3>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            ${Object.entries(detail.gagsDetail).map(([area, score]) => {
                                const areaNames = {
                                    forehead: '额头',
                                    rightCheek: '右脸颊',
                                    leftCheek: '左脸颊',
                                    nose: '鼻部',
                                    chin: '下巴',
                                    chest: '胸背部'
                                };
                                return `
                                    <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, ${detail.color}15 0%, ${detail.color}30 100%); border-radius: 10px;">
                                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">${areaNames[area]}</div>
                                        <div style="font-size: 1.3em; color: ${detail.color}; font-weight: bold;">${score}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${detail.color};">
                        💡 治疗建议
                    </h3>
                    <div style="display: grid; gap: 10px;">
                        ${detail.recommendations.map((rec, idx) => `
                            <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; align-items: start; gap: 12px;">
                                <div style="background: ${detail.color}; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">
                                    ${idx + 1}
                                </div>
                                <div style="color: #34495e; line-height: 1.6; flex: 1;">${rec}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${detail.color};">
                        🏥 推荐治疗项目
                    </h3>
                    <div style="display: grid; gap: 15px;">
                        ${recommendedItems.map(item => {
                            const displayPrice = item.type === 'single'
                                ? `¥${item.price_single} / 单次`
                                : `¥${item.price_single} / 单次`;
                            const categoryLabel = item.category || item.level;
                            return `
                                <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 15px rgba(0,0,0,0.08); border-top: 3px solid ${detail.color};">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                        <div>
                                            <h4 style="color: #2c3e50; margin: 0 0 8px 0; font-size: 1.2em;">${item.name}</h4>
                                            <span style="display: inline-block; background: ${detail.color}15; color: ${detail.color}; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold;">
                                                ${categoryLabel}
                                            </span>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 1.5em; font-weight: bold; color: ${detail.color};">${displayPrice}</div>
                                        </div>
                                    </div>
                                    <p style="color: #7f8c8d; line-height: 1.6; margin: 12px 0;">${item.desc || item.详细说明}</p>
                                    ${item.duration ? `
                                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee; display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.9em;">
                                            <span style="color: #95a5a6;">⏱ ${item.duration}</span>
                                            <span style="color: #95a5a6;">🔄 ${item.recovery}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; border-left: 4px solid #ffc107; margin-top: 30px;">
                    <div style="font-weight: bold; color: #856404; margin-bottom: 10px; font-size: 1.1em;">⚠️ 重要提示</div>
                    <div style="color: #856404; line-height: 1.7;">
                        以上信息仅供参考，不能替代专业医疗诊断。每个人的皮肤状况不同，具体治疗方案需要由专业医生根据您的实际情况制定。请务必预约皮肤科医生进行详细检查和评估。
                    </div>
                </div>
            `;

            modalBody.innerHTML = content;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeSymptomModal() {
            const modal = document.getElementById('symptomDetailModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // 点击背景关闭弹窗
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('symptomDetailModal');
            if (e.target === modal) {
                closeSymptomModal();
            }
        });

        // ========== 智能治疗方案推荐系统 ==========
        function calculateGAGS() {
            // 获取各部位评分
            const forehead = parseInt(document.getElementById('forehead').value);
            const rightCheek = parseInt(document.getElementById('rightCheek').value);
            const leftCheek = parseInt(document.getElementById('leftCheek').value);
            const nose = parseInt(document.getElementById('nose').value);
            const chin = parseInt(document.getElementById('chin').value);
            const chest = parseInt(document.getElementById('chest').value);

            // 计算GAGS总分（考虑权重）
            const total = (forehead * 2) + (rightCheek * 2) + (leftCheek * 2) + (nose * 1) + (chin * 1) + (chest * 3);

            // 确定严重程度
            let severity, severityText, severityColor, severityEmoji;
            if (total === 0) {
                severity = 'none';
                severityText = '暂无评估';
                severityColor = '#95a5a6';
                severityEmoji = '😊';
            } else if (total <= 18) {
                severity = 'mild';
                severityText = '轻度痤疮';
                severityColor = '#56ab2f';
                severityEmoji = '😊';
            } else if (total <= 30) {
                severity = 'moderate';
                severityText = '中度痤疮';
                severityColor = '#f39c12';
                severityEmoji = '😐';
            } else if (total <= 38) {
                severity = 'severe';
                severityText = '重度痤疮';
                severityColor = '#e74c3c';
                severityEmoji = '😟';
            } else {
                severity = 'very-severe';
                severityText = '极重度痤疮';
                severityColor = '#8e44ad';
                severityEmoji = '😰';
            }

            // 更新总分显示
            document.getElementById('gagsTotal').textContent = total;
            document.getElementById('gagsSeverity').textContent = severityText;

            // 生成推荐方案
            if (total === 0) {
                showEmptyRecommendation();
            } else {
                showRecommendations(severity, severityText, severityColor, severityEmoji, total);
            }
        }

        function showEmptyRecommendation() {
            const resultsDiv = document.getElementById('recommendationResults');
            resultsDiv.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 400px; color: #95a5a6;">
                    <div style="font-size: 4em; margin-bottom: 15px;">✅</div>
                    <div style="font-size: 1.1em; text-align: center; line-height: 1.6;">
                        恭喜！您当前没有明显的痤疮问题<br>
                        继续保持良好的生活习惯和护肤习惯
                    </div>
                </div>
            `;
        }

        function showRecommendations(severity, severityText, severityColor, severityEmoji, totalScore) {
            // 根据严重程度筛选推荐项目
            const recommendedSingleItems = ACNE_REAL_DATA.singleItems.filter(item =>
                item.severity && item.severity.includes(severity === 'mild' ? '轻度' :
                                                         severity === 'moderate' ? '中度' :
                                                         severity === 'severe' ? '重度' : '极重度')
            );

            const recommendedPackages = ACNE_REAL_DATA.packages.filter(pkg =>
                pkg.severity && pkg.severity.includes(severity === 'mild' ? '轻度' :
                                                       severity === 'moderate' ? '中度' :
                                                       severity === 'severe' ? '重度' : '极重度')
            );

            const resultsDiv = document.getElementById('recommendationResults');

            let content = `
                <!-- 评估结果卡片 -->
                <div style="background: linear-gradient(135deg, ${severityColor}15 0%, ${severityColor}30 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border-left: 4px solid ${severityColor};">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 3em;">${severityEmoji}</div>
                        <div>
                            <h4 style="color: ${severityColor}; font-size: 1.4em; margin: 0 0 5px 0;">${severityText}</h4>
                            <div style="color: #2c3e50; font-size: 0.95em;">GAGS评分：${totalScore}分</div>
                        </div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">💡 治疗建议：</div>
                        <div style="color: #555; line-height: 1.6; font-size: 0.95em;">
                            ${getSeverityAdvice(severity)}
                        </div>
                    </div>
                </div>

                <!-- 推荐单品 -->
                ${recommendedSingleItems.length > 0 ? `
                    <div style="margin-bottom: 25px;">
                        <h5 style="color: #2c3e50; font-size: 1.1em; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid ${severityColor};">
                            🏥 推荐单项治疗
                        </h5>
                        <div style="display: grid; gap: 12px;">
                            ${recommendedSingleItems.slice(0, 3).map(item => `
                                <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 3px solid ${severityColor}; position: relative;">
                                    <!-- 收藏按钮 -->
                                    <button
                                        onclick="event.stopPropagation(); const success = addBookmark('treatment', ${JSON.stringify(item)}); this.textContent = success ? '⭐' : '☆';"
                                        style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 1.5em; cursor: pointer; padding: 5px; transition: transform 0.2s;"
                                        onmouseover="this.style.transform='scale(1.2)'"
                                        onmouseout="this.style.transform='scale(1)'"
                                        title="收藏">
                                        ${isBookmarked('treatment', item.id) ? '⭐' : '☆'}
                                    </button>
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; padding-right: 35px;">
                                        <div>
                                            <h6 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 1.05em;">${item.name}</h6>
                                            <span style="background: ${severityColor}15; color: ${severityColor}; padding: 3px 10px; border-radius: 10px; font-size: 0.8em; font-weight: bold;">
                                                ${item.category}
                                            </span>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: ${severityColor}; font-weight: bold; font-size: 1.2em;">¥${item.price_single}</div>
                                            <div style="font-size: 0.75em; color: #95a5a6;">单次</div>
                                        </div>
                                    </div>
                                    <p style="color: #7f8c8d; font-size: 0.9em; margin: 8px 0; line-height: 1.5;">${item.desc}</p>
                                    <div style="display: flex; gap: 10px; margin-top: 10px; font-size: 0.85em; color: #95a5a6;">
                                        <span>⏱ ${item.duration}</span>
                                        <span>🔄 ${item.recovery}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <!-- 推荐套餐 -->
                ${recommendedPackages.length > 0 ? `
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #2c3e50; font-size: 1.1em; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid ${severityColor};">
                            📦 推荐组合套餐
                        </h5>
                        <div style="display: grid; gap: 12px;">
                            ${recommendedPackages.slice(0, 2).map(pkg => `
                                <div style="background: linear-gradient(135deg, ${severityColor}08 0%, ${severityColor}15 100%); padding: 15px; border-radius: 10px; border: 2px solid ${severityColor}30; position: relative;">
                                    <!-- 收藏按钮 -->
                                    <button
                                        onclick="event.stopPropagation(); const success = addBookmark('treatment', ${JSON.stringify(pkg)}); this.textContent = success ? '⭐' : '☆';"
                                        style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 1.5em; cursor: pointer; padding: 5px; transition: transform 0.2s;"
                                        onmouseover="this.style.transform='scale(1.2)'"
                                        onmouseout="this.style.transform='scale(1)'"
                                        title="收藏">
                                        ${isBookmarked('treatment', pkg.id) ? '⭐' : '☆'}
                                    </button>
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; padding-right: 35px;">
                                        <div>
                                            <h6 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 1.05em;">${pkg.name}</h6>
                                            <span style="background: ${severityColor}; color: white; padding: 3px 10px; border-radius: 10px; font-size: 0.8em; font-weight: bold;">
                                                ${pkg.level}
                                            </span>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="color: ${severityColor}; font-weight: bold; font-size: 1.3em;">¥${pkg.price_single}</div>
                                            <div style="font-size: 0.75em; color: #95a5a6;">单次</div>
                                        </div>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 0.9em; color: #555;">
                                        <strong>包含项目：</strong>${pkg.items}
                                    </div>
                                    <p style="color: #7f8c8d; font-size: 0.9em; margin: 8px 0; line-height: 1.5;">${pkg.desc}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <!-- 查看更多按钮 -->
                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="window.location.href='treatments.html'" style="background: linear-gradient(135deg, ${severityColor} 0%, ${severityColor}dd 100%); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1em; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px ${severityColor}40;">
                        查看所有治疗项目 →
                    </button>
                </div>

                <!-- 温馨提示 -->
                <div style="margin-top: 25px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
                    <div style="font-weight: bold; color: #856404; margin-bottom: 5px;">⚠️ 重要提示</div>
                    <div style="color: #856404; font-size: 0.9em; line-height: 1.6;">
                        以上推荐基于GAGS评分标准，仅供参考。实际治疗方案需要由专业医生根据您的具体情况制定，请务必预约专业皮肤科医生进行面诊。
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = content;
        }

        function getSeverityAdvice(severity) {
            const adviceMap = {
                'mild': '轻度痤疮建议采用温和的治疗方式，如激光针清、红蓝光或水杨酸等基础项目。同时注意日常护肤，使用温和的洁面产品，避免用手挤压痘痘。',
                'moderate': '中度痤疮建议尽快就医，制定系统治疗方案。可能需要口服药物配合医美项目治疗。定期接受激光或刷酸治疗，严格防晒，避免色素沉着加重。',
                'severe': '重度痤疮需要立即就医，必须接受系统性治疗。需要口服药物（如异维A酸）配合多种医美项目综合治疗。严格遵医嘱，定期复诊，做好心理辅导和术后护理。',
                'very-severe': '极重度痤疮属于紧急情况，必须由专业皮肤科医生制定方案。需要系统性口服药物治疗，配合多种医美项目联合治疗。需要长期治疗计划（6-12个月以上），并制定瘢痕修复的后续方案。'
            };
            return adviceMap[severity] || '';
        }

        // ========== 互动式治疗决策树 ==========
        const DECISION_TREE_QUESTIONS = [
            {
                id: 1,
                question: '您的主要治疗目标是什么？',
                emoji: '🎯',
                options: [
                    { value: 'acne', label: '控制活动性痘痘', desc: '减少新痘痘生成，消炎去红' },
                    { value: 'scar', label: '修复痘坑痘印', desc: '改善已有的痘坑和色素沉着' },
                    { value: 'skin', label: '改善整体肤质', desc: '提升肤质、缩小毛孔、改善粗糙' },
                    { value: 'all', label: '综合改善', desc: '控痘+修复+肤质全面提升' }
                ]
            },
            {
                id: 2,
                question: '您的单次治疗预算范围是？',
                emoji: '💰',
                options: [
                    { value: 'low', label: '500元以内', desc: '基础治疗项目' },
                    { value: 'medium', label: '500-1500元', desc: '常规医美项目' },
                    { value: 'high', label: '1500-3000元', desc: '高端治疗项目' },
                    { value: 'premium', label: '3000元以上', desc: '顶级综合方案' }
                ]
            },
            {
                id: 3,
                question: '您对恢复期的要求是？',
                emoji: '⏱️',
                options: [
                    { value: 'none', label: '无恢复期', desc: '治疗后可立即工作生活' },
                    { value: 'short', label: '1-3天', desc: '可接受轻微红肿' },
                    { value: 'medium', label: '3-7天', desc: '可接受结痂脱皮' },
                    { value: 'long', label: '可接受更长', desc: '效果优先，恢复期不限' }
                ]
            },
            {
                id: 4,
                question: '您对治疗过程中的痛感接受度？',
                emoji: '😣',
                options: [
                    { value: 'no', label: '完全不能接受疼痛', desc: '只接受无痛或微痛治疗' },
                    { value: 'mild', label: '轻微疼痛可以', desc: '类似针刺的轻微不适' },
                    { value: 'moderate', label: '中度疼痛可以', desc: '能忍受一定程度疼痛' },
                    { value: 'high', label: '效果优先无所谓', desc: '为了效果可以忍受' }
                ]
            },
            {
                id: 5,
                question: '您希望的治疗频率是？',
                emoji: '📅',
                options: [
                    { value: 'once', label: '希望单次见效', desc: '尽量一次解决问题' },
                    { value: 'few', label: '可以做3-5次', desc: '接受短疗程治疗' },
                    { value: 'many', label: '可以做6次以上', desc: '接受完整疗程' },
                    { value: 'maintain', label: '长期维护', desc: '愿意长期定期治疗' }
                ]
            },
            {
                id: 6,
                question: '您的皮肤敏感程度？',
                emoji: '🌡️',
                options: [
                    { value: 'sensitive', label: '敏感肌', desc: '容易过敏泛红' },
                    { value: 'normal', label: '正常肌肤', desc: '一般护肤品都能用' },
                    { value: 'tolerant', label: '耐受性好', desc: '皮肤比较皮实' }
                ]
            }
        ];

        let dtCurrentQuestion = 0;
        let dtAnswers = {};

        function startDecisionTree() {
            dtCurrentQuestion = 0;
            dtAnswers = {};
            document.getElementById('dtStart').style.display = 'none';
            document.getElementById('dtQuestions').style.display = 'block';
            showQuestion(0);
        }

        function showQuestion(index) {
            const question = DECISION_TREE_QUESTIONS[index];
            const content = document.getElementById('dtQuestionContent');

            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 4em; margin-bottom: 15px;">${question.emoji}</div>
                    <h4 style="color: #2c3e50; font-size: 1.4em; margin-bottom: 10px;">${question.question}</h4>
                </div>

                <div style="display: grid; gap: 12px;">
                    ${question.options.map((opt, idx) => `
                        <div class="dt-option" data-value="${opt.value}" onclick="selectOption(${index}, '${opt.value}')" style="background: white; border: 2px solid #e0e0e0; padding: 18px; border-radius: 12px; cursor: pointer; transition: all 0.3s; ${dtAnswers[question.id] === opt.value ? 'border-color: #667eea; background: #667eea10;' : ''}">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 24px; height: 24px; border: 2px solid ${dtAnswers[question.id] === opt.value ? '#667eea' : '#ccc'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.3s;">
                                    ${dtAnswers[question.id] === opt.value ? '<div style="width: 14px; height: 14px; background: #667eea; border-radius: 50%;"></div>' : ''}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 4px;">${opt.label}</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d;">${opt.desc}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            // 更新进度
            document.getElementById('dtProgress').textContent = `${index + 1}/6`;
            document.getElementById('dtProgressBar').style.width = `${((index + 1) / 6) * 100}%`;

            // 更新导航按钮
            const prevBtn = document.getElementById('dtPrevBtn');
            const nextBtn = document.getElementById('dtNextBtn');

            prevBtn.style.display = index > 0 ? 'block' : 'none';

            if (dtAnswers[question.id]) {
                nextBtn.disabled = false;
                nextBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                nextBtn.style.cursor = 'pointer';
                if (index === 5) {
                    nextBtn.textContent = '查看推荐 →';
                } else {
                    nextBtn.textContent = '下一题 →';
                }
            } else {
                nextBtn.disabled = true;
                nextBtn.style.background = '#ccc';
                nextBtn.style.cursor = 'not-allowed';
            }
        }

        function selectOption(questionIndex, value) {
            const question = DECISION_TREE_QUESTIONS[questionIndex];
            dtAnswers[question.id] = value;

            // 更新UI
            const options = document.querySelectorAll('.dt-option');
            options.forEach(opt => {
                if (opt.dataset.value === value) {
                    opt.style.borderColor = '#667eea';
                    opt.style.background = '#667eea10';
                    const radio = opt.querySelector('div > div > div');
                    if (radio.parentElement) {
                        radio.parentElement.style.borderColor = '#667eea';
                        radio.innerHTML = '<div style="width: 14px; height: 14px; background: #667eea; border-radius: 50%;"></div>';
                    }
                } else {
                    opt.style.borderColor = '#e0e0e0';
                    opt.style.background = 'white';
                    const radio = opt.querySelector('div > div > div');
                    if (radio.parentElement) {
                        radio.parentElement.style.borderColor = '#ccc';
                        radio.innerHTML = '';
                    }
                }
            });

            // 启用下一题按钮
            const nextBtn = document.getElementById('dtNextBtn');
            nextBtn.disabled = false;
            nextBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            nextBtn.style.cursor = 'pointer';
            if (questionIndex === 5) {
                nextBtn.textContent = '查看推荐 →';
            }
        }

        function previousQuestion() {
            if (dtCurrentQuestion > 0) {
                dtCurrentQuestion--;
                showQuestion(dtCurrentQuestion);
            }
        }

        function nextQuestion() {
            if (dtCurrentQuestion < 5) {
                dtCurrentQuestion++;
                showQuestion(dtCurrentQuestion);
            } else {
                // 显示结果
                showDecisionTreeResults();
            }
        }

        function showDecisionTreeResults() {
            document.getElementById('dtQuestions').style.display = 'none';

            // 根据用户回答筛选推荐项目
            const recommendations = getRecommendationsFromAnswers(dtAnswers);

            const resultsDiv = document.getElementById('dtResults');
            resultsDiv.style.display = 'block';

            resultsDiv.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 5em; margin-bottom: 15px;">✨</div>
                    <h4 style="color: #2c3e50; font-size: 1.6em; margin-bottom: 10px;">为您定制的治疗方案</h4>
                    <p style="color: #7f8c8d;">基于您的需求和条件，我们为您推荐以下方案</p>
                </div>

                <!-- 用户画像总结 -->
                <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba230 100%); padding: 25px; border-radius: 15px; margin-bottom: 30px; border-left: 4px solid #667eea;">
                    <h5 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.2em;">📋 您的需求总结</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        ${getSummaryItems(dtAnswers).map(item => `
                            <div style="background: white; padding: 12px; border-radius: 8px;">
                                <div style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 4px;">${item.label}</div>
                                <div style="font-weight: bold; color: #2c3e50;">${item.value}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                ${recommendations.recommended.length > 0 ? `
                    <div style="margin-bottom: 30px;">
                        <h5 style="color: #2c3e50; font-size: 1.2em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #667eea;">
                            ⭐ 最推荐方案
                        </h5>
                        <div style="display: grid; gap: 15px;">
                            ${recommendations.recommended.slice(0, 3).map(item => generateItemCard(item, '#667eea', true)).join('')}
                        </div>
                    </div>
                ` : ''}

                ${recommendations.alternative.length > 0 ? `
                    <div style="margin-bottom: 30px;">
                        <h5 style="color: #2c3e50; font-size: 1.2em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #00b894;">
                            💡 备选方案
                        </h5>
                        <div style="display: grid; gap: 12px;">
                            ${recommendations.alternative.slice(0, 2).map(item => generateItemCard(item, '#00b894', false)).join('')}
                        </div>
                    </div>
                ` : ''}

                <!-- 专业建议 -->
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; border-left: 4px solid #ffc107; margin-bottom: 25px;">
                    <div style="font-weight: bold; color: #856404; margin-bottom: 10px;">💡 专业建议</div>
                    <div style="color: #856404; line-height: 1.7; font-size: 0.95em;">
                        ${getPersonalizedAdvice(dtAnswers)}
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button onclick="restartDecisionTree()" style="background: #f0f0f0; color: #666; border: none; padding: 12px 30px; border-radius: 20px; font-size: 1em; cursor: pointer; font-weight: bold;">
                        🔄 重新测试
                    </button>
                    <button onclick="window.location.href='treatments.html'" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 20px; font-size: 1em; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(102,126,234,0.3);">
                        查看价格详情 →
                    </button>
                </div>
            `;
        }

        function getRecommendationsFromAnswers(answers) {
            const recommended = [];
            const alternative = [];

            ACNE_REAL_DATA.singleItems.forEach(item => {
                let score = 0;

                // 根据治疗目标评分
                if (answers[1] === 'acne' && ['基础治疗', '刷酸治疗', '综合治疗'].includes(item.category)) score += 3;
                if (answers[1] === 'scar' && ['痘坑修复', '激光治疗', '射频微针'].includes(item.category)) score += 3;
                if (answers[1] === 'skin' && ['激光治疗', '综合治疗'].includes(item.category)) score += 2;
                if (answers[1] === 'all') score += 1;

                // 根据预算评分
                if (answers[2] === 'low' && item.price_single <= 500) score += 3;
                if (answers[2] === 'medium' && item.price_single > 500 && item.price_single <= 1500) score += 3;
                if (answers[2] === 'high' && item.price_single > 1500 && item.price_single <= 3000) score += 3;
                if (answers[2] === 'premium' && item.price_single > 3000) score += 3;

                // 根据恢复期评分
                if (answers[3] === 'none' && item.recovery === '无恢复期') score += 2;
                if (answers[3] === 'short' && (item.recovery.includes('1-3天') || item.recovery.includes('2-3天') || item.recovery.includes('2-4天'))) score += 2;
                if (answers[3] === 'medium' && item.recovery.includes('天')) score += 1;

                if (score >= 5) {
                    recommended.push({ ...item, score });
                } else if (score >= 3) {
                    alternative.push({ ...item, score });
                }
            });

            // 排序
            recommended.sort((a, b) => b.score - a.score);
            alternative.sort((a, b) => b.score - a.score);

            return { recommended, alternative };
        }

        function getSummaryItems(answers) {
            const labels = {
                1: { label: '治疗目标', values: { acne: '控制痘痘', scar: '修复痘坑', skin: '改善肤质', all: '综合改善' } },
                2: { label: '预算范围', values: { low: '500元内', medium: '500-1500元', high: '1500-3000元', premium: '3000元以上' } },
                3: { label: '恢复期', values: { none: '无恢复期', short: '1-3天', medium: '3-7天', long: '可接受更长' } },
                4: { label: '痛感接受', values: { no: '不能接受', mild: '轻微可以', moderate: '中度可以', high: '无所谓' } },
                5: { label: '治疗频率', values: { once: '单次见效', few: '3-5次', many: '6次以上', maintain: '长期维护' } },
                6: { label: '皮肤类型', values: { sensitive: '敏感肌', normal: '正常肌肤', tolerant: '耐受性好' } }
            };

            return Object.keys(answers).map(key => ({
                label: labels[key].label,
                value: labels[key].values[answers[key]]
            }));
        }

        function generateItemCard(item, color, isHighlight) {
            return `
                <div style="background: ${isHighlight ? `linear-gradient(135deg, ${color}08 0%, ${color}15 100%)` : 'white'}; border: 2px solid ${isHighlight ? color : '#e0e0e0'}; padding: 20px; border-radius: 12px; box-shadow: ${isHighlight ? `0 4px 20px ${color}20` : '0 2px 10px rgba(0,0,0,0.05)'};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <h6 style="color: #2c3e50; margin: 0 0 8px 0; font-size: 1.2em;">${item.name}</h6>
                            <span style="background: ${color}; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold;">
                                ${item.category}
                            </span>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: ${color}; font-weight: bold; font-size: 1.4em;">¥${item.price_single}</div>
                            <div style="font-size: 0.8em; color: #95a5a6;">单次</div>
                        </div>
                    </div>
                    <p style="color: #7f8c8d; font-size: 0.95em; margin: 12px 0; line-height: 1.6;">${item.desc}</p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                        <div>
                            <div style="font-size: 0.85em; color: #95a5a6; margin-bottom: 4px;">⏱ 疗程</div>
                            <div style="font-size: 0.9em; color: #2c3e50; font-weight: bold;">${item.duration}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.85em; color: #95a5a6; margin-bottom: 4px;">🔄 恢复期</div>
                            <div style="font-size: 0.9em; color: #2c3e50; font-weight: bold;">${item.recovery}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getPersonalizedAdvice(answers) {
            let advice = [];

            if (answers[2] === 'low') {
                advice.push('根据您的预算，建议从基础治疗项目开始，循序渐进。');
            }
            if (answers[3] === 'none') {
                advice.push('您选择无恢复期的项目，这类项目通常需要多次治疗才能见效，请保持耐心。');
            }
            if (answers[6] === 'sensitive') {
                advice.push('敏感肌肤建议先做局部测试，选择温和的治疗方式，避免过度刺激。');
            }
            if (answers[5] === 'once') {
                advice.push('单次见效的期望可能较难实现，痤疮治疗通常需要一个疗程（3-6次）才能达到理想效果。');
            }

            if (advice.length === 0) {
                advice.push('建议您先预约专业医生进行面诊，根据实际皮肤状况制定详细治疗方案。治疗期间请遵医嘱，配合日常护肤，保持良好的生活习惯。');
            }

            return advice.join(' ');
        }

        function restartDecisionTree() {
            dtCurrentQuestion = 0;
            dtAnswers = {};
            document.getElementById('dtResults').style.display = 'none';
            document.getElementById('dtStart').style.display = 'block';
        }

        // ========== 前后对比案例展示系统 ==========
        const BEFORE_AFTER_CASES = [
            {
                id: 1,
                severity: 'mild',
                age: 22,
                gender: '女',
                treatment: '激光针清 + 红蓝光',
                sessions: 5,
                duration: '2个月',
                beforeDesc: '额头和下巴有较多闭口粉刺，偶尔出现红肿痘痘',
                afterDesc: '闭口明显减少，肤质变得光滑细腻，新痘痘很少冒出',
                improvement: '85%',
                cost: '约1500元',
                review: '效果超出预期！坚持治疗真的有用，现在皮肤状态好多了。',
                tags: ['轻度痤疮', '闭口粉刺', '基础治疗']
            },
            {
                id: 2,
                severity: 'moderate',
                age: 25,
                gender: '女',
                treatment: '博乐达水杨酸 + 1565点阵激光',
                sessions: 6,
                duration: '3个月',
                beforeDesc: '两侧脸颊有大量丘疹和脓疱，部分有红色痘印',
                afterDesc: '痘痘基本消退，痘印淡化明显，毛孔缩小，肤色更均匀',
                improvement: '90%',
                cost: '约5800元',
                review: '医生很专业，方案制定合理。虽然花了点钱，但看到效果觉得很值得。',
                tags: ['中度痤疮', '丘疹脓疱', '综合治疗']
            },
            {
                id: 3,
                severity: 'severe',
                age: 28,
                gender: '男',
                treatment: '口服药物 + 黄金微针 + CO2点阵',
                sessions: 8,
                duration: '6个月',
                beforeDesc: '全脸大量结节囊肿，部分融合，已形成明显痘坑',
                afterDesc: '结节囊肿消退，痘坑明显变浅，整体肤质改善很大',
                improvement: '80%',
                cost: '约15000元',
                review: '治疗过程比较漫长，但医生一直很耐心。现在终于敢抬头见人了。',
                tags: ['重度痤疮', '结节囊肿', '长期治疗']
            },
            {
                id: 4,
                severity: 'scar',
                age: 26,
                gender: '女',
                treatment: '小针刀剥离 + CO2点阵 + 1550点阵',
                sessions: 10,
                duration: '8个月',
                beforeDesc: '脸颊有大量冰锥型和车厢型痘坑，非常明显',
                afterDesc: '痘坑深度明显变浅，部分浅层痘坑基本看不出来了',
                improvement: '70%',
                cost: '约20000元',
                review: '痘坑治疗确实需要耐心和投入，但看到一点点变好还是很开心的。',
                tags: ['痘坑修复', '瘢痕治疗', '高端治疗']
            },
            {
                id: 5,
                severity: 'moderate',
                age: 20,
                gender: '女',
                treatment: '三明治祛痘嫩肤',
                sessions: 4,
                duration: '1.5个月',
                beforeDesc: '鼻子和额头油脂分泌旺盛，有较多黑头和白头',
                afterDesc: '出油明显减少，黑头白头改善，皮肤不再那么粗糙',
                improvement: '75%',
                cost: '约4000元',
                review: '作为学生党预算有限，选了性价比高的项目，效果还不错。',
                tags: ['中度痤疮', '油性皮肤', '控油治疗']
            },
            {
                id: 6,
                severity: 'mild',
                age: 24,
                gender: '男',
                treatment: '红蓝光 + 湿敷舒敏',
                sessions: 6,
                duration: '2个月',
                beforeDesc: '下巴和鼻翼两侧反复长痘，有轻微炎症',
                afterDesc: '痘痘反复的情况明显改善，皮肤没那么容易发红了',
                improvement: '80%',
                cost: '约1200元',
                review: '温和的治疗方式，没有恢复期，很适合上班族。',
                tags: ['轻度痤疮', '反复长痘', '无恢复期']
            },
            {
                id: 7,
                severity: 'severe',
                age: 30,
                gender: '女',
                treatment: '口服异维A酸 + 痘清清C套餐',
                sessions: 12,
                duration: '10个月',
                beforeDesc: '多年痤疮史，反复发作，脸颊和下巴有大量结节',
                afterDesc: '终于控制住了！新痘痘很少，旧痘坑也在逐步修复中',
                improvement: '85%',
                cost: '约18000元',
                review: '这么多年终于找到了适合自己的治疗方案，非常感谢医生的坚持。',
                tags: ['重度痤疮', '反复发作', '系统治疗']
            },
            {
                id: 8,
                severity: 'scar',
                age: 27,
                gender: '男',
                treatment: '毛孔痘坑卡3.0 顶级套餐',
                sessions: 6,
                duration: '5个月',
                beforeDesc: '太阳穴和脸颊有严重痘坑，影响外观和自信',
                afterDesc: '痘坑填平了很多，化妆后基本看不出来，很满意',
                improvement: '75%',
                cost: '约28000元',
                review: '投资值得！现在照镜子都有信心了，工作面试也更有底气。',
                tags: ['痘坑修复', '严重瘢痕', '顶级方案']
            }
        ];

        let currentFilter = 'all';

        // 页面加载时初始化案例展示
        document.addEventListener('DOMContentLoaded', function() {
            renderCases('all');
            initTimelineTreatmentSelect();
        });

        function filterCases(filter) {
            currentFilter = filter;

            // 更新按钮状态
            document.querySelectorAll('.case-filter-btn').forEach(btn => {
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // 重新渲染案例
            renderCases(filter);
        }

        function renderCases(filter) {
            const grid = document.getElementById('casesGrid');
            let filteredCases = BEFORE_AFTER_CASES;

            if (filter !== 'all') {
                filteredCases = BEFORE_AFTER_CASES.filter(c => c.severity === filter);
            }

            if (filteredCases.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #95a5a6;">
                        <div style="font-size: 4em; margin-bottom: 15px;">🔍</div>
                        <div style="font-size: 1.1em;">暂无该类型案例</div>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredCases.map(caseItem => `
                <div class="case-card" onclick="showCaseDetail(${caseItem.id})" data-severity="${caseItem.severity}">
                    <!-- 前后对比图片区域 -->
                    <div class="before-after-container">
                        <div class="before-after-images">
                            <div class="before-image">
                                <span class="image-label">治疗前</span>
                                😟
                            </div>
                            <div class="after-image">
                                <span class="image-label">治疗后</span>
                                😊
                            </div>
                        </div>
                    </div>

                    <!-- 案例信息 -->
                    <div style="padding: 20px;">
                        <!-- 标签 -->
                        <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
                            ${caseItem.tags.map(tag => `
                                <span style="background: ${getSeverityColor(caseItem.severity)}15; color: ${getSeverityColor(caseItem.severity)}; padding: 4px 10px; border-radius: 12px; font-size: 0.8em; font-weight: bold;">
                                    ${tag}
                                </span>
                            `).join('')}
                        </div>

                        <!-- 基本信息 -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 12px; font-size: 0.9em; color: #7f8c8d;">
                            <div>👤 ${caseItem.age}岁 ${caseItem.gender}</div>
                            <div>⏱ ${caseItem.duration}</div>
                            <div>🔢 ${caseItem.sessions}次治疗</div>
                            <div>💰 ${caseItem.cost}</div>
                        </div>

                        <!-- 治疗方案 -->
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            <div style="font-size: 0.85em; color: #95a5a6; margin-bottom: 4px;">治疗方案</div>
                            <div style="color: #2c3e50; font-weight: bold; font-size: 0.95em;">${caseItem.treatment}</div>
                        </div>

                        <!-- 改善程度 -->
                        <div style="margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9em;">
                                <span style="color: #7f8c8d;">改善程度</span>
                                <span style="color: ${getSeverityColor(caseItem.severity)}; font-weight: bold;">${caseItem.improvement}</span>
                            </div>
                            <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="background: ${getSeverityColor(caseItem.severity)}; height: 100%; width: ${caseItem.improvement}; border-radius: 4px; transition: width 0.5s;"></div>
                            </div>
                        </div>

                        <!-- 查看详情按钮 -->
                        <button style="width: 100%; padding: 10px; background: linear-gradient(135deg, ${getSeverityColor(caseItem.severity)} 0%, ${getSeverityColor(caseItem.severity)}dd 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            查看详细信息 →
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getSeverityColor(severity) {
            const colors = {
                'mild': '#56ab2f',
                'moderate': '#f39c12',
                'severe': '#e74c3c',
                'scar': '#9b59b6'
            };
            return colors[severity] || '#667eea';
        }

        function showCaseDetail(caseId) {
            const caseItem = BEFORE_AFTER_CASES.find(c => c.id === caseId);
            if (!caseItem) return;

            const modal = document.getElementById('caseDetailModal');
            if (!modal) {
                // 创建弹窗
                const modalHtml = `
                    <div id="caseDetailModal" class="detail-modal">
                        <div class="detail-modal-content" onclick="event.stopPropagation();">
                            <button class="modal-close-btn" onclick="closeCaseDetailModal()" style="position: absolute; top: 20px; right: 20px; background: #f0f0f0; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 20px; color: #666; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                                ×
                            </button>
                            <div id="caseDetailModalBody"></div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);

                // 点击背景关闭
                document.getElementById('caseDetailModal').addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeCaseDetailModal();
                    }
                });
            }

            const modalBody = document.getElementById('caseDetailModalBody');
            const color = getSeverityColor(caseItem.severity);

            modalBody.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 4em; margin-bottom: 15px;">📸</div>
                    <h2 style="color: #2c3e50; font-size: 1.8em; margin-bottom: 10px;">案例详情</h2>
                    <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                        ${caseItem.tags.map(tag => `
                            <span style="background: ${color}15; color: ${color}; padding: 5px 12px; border-radius: 15px; font-size: 0.9em; font-weight: bold;">
                                ${tag}
                            </span>
                        `).join('')}
                    </div>
                </div>

                <!-- 前后对比大图 -->
                <div style="margin-bottom: 30px; background: #f8f9fa; border-radius: 15px; overflow: hidden;">
                    <div style="display: flex; height: 300px;">
                        <div style="flex: 1; background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); display: flex; align-items: center; justify-content: center; position: relative;">
                            <span style="position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.6); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold;">治疗前</span>
                            <div style="font-size: 5em;">😟</div>
                        </div>
                        <div style="flex: 1; background: linear-gradient(135deg, #a8e6cf 0%, #56ab2f 100%); display: flex; align-items: center; justify-content: center; position: relative;">
                            <span style="position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.6); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold;">治疗后</span>
                            <div style="font-size: 5em;">😊</div>
                        </div>
                    </div>
                </div>

                <!-- 基本信息 -->
                <div style="background: linear-gradient(135deg, ${color}15 0%, ${color}25 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; border-left: 4px solid ${color};">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.3em;">👤 患者信息</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 5px;">年龄性别</div>
                            <div style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">${caseItem.age}岁 ${caseItem.gender}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 5px;">治疗周期</div>
                            <div style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">${caseItem.duration}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 5px;">治疗次数</div>
                            <div style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">${caseItem.sessions}次</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 5px;">总费用</div>
                            <div style="font-weight: bold; color: ${color}; font-size: 1.1em;">${caseItem.cost}</div>
                        </div>
                    </div>
                </div>

                <!-- 治疗方案 -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${color}; font-size: 1.3em;">
                        💊 治疗方案
                    </h3>
                    <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="color: #2c3e50; font-size: 1.1em; font-weight: bold; line-height: 1.8;">${caseItem.treatment}</div>
                    </div>
                </div>

                <!-- 治疗前后对比 -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${color}; font-size: 1.3em;">
                        📊 治疗前后对比
                    </h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="background: #fff3cd; padding: 18px; border-radius: 12px; border-left: 4px solid #ffc107;">
                            <div style="font-weight: bold; color: #856404; margin-bottom: 8px;">治疗前</div>
                            <div style="color: #856404; line-height: 1.7;">${caseItem.beforeDesc}</div>
                        </div>
                        <div style="background: #d4edda; padding: 18px; border-radius: 12px; border-left: 4px solid #28a745;">
                            <div style="font-weight: bold; color: #155724; margin-bottom: 8px;">治疗后</div>
                            <div style="color: #155724; line-height: 1.7;">${caseItem.afterDesc}</div>
                        </div>
                    </div>
                </div>

                <!-- 改善程度 -->
                <div style="margin-bottom: 25px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${color}; font-size: 1.3em;">
                        📈 改善程度
                    </h3>
                    <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, ${color}08 0%, ${color}15 100%); border-radius: 12px;">
                        <div style="font-size: 3.5em; font-weight: bold; color: ${color}; margin-bottom: 10px;">${caseItem.improvement}</div>
                        <div style="color: #7f8c8d;">综合改善程度</div>
                    </div>
                </div>

                <!-- 患者评价 -->
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${color}; font-size: 1.3em;">
                        💬 患者评价
                    </h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid ${color};">
                        <div style="color: #2c3e50; line-height: 1.8; font-style: italic;">"${caseItem.review}"</div>
                    </div>
                </div>

                <!-- 免责声明 -->
                <div style="background: #e7f3ff; padding: 15px; border-radius: 10px; border-left: 4px solid #2196f3;">
                    <div style="font-weight: bold; color: #1565c0; margin-bottom: 5px;">📌 重要提示</div>
                    <div style="color: #1565c0; font-size: 0.9em; line-height: 1.6;">
                        以上案例为真实患者治疗经历，效果因个人体质、病情严重程度、配合程度等因素而异。具体治疗方案需由专业医生根据您的实际情况制定。
                    </div>
                </div>
            `;

            document.getElementById('caseDetailModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCaseDetailModal() {
            const modal = document.getElementById('caseDetailModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        // ========== 收藏/书签功能 ==========

        let bookmarks = JSON.parse(localStorage.getItem('acneBookmarks') || '[]');
        let currentBookmarkTab = 'all';

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderCases('all');
            initTimelineTreatmentSelect();
            renderFAQ('all', '');
            initAppointmentDate();
            updateBookmarkCount();
            renderBookmarkList();
            updateContinueReadingButton();  // 初始化继续阅读按钮
        });

        // 切换收藏面板
        function toggleBookmarkPanel() {
            const panel = document.getElementById('bookmarkPanel');
            const backdrop = document.getElementById('bookmarkBackdrop');
            const isVisible = panel.style.display === 'block';

            if (isVisible) {
                panel.style.display = 'none';
                backdrop.style.display = 'none';
            } else {
                panel.style.display = 'block';
                backdrop.style.display = 'block';
                renderBookmarkList();
            }
        }

        // 切换收藏分类
        function switchBookmarkTab(tab) {
            currentBookmarkTab = tab;

            // 更新按钮状态
            document.querySelectorAll('.bookmark-tab-btn').forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            renderBookmarkList();
        }

        // 添加收藏
        function addBookmark(type, item) {
            // 检查是否已收藏
            const exists = bookmarks.some(b => b.id === item.id && b.type === type);
            if (exists) {
                removeBookmark(type, item.id);
                return false;
            }

            // 添加收藏
            const bookmark = {
                id: item.id,
                type: type, // 'treatment' 或 'chapter'
                name: item.name || item.title,
                data: item,
                timestamp: new Date().getTime()
            };

            bookmarks.unshift(bookmark);
            localStorage.setItem('acneBookmarks', JSON.stringify(bookmarks));
            updateBookmarkCount();

            // 显示提示
            showBookmarkToast('已添加到收藏 ⭐');
            return true;
        }

        // 删除收藏
        function removeBookmark(type, id) {
            bookmarks = bookmarks.filter(b => !(b.id === id && b.type === type));
            localStorage.setItem('acneBookmarks', JSON.stringify(bookmarks));
            updateBookmarkCount();
            renderBookmarkList();
            showBookmarkToast('已取消收藏');
        }

        // 检查是否已收藏
        function isBookmarked(type, id) {
            return bookmarks.some(b => b.id === id && b.type === type);
        }

        // 更新收藏计数
        function updateBookmarkCount() {
            const count = bookmarks.length;
            document.getElementById('bookmarkCount').textContent = count;
            document.getElementById('bookmarkTotalCount').textContent = count;
        }

        // 渲染收藏列表
        function renderBookmarkList() {
            const container = document.getElementById('bookmarkList');
            const emptyState = document.getElementById('bookmarkEmpty');

            let filteredBookmarks = bookmarks;

            // 根据tab筛选
            if (currentBookmarkTab !== 'all') {
                filteredBookmarks = bookmarks.filter(b => b.type === currentBookmarkTab);
            }

            // 显示空状态
            if (filteredBookmarks.length === 0) {
                emptyState.style.display = 'block';
                // 移除所有书签项
                const items = container.querySelectorAll('.bookmark-item');
                items.forEach(item => item.remove());
                return;
            }

            emptyState.style.display = 'none';

            // 生成HTML
            const html = filteredBookmarks.map(bookmark => {
                const icon = bookmark.type === 'treatment' ? '💊' : '📖';
                const typeName = bookmark.type === 'treatment' ? '治疗项目' : '电子书章节';
                const time = new Date(bookmark.timestamp).toLocaleDateString('zh-CN');

                return `
                    <div class="bookmark-item">
                        <button class="bookmark-remove-btn" onclick="removeBookmark('${bookmark.type}', ${bookmark.id})">×</button>
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <div style="font-size: 2em;">${icon}</div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                                    <h4 style="margin: 0; color: #2c3e50; font-size: 1em;">${bookmark.name}</h4>
                                    <span style="background: rgba(240,147,251,0.2); color: #f5576c; padding: 2px 8px; border-radius: 10px; font-size: 0.75em; font-weight: bold;">${typeName}</span>
                                </div>
                                <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.85em;">收藏于 ${time}</p>
                                ${bookmark.type === 'treatment' ? `
                                    <div style="margin-top: 8px; font-size: 0.85em; color: #7f8c8d;">
                                        💰 ${bookmark.data.price_single ? `¥${bookmark.data.price_single}` : '价格详询'}
                                        ${bookmark.data.duration ? `&nbsp;&nbsp;⏱ ${bookmark.data.duration}` : ''}
                                    </div>
                                ` : bookmark.type === 'chapter' ? `
                                    <div style="margin-top: 8px;">
                                        <button onclick="loadChapter('${bookmark.data.file}', '${bookmark.data.title}'); toggleBookmarkPanel();" style="padding: 6px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                                            阅读章节
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // 更新列表
            const items = container.querySelectorAll('.bookmark-item');
            items.forEach(item => item.remove());
            container.insertAdjacentHTML('afterbegin', html);
        }

        // 显示收藏提示
        function showBookmarkToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 30px;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 20px rgba(245,87,108,0.4);
                z-index: 10000;
                animation: slideInRight 0.3s;
                font-weight: bold;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // 为医美项目添加收藏按钮
        function addBookmarkButtonToTreatments() {
            // 这个函数会在渲染治疗项目时调用
            // 在每个治疗项目卡片上添加收藏按钮
        }

        // ========== 阅读进度记录 ==========

        let scrollTrackingTimer = null;

        // 保存阅读进度
        function saveReadingProgress(filename, title) {
            const progress = {
                filename: filename,
                title: title,
                timestamp: new Date().getTime(),
                scrollPosition: 0
            };

            localStorage.setItem('acneReadingProgress', JSON.stringify(progress));
            updateContinueReadingButton();
        }

        // 恢复滚动位置
        function restoreScrollPosition(filename) {
            const progress = JSON.parse(localStorage.getItem('acneReadingProgress') || '{}');

            if (progress.filename === filename && progress.scrollPosition) {
                window.scrollTo({
                    top: progress.scrollPosition,
                    behavior: 'smooth'
                });
            }
        }

        // 启动滚动位置跟踪
        function startScrollTracking(filename) {
            // 移除旧的监听器
            stopScrollTracking();

            // 添加滚动监听
            const scrollHandler = () => {
                // 使用防抖，避免频繁保存
                if (scrollTrackingTimer) {
                    clearTimeout(scrollTrackingTimer);
                }

                scrollTrackingTimer = setTimeout(() => {
                    const progress = JSON.parse(localStorage.getItem('acneReadingProgress') || '{}');
                    if (progress.filename === filename) {
                        progress.scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
                        progress.timestamp = new Date().getTime();
                        localStorage.setItem('acneReadingProgress', JSON.stringify(progress));
                    }
                }, 500); // 500ms防抖
            };

            window.addEventListener('scroll', scrollHandler);
            window._scrollHandler = scrollHandler; // 保存引用以便后续移除
        }

        // 停止滚动位置跟踪
        function stopScrollTracking() {
            if (window._scrollHandler) {
                window.removeEventListener('scroll', window._scrollHandler);
                window._scrollHandler = null;
            }
            if (scrollTrackingTimer) {
                clearTimeout(scrollTrackingTimer);
                scrollTrackingTimer = null;
            }
        }

        // 获取阅读进度
        function getReadingProgress() {
            return JSON.parse(localStorage.getItem('acneReadingProgress') || '{}');
        }

        // 继续阅读
        function continueReading() {
            const progress = getReadingProgress();
            if (progress.filename && progress.title) {
                loadChapter(progress.filename, progress.title);
            }
        }

        // 更新"继续阅读"按钮
        function updateContinueReadingButton() {
            const progress = getReadingProgress();
            const button = document.getElementById('continueReadingBtn');

            if (!button) return;

            if (progress.filename && progress.title) {
                button.style.display = 'block';
                const timeAgo = formatTimeAgo(progress.timestamp);
                button.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="font-size: 2em;">📖</div>
                        <div style="flex: 1; text-align: left;">
                            <div style="font-weight: bold; font-size: 1em; margin-bottom: 3px;">继续阅读</div>
                            <div style="font-size: 0.85em; opacity: 0.9;">${progress.title}</div>
                            <div style="font-size: 0.75em; opacity: 0.7; margin-top: 2px;">${timeAgo}</div>
                        </div>
                        <div style="font-size: 1.5em;">→</div>
                    </div>
                `;
            } else {
                button.style.display = 'none';
            }
        }

        // 格式化时间（多久之前）
        function formatTimeAgo(timestamp) {
            const now = new Date().getTime();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return '刚刚';
            if (minutes < 60) return `${minutes}分钟前`;
            if (hours < 24) return `${hours}小时前`;
            if (days < 7) return `${days}天前`;
            return new Date(timestamp).toLocaleDateString('zh-CN');
        }

        // ========== 术后护理指南 ==========

        const CARE_GUIDES = {
            laser: {
                title: '激光类项目术后护理',
                icon: '✨',
                color: '#667eea',
                projects: ['点阵激光', '光子嫩肤', 'CO2点阵'],
                timeline: [
                    {
                        period: '治疗后即刻（0-2小时）',
                        items: [
                            '✅ 治疗部位会有轻微红肿热感，属正常现象',
                            '✅ 可用冰袋冷敷15-20分钟，缓解不适',
                            '✅ 避免用手触碰治疗部位',
                            '❌ 不要立即洗脸或化妆'
                        ]
                    },
                    {
                        period: '第1-3天',
                        items: [
                            '✅ 可能出现结痂，属正常反应，不要用手撕',
                            '✅ 温和洁面，使用温和洁面产品',
                            '✅ 早晚使用医用修复面膜或舒缓产品',
                            '✅ 严格防晒（SPF50+），避免色素沉着',
                            '❌ 禁止使用刺激性护肤品（美白、去角质等）',
                            '❌ 避免热水洗脸、桑拿、剧烈运动'
                        ]
                    },
                    {
                        period: '第4-7天',
                        items: [
                            '✅ 结痂自然脱落，露出新生皮肤',
                            '✅ 继续做好保湿和防晒',
                            '✅ 可适当补充维生素C',
                            '✅ 饮食清淡，多喝水',
                            '❌ 不要使用磨砂类产品',
                            '❌ 避免游泳、温泉等'
                        ]
                    },
                    {
                        period: '第2-4周',
                        items: [
                            '✅ 皮肤基本恢复，可恢复正常护肤',
                            '✅ 继续严格防晒3个月',
                            '✅ 可使用温和美白产品',
                            '✅ 定期回诊，评估效果'
                        ]
                    }
                ],
                warnings: [
                    '⚠️ 如出现严重红肿、感染迹象，立即联系医生',
                    '⚠️ 结痂过程中绝不可用手撕扯，否则可能留疤',
                    '⚠️ 防晒不到位可能导致色素沉着或反黑'
                ],
                products: [
                    '💧 医用修复面膜（薇诺娜、芙清等）',
                    '🧴 温和洁面（氨基酸洁面）',
                    '☀️ 物理防晒霜（SPF50+）',
                    '💊 维生素C/E补充剂（可选）'
                ]
            },
            acid: {
                title: '刷酸类项目术后护理',
                icon: '💧',
                color: '#f5576c',
                projects: ['水杨酸焕肤', '果酸焕肤', '复合酸'],
                timeline: [
                    {
                        period: '刷酸后即刻',
                        items: [
                            '✅ 面部会有刺痛、发红、发热感',
                            '✅ 医生会进行中和处理',
                            '✅ 离院前医生会涂抹舒缓产品',
                            '❌ 当天不要洗脸、不要化妆'
                        ]
                    },
                    {
                        period: '第1-3天（脱皮期）',
                        items: [
                            '✅ 第二天可温和洁面',
                            '✅ 会出现轻微脱皮，属正常现象',
                            '✅ 使用医用保湿喷雾或修复产品',
                            '✅ 严格防晒（物理防晒优先）',
                            '❌ 不要撕扯脱皮',
                            '❌ 禁用任何功效性护肤品',
                            '❌ 避免化妆（前3天）'
                        ]
                    },
                    {
                        period: '第4-7天',
                        items: [
                            '✅ 脱皮基本结束，皮肤变光滑',
                            '✅ 继续保湿和防晒',
                            '✅ 可使用淡妆',
                            '✅ 饮食清淡，少糖少油',
                            '❌ 仍需避免美白、去角质类产品'
                        ]
                    },
                    {
                        period: '第2周后',
                        items: [
                            '✅ 可恢复正常护肤流程',
                            '✅ 建议间隔2-4周再次刷酸',
                            '✅ 持续防晒至少1个月',
                            '✅ 评估疗程安排'
                        ]
                    }
                ],
                warnings: [
                    '⚠️ 刷酸后1周内皮肤屏障较弱，严禁晒太阳',
                    '⚠️ 出现严重刺痛、水疱需立即就医',
                    '⚠️ 不要自行在家刷酸，容易烧伤皮肤'
                ],
                products: [
                    '💧 医用舒缓喷雾',
                    '🧴 无刺激洁面（温水洗脸最佳）',
                    '💦 医用保湿霜',
                    '☀️ 物理防晒（帽子、口罩、防晒霜）'
                ]
            },
            microneedle: {
                title: '微针类项目术后护理',
                icon: '⚡',
                color: '#56ab2f',
                projects: ['黄金微针', '射频微针', '水光针'],
                timeline: [
                    {
                        period: '治疗后即刻',
                        items: [
                            '✅ 会有针刺感和轻微出血点',
                            '✅ 医生会涂抹修复精华和舒缓面膜',
                            '✅ 可能有轻微肿胀',
                            '❌ 6小时内不要碰水'
                        ]
                    },
                    {
                        period: '第1-2天',
                        items: [
                            '✅ 6小时后可用温水轻柔洁面',
                            '✅ 使用医用修复产品',
                            '✅ 避免化妆',
                            '✅ 多喝水，促进代谢',
                            '❌ 不要用力搓揉面部',
                            '❌ 避免剧烈运动、出汗'
                        ]
                    },
                    {
                        period: '第3-7天',
                        items: [
                            '✅ 针孔基本愈合',
                            '✅ 可淡妆（避开针孔）',
                            '✅ 加强保湿和防晒',
                            '✅ 可正常洗脸，动作轻柔',
                            '❌ 避免去角质、刷酸',
                            '❌ 避免桑拿、汗蒸'
                        ]
                    },
                    {
                        period: '2周后',
                        items: [
                            '✅ 完全恢复，可正常护肤',
                            '✅ 效果逐渐显现',
                            '✅ 建议1个月后做第二次',
                            '✅ 持续防晒'
                        ]
                    }
                ],
                warnings: [
                    '⚠️ 术后24小时内禁止沾水，防止感染',
                    '⚠️ 出现红肿加重、化脓需立即就医',
                    '⚠️ 微针后1周内不要做其他激光项目'
                ],
                products: [
                    '💧 无菌生理盐水（清洁用）',
                    '🧴 医用修复精华',
                    '💦 EGF生长因子面膜',
                    '☀️ 温和防晒'
                ]
            },
            photodynamic: {
                title: '光动力疗法术后护理',
                icon: '💡',
                color: '#f39c12',
                projects: ['ALA-PDT', '红蓝光治疗'],
                timeline: [
                    {
                        period: '治疗当天',
                        items: [
                            '✅ 避光是关键！涂抹光敏剂后48小时内严格避光',
                            '✅ 戴遮阳帽、墨镜，尽量待在室内',
                            '✅ 室内也要拉窗帘，避免日光灯直射',
                            '✅ 会有轻微刺痛、发红',
                            '❌ 绝对不能晒太阳',
                            '❌ 不要洗脸、化妆'
                        ]
                    },
                    {
                        period: '第1-3天',
                        items: [
                            '✅ 继续严格避光',
                            '✅ 温和清洁，使用修复产品',
                            '✅ 可能出现脱皮、结痂',
                            '✅ 多喝水，清淡饮食',
                            '❌ 不要撕扯结痂',
                            '❌ 避免使用任何功效性护肤品'
                        ]
                    },
                    {
                        period: '第4-7天',
                        items: [
                            '✅ 结痂脱落，新皮再生',
                            '✅ 继续避光（室外必须打伞）',
                            '✅ 加强保湿',
                            '✅ 可淡妆',
                            '❌ 仍需避免强光照射'
                        ]
                    },
                    {
                        period: '2周后',
                        items: [
                            '✅ 基本恢复，效果显现',
                            '✅ 炎症型痤疮明显改善',
                            '✅ 可逐步恢复正常活动',
                            '✅ 但仍需防晒1-3个月'
                        ]
                    }
                ],
                warnings: [
                    '⚠️ 光动力后48小时严格避光，否则可能灼伤',
                    '⚠️ 室内也要避免强光（关灯或拉窗帘）',
                    '⚠️ 出现严重水肿、水疱立即就医',
                    '⚠️ 治疗后1个月内不要做其他光类项目'
                ],
                products: [
                    '🧴 医用舒缓洁面',
                    '💧 医用修复面膜',
                    '💦 保湿精华',
                    '☀️ 高倍数防晒+物理遮挡',
                    '🧢 遮阳帽、太阳镜'
                ]
            }
        };

        function showCareGuide(type) {
            const guide = CARE_GUIDES[type];
            if (!guide) return;

            const modal = document.getElementById('careGuideModal');
            const content = document.getElementById('careGuideContent');

            let html = `
                <!-- 标题 -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 3em; margin-bottom: 10px;">${guide.icon}</div>
                    <h2 style="color: ${guide.color}; margin: 0 0 10px 0;">${guide.title}</h2>
                    <p style="color: #7f8c8d; margin: 0;">适用项目：${guide.projects.join('、')}</p>
                </div>

                <!-- 时间线 -->
                <h3 style="color: #2c3e50; margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid ${guide.color};">📅 护理时间线</h3>
                ${guide.timeline.map((phase, index) => `
                    <div style="margin-bottom: 25px; padding: 20px; background: ${index % 2 === 0 ? '#f8f9fa' : '#fff'}; border-left: 4px solid ${guide.color}; border-radius: 8px;">
                        <h4 style="color: ${guide.color}; margin: 0 0 15px 0;">${phase.period}</h4>
                        <div style="line-height: 2; color: #555;">
                            ${phase.items.map(item => `<div>${item}</div>`).join('')}
                        </div>
                    </div>
                `).join('')}

                <!-- 警告提示 -->
                <h3 style="color: #e74c3c; margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #e74c3c;">⚠️ 重要警告</h3>
                <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107;">
                    ${guide.warnings.map(warning => `<div style="margin-bottom: 10px; line-height: 1.8; color: #856404;">${warning}</div>`).join('')}
                </div>

                <!-- 推荐产品 -->
                <h3 style="color: #667eea; margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #667eea;">🛒 推荐产品</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                    ${guide.products.map(product => `
                        <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea; font-size: 0.9em; color: #555;">
                            ${product}
                        </div>
                    `).join('')}
                </div>

                <!-- 底部提示 -->
                <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, ${guide.color}15 0%, ${guide.color}30 100%); border-radius: 10px; text-align: center;">
                    <p style="margin: 0; color: #555; line-height: 1.8;">
                        💡 以上护理建议仅供参考，具体护理方案请以医生面诊指导为准<br>
                        如有任何疑问或不适，请及时联系您的主治医生
                    </p>
                </div>
            `;

            content.innerHTML = html;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeCareGuide() {
            document.getElementById('careGuideModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // ========== 医生团队相关功能 ==========

        function scrollToAppointment() {
            // 查找预约表单区域
            const appointmentSection = document.querySelector('.appointment-section');
            if (appointmentSection) {
                appointmentSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

                // 聚焦到姓名输入框
                setTimeout(() => {
                    const nameInput = document.getElementById('appointmentName');
                    if (nameInput) {
                        nameInput.focus();
                    }
                }, 800);
            }
        }

        // ========== 治疗效果跟踪系统 ==========

        let trackingRecords = JSON.parse(localStorage.getItem('acneTrackingRecords') || '[]');

        // 打开跟踪系统
        function openTrackingSystem() {
            document.getElementById('trackingModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            renderTrackingRecords();
        }

        // 关闭跟踪系统
        function closeTrackingSystem() {
            document.getElementById('trackingModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            hideAddRecordForm();
        }

        // 显示添加记录表单
        function showAddRecordForm() {
            const form = document.getElementById('addRecordForm');
            form.style.display = 'block';

            // 设置默认日期为今天
            document.getElementById('recordDate').value = new Date().toISOString().split('T')[0];

            // 清空表单
            document.getElementById('recordTreatment').value = '';
            document.getElementById('recordNotes').value = '';
        }

        // 隐藏添加记录表单
        function hideAddRecordForm() {
            document.getElementById('addRecordForm').style.display = 'none';
        }

        // 保存跟踪记录
        function saveTrackingRecord() {
            const date = document.getElementById('recordDate').value;
            const treatment = document.getElementById('recordTreatment').value;
            const acneCount = document.getElementById('recordAcneCount').value;
            const severity = document.getElementById('recordSeverity').value;
            const notes = document.getElementById('recordNotes').value;

            if (!date) {
                alert('请选择记录日期');
                return;
            }

            const record = {
                id: new Date().getTime(),
                date: date,
                treatment: treatment || '未记录',
                acneCount: acneCount,
                severity: severity,
                notes: notes,
                timestamp: new Date().getTime()
            };

            trackingRecords.unshift(record);
            localStorage.setItem('acneTrackingRecords', JSON.stringify(trackingRecords));

            hideAddRecordForm();
            renderTrackingRecords();
            updateTrackingStats();

            // 显示成功提示
            showToast('记录保存成功！');
        }

        // 删除记录
        function deleteTrackingRecord(id) {
            if (!confirm('确定要删除这条记录吗？')) return;

            trackingRecords = trackingRecords.filter(r => r.id !== id);
            localStorage.setItem('acneTrackingRecords', JSON.stringify(trackingRecords));

            renderTrackingRecords();
            updateTrackingStats();
            showToast('记录已删除');
        }

        // 渲染记录列表
        function renderTrackingRecords() {
            const container = document.getElementById('trackingRecordsList');
            const emptyState = document.getElementById('trackingEmptyState');

            if (trackingRecords.length === 0) {
                emptyState.style.display = 'block';
                // 移除所有记录卡片
                const cards = container.querySelectorAll('.tracking-record-card');
                cards.forEach(card => card.remove());
                return;
            }

            emptyState.style.display = 'none';

            const html = trackingRecords.map((record, index) => {
                const severityColor = record.severity === '轻度' ? '#28a745' :
                                     record.severity === '中度' ? '#ffc107' : '#e74c3c';

                return `
                    <div class="tracking-record-card" style="background: white; border: 2px solid #e9ecef; border-radius: 12px; padding: 20px; margin-bottom: 15px; position: relative; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.1)';" onmouseout="this.style.borderColor='#e9ecef'; this.style.boxShadow='none';">
                        <button onclick="deleteTrackingRecord(${record.id})" style="position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: #e74c3c; cursor: pointer; font-size: 1.2em; padding: 5px;" title="删除记录">🗑️</button>

                        <div style="display: flex; gap: 20px; align-items: start;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="font-size: 1.5em;">📅</div>
                                    <div>
                                        <div style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">${new Date(record.date).toLocaleDateString('zh-CN', {year: 'numeric', month: 'long', day: 'numeric'})}</div>
                                        <div style="color: #7f8c8d; font-size: 0.85em;">第 ${trackingRecords.length - index} 次记录</div>
                                    </div>
                                </div>

                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin: 15px 0;">
                                    <div style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                                        <div style="color: #7f8c8d; font-size: 0.85em; margin-bottom: 5px;">治疗项目</div>
                                        <div style="color: #2c3e50; font-weight: bold;">${record.treatment}</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                                        <div style="color: #7f8c8d; font-size: 0.85em; margin-bottom: 5px;">痘痘数量</div>
                                        <div style="color: #2c3e50; font-weight: bold;">${record.acneCount}</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                                        <div style="color: #7f8c8d; font-size: 0.85em; margin-bottom: 5px;">严重程度</div>
                                        <div style="color: ${severityColor}; font-weight: bold;">${record.severity}</div>
                                    </div>
                                </div>

                                ${record.notes ? `
                                    <div style="background: #fffbf0; border-left: 3px solid #ffc107; padding: 12px; border-radius: 8px; margin-top: 15px;">
                                        <div style="color: #856404; font-size: 0.85em; margin-bottom: 5px; font-weight: bold;">备注</div>
                                        <div style="color: #555; line-height: 1.6;">${record.notes}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // 移除旧的记录卡片
            const oldCards = container.querySelectorAll('.tracking-record-card');
            oldCards.forEach(card => card.remove());

            // 插入新的记录
            container.insertAdjacentHTML('beforeend', html);
        }

        // 更新统计信息
        function updateTrackingStats() {
            const recordCount = trackingRecords.length;
            document.getElementById('trackingRecordCount').textContent = recordCount;

            // 计算治疗天数
            let days = 0;
            if (recordCount > 0) {
                const sortedRecords = [...trackingRecords].sort((a, b) => new Date(a.date) - new Date(b.date));
                const firstDate = new Date(sortedRecords[0].date);
                const lastDate = new Date(sortedRecords[sortedRecords.length - 1].date);
                days = Math.ceil((lastDate - firstDate) / (1000 * 60 * 60 * 24));
            }
            document.getElementById('trackingDaysCount').textContent = days;
        }

        // 显示提示消息
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 30px;
                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(40,167,69,0.4);
                z-index: 10001;
                font-weight: bold;
                animation: slideInRight 0.3s;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateTrackingStats();
        });

        // ========== 预约咨询表单 ==========

        function initAppointmentDate() {
            const dateInput = document.getElementById('appointmentDate');
            if (!dateInput) return;

            // 设置最小日期为明天
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.min = tomorrow.toISOString().split('T')[0];

            // 设置最大日期为30天后
            const maxDate = new Date();
            maxDate.setDate(maxDate.getDate() + 30);
            dateInput.max = maxDate.toISOString().split('T')[0];
        }

        // 提交预约表单
        function submitAppointment(event) {
            event.preventDefault();

            // 获取表单数据
            const name = document.getElementById('appointmentName').value.trim();
            const phone = document.getElementById('appointmentPhone').value.trim();
            const service = document.getElementById('appointmentService').value;
            const date = document.getElementById('appointmentDate').value;
            const timeSlot = document.querySelector('input[name="appointmentTime"]:checked')?.value;
            const note = document.getElementById('appointmentNote').value.trim();

            // 验证手机号
            const phoneRegex = /^1[3-9]\d{9}$/;
            if (!phoneRegex.test(phone)) {
                alert('请输入正确的手机号码（11位数字，以1开头）');
                return;
            }

            // 验证日期
            const selectedDate = new Date(date);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (selectedDate <= today) {
                alert('预约日期必须是明天或之后的日期');
                return;
            }

            // 构建预约信息
            const appointmentData = {
                name,
                phone,
                service,
                date,
                timeSlot,
                note,
                submitTime: new Date().toLocaleString('zh-CN')
            };

            // 在实际应用中，这里应该发送到后端API
            console.log('预约信息：', appointmentData);

            // 显示成功提示
            showAppointmentSuccess(appointmentData);

            // 清空表单
            document.getElementById('appointmentForm').reset();
        }

        // 显示预约成功提示
        function showAppointmentSuccess(data) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s;
            `;

            modal.innerHTML = `
                <div style="background: white; padding: 40px; border-radius: 20px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: slideIn 0.3s;">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 3em;">
                            ✓
                        </div>
                        <h3 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 1.5em;">预约提交成功！</h3>
                        <p style="color: #7f8c8d; margin: 0;">我们会在24小时内联系您确认</p>
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                        <h4 style="color: #2c3e50; margin: 0 0 15px 0; font-size: 1.1em;">预约信息</h4>
                        <div style="color: #555; line-height: 2;">
                            <div><strong>姓名：</strong>${data.name}</div>
                            <div><strong>手机：</strong>${data.phone}</div>
                            <div><strong>项目：</strong>${data.service}</div>
                            <div><strong>日期：</strong>${data.date} ${data.timeSlot}</div>
                            ${data.note ? `<div><strong>备注：</strong>${data.note}</div>` : ''}
                        </div>
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107; margin-bottom: 25px;">
                        <p style="margin: 0; color: #856404; font-size: 0.9em; line-height: 1.6;">
                            <strong>📱 温馨提醒：</strong><br>
                            请保持手机畅通，我们的客服人员会尽快与您联系确认预约时间。
                            您也可以直接拨打 <strong>400-888-6666</strong> 咨询。
                        </p>
                    </div>

                    <button onclick="this.parentElement.parentElement.remove()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 1em; font-weight: bold; cursor: pointer;">
                        我知道了
                    </button>
                </div>
            `;

            document.body.appendChild(modal);

            // 点击背景关闭
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ========== 常见问题FAQ系统 ==========

        const FAQ_DATA = [
            // 治疗相关
            {
                id: 1,
                category: 'treatment',
                categoryName: '治疗相关',
                question: '痤疮治疗需要多长时间才能见效？',
                answer: `<strong>见效时间因治疗方法和个人情况而异：</strong><br><br>
                    • <strong>外用药物：</strong>通常需要4-8周才能看到明显改善<br>
                    • <strong>口服药物：</strong>如异维A酸，一般2-3个月开始见效<br>
                    • <strong>医美项目：</strong>如光子嫩肤、红蓝光，通常3-5次后明显改善<br>
                    • <strong>激光治疗：</strong>点阵激光等，单次即可看到效果，完整疗程需3-6个月<br><br>
                    <strong>重要提醒：</strong>痤疮治疗需要耐心，切忌频繁更换方案。建议坚持治疗至少2-3个月再评估效果。`,
                tags: ['治疗周期', '见效时间']
            },
            {
                id: 2,
                category: 'treatment',
                categoryName: '治疗相关',
                question: '轻度、中度、重度痤疮分别适合什么治疗方案？',
                answer: `<strong>根据GAGS评分建议的治疗方案：</strong><br><br>
                    • <strong>轻度痤疮（1-18分）：</strong><br>
                    &nbsp;&nbsp;- 外用维A酸类药物 + 日常护理<br>
                    &nbsp;&nbsp;- 红蓝光治疗（消炎杀菌）<br>
                    &nbsp;&nbsp;- 果酸焕肤（清洁毛孔）<br><br>
                    • <strong>中度痤疮（19-30分）：</strong><br>
                    &nbsp;&nbsp;- 口服抗生素 + 外用药物<br>
                    &nbsp;&nbsp;- 光子嫩肤 + 红蓝光组合<br>
                    &nbsp;&nbsp;- 水杨酸焕肤（深层清洁）<br><br>
                    • <strong>重度痤疮（31-38分）：</strong><br>
                    &nbsp;&nbsp;- 口服异维A酸（医生监督下）<br>
                    &nbsp;&nbsp;- 光动力治疗（强效抗炎）<br>
                    &nbsp;&nbsp;- 激光治疗 + 药物联合<br><br>
                    • <strong>极重度痤疮（>38分）：</strong><br>
                    &nbsp;&nbsp;- 系统性药物治疗为主<br>
                    &nbsp;&nbsp;- 医美项目作为辅助<br>
                    &nbsp;&nbsp;- 建议先就医评估`,
                tags: ['治疗方案', '分级治疗', 'GAGS评分']
            },
            {
                id: 3,
                category: 'treatment',
                categoryName: '治疗相关',
                question: '医美项目和药物治疗可以同时进行吗？',
                answer: `<strong>可以，但需要注意以下几点：</strong><br><br>
                    <strong>✅ 可以联合的情况：</strong><br>
                    • 外用药物 + 红蓝光治疗<br>
                    • 口服抗生素 + 光子嫩肤<br>
                    • 维A酸类药物 + 果酸焕肤（间隔使用）<br><br>
                    <strong>⚠️ 需要谨慎的情况：</strong><br>
                    • 口服异维A酸期间：避免激光治疗（停药半年后才能做）<br>
                    • 刷酸期间：暂停外用刺激性药物<br>
                    • 光动力治疗后：24-48小时内避免强光照射<br><br>
                    <strong>💡 最佳建议：</strong>咨询专业医生，制定个性化联合治疗方案，避免过度治疗。`,
                tags: ['联合治疗', '注意事项']
            },
            {
                id: 4,
                category: 'treatment',
                categoryName: '治疗相关',
                question: '敏感肌可以做医美项目吗？',
                answer: `<strong>可以，但需要选择温和的项目：</strong><br><br>
                    <strong>✅ 适合敏感肌的项目：</strong><br>
                    • <strong>红蓝光治疗：</strong>无创、温和、消炎效果好<br>
                    • <strong>舒敏修复项目：</strong>如舒敏面膜、冷喷<br>
                    • <strong>低浓度果酸：</strong>从最低浓度（20%）开始尝试<br><br>
                    <strong>⚠️ 需要谨慎的项目：</strong><br>
                    • 激光治疗：建议先做小面积测试<br>
                    • 高浓度刷酸：容易引起刺激反应<br>
                    • 光动力：刺激性较强，敏感肌慎用<br><br>
                    <strong>💡 敏感肌治疗建议：</strong><br>
                    1. 先修复皮肤屏障<br>
                    2. 选择低刺激性项目<br>
                    3. 治疗前做过敏测试<br>
                    4. 术后加强保湿和防晒`,
                tags: ['敏感肌', '适合项目']
            },

            // 价格费用
            {
                id: 5,
                category: 'price',
                categoryName: '价格费用',
                question: '治疗痤疮大概需要花费多少钱？',
                answer: `<strong>费用因治疗方案和疗程而异：</strong><br><br>
                    <strong>💊 药物治疗（每月）：</strong><br>
                    • 外用药物：200-500元<br>
                    • 口服抗生素：100-300元<br>
                    • 异维A酸：300-800元<br><br>
                    <strong>🏥 医美项目（单次）：</strong><br>
                    • 红蓝光：200-500元<br>
                    • 果酸焕肤：500-1200元<br>
                    • 光子嫩肤：1500-3000元<br>
                    • 激光治疗：2000-5000元<br>
                    • 光动力：3000-8000元<br><br>
                    <strong>💰 完整疗程预估：</strong><br>
                    • 轻度痤疮：3000-8000元（3-6个月）<br>
                    • 中度痤疮：8000-20000元（6-12个月）<br>
                    • 重度痤疮：20000-50000元（12个月以上）<br><br>
                    <strong>💡 省钱建议：</strong>选择套餐优惠、早期干预、坚持治疗避免反复。`,
                tags: ['费用', '价格', '预算']
            },
            {
                id: 6,
                category: 'price',
                categoryName: '价格费用',
                question: '有哪些性价比高的治疗方案？',
                answer: `<strong>根据预算推荐高性价比方案：</strong><br><br>
                    <strong>💰 预算<500元/月：</strong><br>
                    • 外用药物 + 规范护理<br>
                    • 红蓝光治疗（每月1-2次）<br>
                    • 重点在于坚持和耐心<br><br>
                    <strong>💰 预算500-1500元/月：</strong><br>
                    • 果酸焕肤（每月1次）<br>
                    • 红蓝光 + 外用药物组合<br>
                    • 性价比较高，适合中度痤疮<br><br>
                    <strong>💰 预算1500-3000元/月：</strong><br>
                    • 光子嫩肤（每月1次）<br>
                    • 水杨酸焕肤 + 药物治疗<br>
                    • 适合快速改善需求<br><br>
                    <strong>💰 预算>3000元/月：</strong><br>
                    • 激光治疗 + 光动力<br>
                    • 综合治疗方案<br>
                    • 适合重度痤疮或急需改善<br><br>
                    <strong>🎁 省钱技巧：</strong><br>
                    • 选择套餐优惠（通常便宜20-30%）<br>
                    • 关注机构活动（节假日优惠）<br>
                    • 联合治疗（提高效率，减少总疗程）`,
                tags: ['性价比', '预算方案']
            },
            {
                id: 7,
                category: 'price',
                categoryName: '价格费用',
                question: '医美项目可以用医保报销吗？',
                answer: `<strong>遗憾的是，大部分医美项目不能医保报销：</strong><br><br>
                    <strong>❌ 不能报销的项目：</strong><br>
                    • 光子嫩肤、激光治疗<br>
                    • 果酸焕肤、水杨酸焕肤<br>
                    • 红蓝光治疗（美容性质）<br>
                    • 微针、光动力等医美项目<br><br>
                    <strong>✅ 可能报销的项目：</strong><br>
                    • 皮肤科门诊挂号费<br>
                    • 口服药物（如抗生素、异维A酸）<br>
                    • 外用药膏（需医生处方）<br>
                    • 部分检查费用（如激素检查）<br><br>
                    <strong>💡 报销建议：</strong><br>
                    1. 先在正规医院皮肤科就诊<br>
                    2. 使用医保药物治疗<br>
                    3. 医美项目作为自费补充<br>
                    4. 保存所有发票和病历，部分地区可申请商业保险理赔`,
                tags: ['医保', '报销']
            },

            // 效果周期
            {
                id: 8,
                category: 'effect',
                categoryName: '效果周期',
                question: '做完医美项目后多久能看到效果？',
                answer: `<strong>不同项目见效时间不同：</strong><br><br>
                    <strong>⚡ 即时见效（当天-3天）：</strong><br>
                    • <strong>红蓝光：</strong>消炎效果当天可见，皮肤镇静<br>
                    • <strong>清痘项目：</strong>炎症消退，皮肤平整<br><br>
                    <strong>📅 短期见效（1-2周）：</strong><br>
                    • <strong>果酸焕肤：</strong>3-7天皮肤明显光滑细腻<br>
                    • <strong>光子嫩肤：</strong>1-2周炎症减轻，肤色提亮<br><br>
                    <strong>📆 中期见效（1-2个月）：</strong><br>
                    • <strong>激光治疗：</strong>1个月痘坑开始改善<br>
                    • <strong>光动力：</strong>2-4周出油量明显减少<br><br>
                    <strong>📈 长期效果（3-6个月）：</strong><br>
                    • <strong>点阵激光：</strong>3-6个月痘坑填平70-80%<br>
                    • <strong>完整疗程：</strong>6个月以上达到最佳稳定状态<br><br>
                    <strong>💡 重要提示：</strong>单次效果有限，坚持完整疗程才能达到最佳效果。`,
                tags: ['见效时间', '治疗周期']
            },
            {
                id: 9,
                category: 'effect',
                categoryName: '效果周期',
                question: '痤疮治好后会复发吗？如何预防？',
                answer: `<strong>复发风险存在，但可以有效预防：</strong><br><br>
                    <strong>📊 复发率统计：</strong><br>
                    • 仅用药物治疗：复发率40-60%<br>
                    • 药物+医美联合：复发率20-30%<br>
                    • 规范治疗+长期维护：复发率<10%<br><br>
                    <strong>⚠️ 易复发的原因：</strong><br>
                    • 过早停止治疗<br>
                    • 不良生活习惯（熬夜、高糖饮食）<br>
                    • 护肤不当（过度清洁、使用刺激性产品）<br>
                    • 激素波动（月经期、压力大）<br><br>
                    <strong>🛡️ 预防复发的方法：</strong><br>
                    1. <strong>维持治疗：</strong>症状改善后继续低强度治疗2-3个月<br>
                    2. <strong>定期维护：</strong>每月1-2次红蓝光或果酸<br>
                    3. <strong>规律作息：</strong>保证充足睡眠，避免熬夜<br>
                    4. <strong>科学护肤：</strong>温和清洁，做好保湿和防晒<br>
                    5. <strong>饮食调理：</strong>少吃高糖高油食物<br>
                    6. <strong>压力管理：</strong>学会释放压力，保持心情愉悦<br><br>
                    <strong>💡 复发后怎么办：</strong>及时就医，不要等恶化再治疗。`,
                tags: ['复发', '预防', '维护']
            },
            {
                id: 10,
                category: 'effect',
                categoryName: '效果周期',
                question: '为什么有些项目需要多次治疗才有效？',
                answer: `<strong>多次治疗的科学原理：</strong><br><br>
                    <strong>🔬 皮肤代谢周期：</strong><br>
                    • 表皮更新周期：28天<br>
                    • 真皮层修复周期：3-6个月<br>
                    • 胶原蛋白重建：6-12个月<br><br>
                    <strong>📅 为什么需要多次：</strong><br>
                    1. <strong>渐进式改善：</strong><br>
                    &nbsp;&nbsp;- 单次治疗只能改善部分问题<br>
                    &nbsp;&nbsp;- 多次累积效果更持久<br><br>
                    2. <strong>避免过度刺激：</strong><br>
                    &nbsp;&nbsp;- 单次能量过强易损伤皮肤<br>
                    &nbsp;&nbsp;- 分次治疗更安全温和<br><br>
                    3. <strong>深浅层兼顾：</strong><br>
                    &nbsp;&nbsp;- 表层问题先解决（炎症、出油）<br>
                    &nbsp;&nbsp;- 深层问题后改善（痘坑、痘印）<br><br>
                    <strong>⏰ 推荐疗程次数：</strong><br>
                    • 红蓝光：6-10次（每周1-2次）<br>
                    • 果酸焕肤：4-6次（每月1次）<br>
                    • 光子嫩肤：3-5次（每月1次）<br>
                    • 激光治疗：3-5次（间隔1-3个月）<br><br>
                    <strong>💡 坚持建议：</strong>把治疗当成马拉松而非百米冲刺，耐心完成疗程才能获得最佳效果。`,
                tags: ['疗程次数', '治疗原理']
            },

            // 安全副作用
            {
                id: 11,
                category: 'safety',
                categoryName: '安全副作用',
                question: '医美项目有副作用吗？安全吗？',
                answer: `<strong>正规医美项目是安全的，但可能有暂时性反应：</strong><br><br>
                    <strong>✅ 常见正常反应（会自行消退）：</strong><br>
                    • <strong>轻度红肿：</strong>治疗后1-3天，属于正常炎症反应<br>
                    • <strong>皮肤干燥：</strong>刷酸后常见，加强保湿即可<br>
                    • <strong>轻微刺痛：</strong>治疗过程中可能出现，可忍受范围<br>
                    • <strong>结痂脱皮：</strong>激光后3-7天，避免强行撕扯<br><br>
                    <strong>⚠️ 需要警惕的副作用：</strong><br>
                    • <strong>严重过敏：</strong>大面积红肿、瘙痒，需立即就医<br>
                    • <strong>烫伤水疱：</strong>能量过高导致，选择正规机构可避免<br>
                    • <strong>色素沉着：</strong>术后未做好防晒，可能需3-6个月恢复<br>
                    • <strong>疤痕增生：</strong>极少数瘢痕体质者可能出现<br><br>
                    <strong>🛡️ 如何确保安全：</strong><br>
                    1. 选择有资质的正规医疗机构<br>
                    2. 由专业医生操作，不要去美容院<br>
                    3. 治疗前告知医生过敏史和用药史<br>
                    4. 严格遵守术后护理要求<br>
                    5. 出现异常及时联系医生<br><br>
                    <strong>💡 特殊提醒：</strong>孕期、哺乳期、疤痕体质、光敏性皮肤病患者需特别谨慎。`,
                tags: ['安全性', '副作用', '注意事项']
            },
            {
                id: 12,
                category: 'safety',
                categoryName: '安全副作用',
                question: '激光治疗会让皮肤变薄、变敏感吗？',
                answer: `<strong>这是常见误区！正规激光治疗不会让皮肤变薄：</strong><br><br>
                    <strong>❌ 误区澄清：</strong><br>
                    • <strong>错误观念：</strong>"激光会把皮肤打薄"<br>
                    • <strong>科学事实：</strong>激光是刺激胶原再生，让皮肤变厚变紧致<br><br>
                    <strong>🔬 激光治疗原理：</strong><br>
                    1. 激光选择性作用于目标组织<br>
                    2. 刺激真皮层胶原蛋白增生<br>
                    3. 促进皮肤新陈代谢和修复<br>
                    4. 最终结果是皮肤变厚、变紧致<br><br>
                    <strong>⚠️ 为什么有人觉得变敏感了：</strong><br>
                    • 治疗后短期内角质层受损（会自然修复）<br>
                    • 术后防晒不到位，皮肤屏障受损<br>
                    • 过度频繁治疗，皮肤来不及恢复<br>
                    • 治疗能量过高，操作不当<br><br>
                    <strong>🛡️ 避免变敏感的方法：</strong><br>
                    1. 选择正规机构和专业医生<br>
                    2. 严格按照建议的间隔时间治疗<br>
                    3. 术后加强保湿和防晒（SPF50+）<br>
                    4. 避免使用刺激性护肤品<br>
                    5. 给皮肤足够的恢复时间<br><br>
                    <strong>💡 正确认识：</strong>规范的激光治疗是安全的，反而能改善皮肤质量。关键是选对机构、听从医嘱、做好护理。`,
                tags: ['激光', '皮肤变薄', '敏感肌']
            },
            {
                id: 13,
                category: 'safety',
                categoryName: '安全副作用',
                question: '刷酸后为什么会爆痘？正常吗？',
                answer: `<strong>刷酸后爆痘是正常的"爆发期"，通常1-2周会好转：</strong><br><br>
                    <strong>🔬 爆痘的原因：</strong><br>
                    1. <strong>加速代谢：</strong><br>
                    &nbsp;&nbsp;- 果酸促进角质代谢<br>
                    &nbsp;&nbsp;- 毛孔深处的粉刺加速排出<br>
                    &nbsp;&nbsp;- 隐藏的闭口浮出表面<br><br>
                    2. <strong>闭口开放：</strong><br>
                    &nbsp;&nbsp;- 原本闭合的粉刺被"打开"<br>
                    &nbsp;&nbsp;- 短期内看起来痘痘变多了<br>
                    &nbsp;&nbsp;- 实际上是在彻底清理<br><br>
                    <strong>✅ 正常爆痘 vs ⚠️ 异常爆痘：</strong><br>
                    <strong>正常情况：</strong><br>
                    • 爆痘位置是原本有闭口的区域<br>
                    • 痘痘为小颗粒状，不红不肿<br>
                    • 1-2周后明显好转<br>
                    • 之后皮肤变光滑<br><br>
                    <strong>异常情况（需就医）：</strong><br>
                    • 大面积红肿、化脓<br>
                    • 原本没有痘痘的地方也爆发<br>
                    • 超过2周不见好转<br>
                    • 伴随严重瘙痒、刺痛<br><br>
                    <strong>💡 爆发期应对：</strong><br>
                    1. 不要用手挤压<br>
                    2. 加强保湿和防晒<br>
                    3. 暂停其他刺激性产品<br>
                    4. 耐心等待，坚持护理<br>
                    5. 严重时可配合红蓝光消炎<br><br>
                    <strong>🎯 预防建议：</strong>首次刷酸选择低浓度，逐步建立耐受，减少爆发反应。`,
                tags: ['刷酸', '爆痘', '爆发期']
            },

            // 护理建议
            {
                id: 14,
                category: 'care',
                categoryName: '护理建议',
                question: '治疗期间需要注意什么？',
                answer: `<strong>治疗期间的护理直接影响效果：</strong><br><br>
                    <strong>☀️ 防晒（最重要！）：</strong><br>
                    • 每天使用SPF50+ PA++++防晒霜<br>
                    • 每2-3小时补涂一次<br>
                    • 物理防晒：遮阳帽、遮阳伞、墨镜<br>
                    • 避免10:00-16:00户外暴晒<br><br>
                    <strong>💧 保湿修复：</strong><br>
                    • 使用温和无刺激的保湿产品<br>
                    • 避免含酒精、香精、色素的产品<br>
                    • 推荐成分：玻尿酸、神经酰胺、角鲨烷<br>
                    • 早晚各一次保湿<br><br>
                    <strong>🧼 温和清洁：</strong><br>
                    • 使用氨基酸洁面，避免皂基<br>
                    • 水温30-35℃，不要过热<br>
                    • 轻柔按摩，不要用力搓揉<br>
                    • 每天清洁2次（早晚）<br><br>
                    <strong>❌ 禁忌事项：</strong><br>
                    • 不要化浓妆，尤其是粉底<br>
                    • 禁止桑拿、蒸脸、热敷<br>
                    • 避免剧烈运动（大量出汗）<br>
                    • 不要游泳（泳池氯水刺激）<br>
                    • 禁止饮酒、吸烟<br>
                    • 不要熬夜（影响皮肤修复）<br><br>
                    <strong>🍎 饮食建议：</strong><br>
                    • 多吃蔬菜水果（补充维生素）<br>
                    • 少吃甜食、油炸、辛辣<br>
                    • 多喝水（每天1.5-2L）<br>
                    • 补充优质蛋白（鱼肉、鸡蛋）`,
                tags: ['术后护理', '注意事项', '日常护理']
            },
            {
                id: 15,
                category: 'care',
                categoryName: '护理建议',
                question: '治疗后可以化妆吗？',
                answer: `<strong>需要根据治疗项目和恢复情况判断：</strong><br><br>
                    <strong>✅ 可以化妆的情况：</strong><br>
                    • <strong>红蓝光治疗：</strong>当天即可化淡妆<br>
                    • <strong>清痘项目：</strong>24小时后可以化妆<br>
                    • <strong>果酸焕肤：</strong>3天后可化妆，避开刺激性产品<br><br>
                    <strong>⚠️ 需要等待的项目：</strong><br>
                    • <strong>光子嫩肤：</strong>3-5天后，皮肤无红肿<br>
                    • <strong>激光治疗：</strong>7-14天后，结痂完全脱落<br>
                    • <strong>光动力：</strong>3-7天后，脱皮结束<br><br>
                    <strong>💄 化妆建议：</strong><br>
                    1. <strong>产品选择：</strong><br>
                    &nbsp;&nbsp;- 使用温和、无刺激的产品<br>
                    &nbsp;&nbsp;- 避免含酒精、香精、防腐剂<br>
                    &nbsp;&nbsp;- 优先选择医美品牌或药妆<br><br>
                    2. <strong>化妆技巧：</strong><br>
                    &nbsp;&nbsp;- 轻薄底妆，不要厚涂<br>
                    &nbsp;&nbsp;- 避开有创口的部位<br>
                    &nbsp;&nbsp;- 使用干净的化妆工具<br><br>
                    3. <strong>卸妆护理：</strong><br>
                    &nbsp;&nbsp;- 温和卸妆，彻底清洁<br>
                    &nbsp;&nbsp;- 使用卸妆水/卸妆乳，避免卸妆油<br>
                    &nbsp;&nbsp;- 卸妆后及时保湿<br><br>
                    <strong>❌ 禁用产品：</strong><br>
                    • 含酒精的化妆水<br>
                    • 含激素的美白产品<br>
                    • 重金属超标的三无产品<br>
                    • 刺激性强的彩妆（如闪粉眼影）<br><br>
                    <strong>💡 最佳建议：</strong>治疗期间尽量素颜，让皮肤充分呼吸和修复。如必须化妆，选择医美级产品，画淡妆即可。`,
                tags: ['化妆', '术后护理', '产品选择']
            },
            {
                id: 16,
                category: 'care',
                categoryName: '护理建议',
                question: '夏天和冬天治疗有什么区别吗？',
                answer: `<strong>季节确实会影响治疗效果和恢复：</strong><br><br>
                    <strong>☀️ 夏季治疗（6-9月）：</strong><br>
                    <strong>优点：</strong><br>
                    • 出油多，更适合控油项目（光动力、刷酸）<br>
                    • 炎症性痤疮治疗效果更明显<br><br>
                    <strong>缺点：</strong><br>
                    • 紫外线强，色沉风险高<br>
                    • 容易出汗，影响伤口恢复<br>
                    • 防晒压力大<br><br>
                    <strong>建议：</strong><br>
                    • 优先选择：红蓝光、光动力、刷酸<br>
                    • 谨慎选择：激光治疗（易色沉）<br>
                    • 必须做好严格防晒<br><br>
                    <strong>❄️ 冬季治疗（11-3月）：</strong><br>
                    <strong>优点：</strong><br>
                    • 紫外线弱，色沉风险低<br>
                    • 最适合做激光治疗<br>
                    • 恢复期更舒适<br><br>
                    <strong>缺点：</strong><br>
                    • 皮肤容易干燥<br>
                    • 需加强保湿<br><br>
                    <strong>建议：</strong><br>
                    • 最佳选择：点阵激光、光子嫩肤<br>
                    • 加强保湿护理<br>
                    • 防晒仍然不能忽视<br><br>
                    <strong>🍂 春秋季（最佳治疗季）：</strong><br>
                    • 温度适宜，恢复快<br>
                    • 紫外线适中<br>
                    • 各类项目都适合<br>
                    • 皮肤状态稳定<br><br>
                    <strong>💡 季节护理重点：</strong><br>
                    • <strong>春季：</strong>抗过敏 + 防晒<br>
                    • <strong>夏季：</strong>控油 + 强防晒<br>
                    • <strong>秋季：</strong>补水 + 修复<br>
                    • <strong>冬季：</strong>保湿 + 防干燥<br><br>
                    <strong>🎯 总结：</strong>每个季节都可以治疗，关键是选对项目、做好护理。如果要做激光类项目，冬季最佳。`,
                tags: ['季节', '夏季', '冬季', '最佳时间']
            }
        ];

        let currentFAQCategory = 'all';

        // 页面加载时初始化FAQ
        document.addEventListener('DOMContentLoaded', function() {
            renderCases('all');
            initTimelineTreatmentSelect();
            renderFAQ('all', '');
            initAppointmentDate();
        });

        // 渲染FAQ列表
        function renderFAQ(category, searchKeyword) {
            const faqList = document.getElementById('faqList');
            const noResults = document.getElementById('faqNoResults');

            let filteredFAQs = FAQ_DATA;

            // 分类筛选
            if (category !== 'all') {
                filteredFAQs = filteredFAQs.filter(faq => faq.category === category);
            }

            // 搜索筛选
            if (searchKeyword) {
                const keyword = searchKeyword.toLowerCase();
                filteredFAQs = filteredFAQs.filter(faq =>
                    faq.question.toLowerCase().includes(keyword) ||
                    faq.answer.toLowerCase().includes(keyword) ||
                    faq.tags.some(tag => tag.toLowerCase().includes(keyword))
                );
            }

            // 显示结果或无结果提示
            if (filteredFAQs.length === 0) {
                faqList.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            faqList.style.display = 'block';
            noResults.style.display = 'none';

            // 生成FAQ HTML
            faqList.innerHTML = filteredFAQs.map(faq => `
                <div class="faq-item" data-id="${faq.id}">
                    <div class="faq-question" onclick="toggleFAQ(${faq.id})">
                        <div class="faq-question-text">
                            <span class="faq-category-tag">${faq.categoryName}</span>
                            ${faq.question}
                        </div>
                        <div class="faq-icon">▼</div>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-content">
                            ${faq.answer}
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                ${faq.tags.map(tag => `<span style="display: inline-block; padding: 4px 10px; background: #f0f0f0; color: #666; border-radius: 10px; font-size: 0.85em; margin-right: 8px; margin-top: 5px;">#${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 展开/折叠FAQ
        function toggleFAQ(id) {
            const item = document.querySelector(`.faq-item[data-id="${id}"]`);
            if (item) {
                item.classList.toggle('active');
            }
        }

        // 分类筛选
        function filterFAQCategory(category) {
            currentFAQCategory = category;

            // 更新按钮状态
            document.querySelectorAll('.faq-category-btn').forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // 获取当前搜索关键词
            const searchKeyword = document.getElementById('faqSearch').value;

            // 重新渲染
            renderFAQ(category, searchKeyword);
        }

        // 搜索FAQ
        function searchFAQ() {
            const searchKeyword = document.getElementById('faqSearch').value;
            renderFAQ(currentFAQCategory, searchKeyword);
        }

        // ========== 治疗时间线规划器 ==========

        // 初始化治疗项目下拉列表
        function initTimelineTreatmentSelect() {
            const select = document.getElementById('timelineTreatmentSelect');
            if (!select) return;

            // 清空现有选项（保留第一个提示选项）
            while (select.options.length > 1) {
                select.remove(1);
            }

            // 添加所有治疗项目
            MEDICAL_TREATMENTS.forEach(treatment => {
                const option = document.createElement('option');
                option.value = treatment.id;
                option.textContent = `${treatment.name} - ¥${treatment.price}`;
                select.appendChild(option);
            });

            // 设置默认开始日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('timelineStartDate').value = today;
        }

        // 更新时间线预览
        function updateTimelinePreview() {
            const treatmentId = document.getElementById('timelineTreatmentSelect').value;
            const startDate = document.getElementById('timelineStartDate').value;
            const sessionCount = parseInt(document.getElementById('timelineSessionCount').value);
            const interval = parseInt(document.getElementById('timelineInterval').value);

            // 如果未选择项目或未选择日期，显示空状态
            if (!treatmentId || !startDate) {
                document.getElementById('timelineEmptyState').style.display = 'block';
                document.getElementById('timelineContent').style.display = 'none';
                document.getElementById('selectedTreatmentInfo').style.display = 'none';
                return;
            }

            // 查找选中的治疗项目
            const treatment = MEDICAL_TREATMENTS.find(t => t.id == treatmentId);
            if (!treatment) return;

            // 显示项目信息
            showTreatmentInfo(treatment);

            // 生成时间线
            generateTimeline(treatment, startDate, sessionCount, interval);

            // 显示时间线内容，隐藏空状态
            document.getElementById('timelineEmptyState').style.display = 'none';
            document.getElementById('timelineContent').style.display = 'block';
        }

        // 显示治疗项目信息
        function showTreatmentInfo(treatment) {
            const infoDiv = document.getElementById('selectedTreatmentInfo');
            const contentDiv = document.getElementById('treatmentInfoContent');

            contentDiv.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong style="color: #667eea;">项目名称：</strong>${treatment.name}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong style="color: #667eea;">单次价格：</strong>¥${treatment.price}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong style="color: #667eea;">推荐疗程：</strong>${treatment.course}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong style="color: #667eea;">恢复期：</strong>${treatment.recovery}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong style="color: #667eea;">适用范围：</strong>${treatment.symptoms?.join('、') || '多种痤疮症状'}
                </div>
            `;

            infoDiv.style.display = 'block';
        }

        // 生成时间线
        function generateTimeline(treatment, startDateStr, sessionCount, intervalDays) {
            const startDate = new Date(startDateStr);
            const timelineList = document.getElementById('timelineList');

            // 清空现有时间线
            timelineList.innerHTML = '';

            // 计算总时长和结束日期
            const totalDays = (sessionCount - 1) * intervalDays;
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + totalDays);

            // 更新概览信息
            document.getElementById('totalDuration').textContent = `${totalDays}天`;
            document.getElementById('totalSessions').textContent = `${sessionCount}次`;
            document.getElementById('endDate').textContent = formatDate(endDate);

            // 获取恢复期天数（从字符串解析）
            const recoveryDays = parseRecoveryDays(treatment.recovery);

            // 生成每次治疗的时间线项
            for (let i = 0; i < sessionCount; i++) {
                const sessionDate = new Date(startDate);
                sessionDate.setDate(sessionDate.getDate() + i * intervalDays);

                // 治疗日
                const sessionItem = createTimelineItem({
                    number: i + 1,
                    date: sessionDate,
                    title: `第${i + 1}次治疗`,
                    description: `进行${treatment.name}治疗`,
                    type: 'treatment',
                    icon: '💉',
                    details: [
                        `治疗项目：${treatment.name}`,
                        `单次费用：¥${treatment.price}`,
                        `治疗时长：${treatment.duration || '30-60分钟'}`
                    ]
                });
                timelineList.appendChild(sessionItem);

                // 恢复期（如果有）
                if (recoveryDays > 0) {
                    const recoveryEndDate = new Date(sessionDate);
                    recoveryEndDate.setDate(recoveryEndDate.getDate() + recoveryDays);

                    const recoveryItem = createTimelineItem({
                        date: recoveryEndDate,
                        title: `恢复期结束`,
                        description: `预计${recoveryDays}天恢复期`,
                        type: 'recovery',
                        icon: '🌱',
                        details: [
                            `恢复时间：${recoveryDays}天`,
                            '注意防晒和补水',
                            '避免化妆和剧烈运动'
                        ]
                    });
                    timelineList.appendChild(recoveryItem);
                }

                // 间隔期提醒（不是最后一次）
                if (i < sessionCount - 1) {
                    const nextSessionDate = new Date(sessionDate);
                    nextSessionDate.setDate(nextSessionDate.getDate() + intervalDays);

                    const intervalItem = createTimelineItem({
                        date: nextSessionDate,
                        title: `准备下次治疗`,
                        description: `距离上次治疗${intervalDays}天`,
                        type: 'interval',
                        icon: '⏰',
                        details: [
                            `治疗间隔：${intervalDays}天`,
                            '观察皮肤状况',
                            '提前预约下次治疗'
                        ]
                    });
                    // 间隔项不单独显示，合并到下次治疗
                }
            }

            // 添加疗程完成标记
            const completionItem = createTimelineItem({
                date: endDate,
                title: '🎉 疗程完成',
                description: `恭喜完成${sessionCount}次治疗`,
                type: 'completion',
                icon: '🎊',
                details: [
                    `总治疗次数：${sessionCount}次`,
                    `总疗程时长：${totalDays}天`,
                    `预计总费用：¥${treatment.price * sessionCount}`,
                    '建议定期复查皮肤状况'
                ]
            });
            timelineList.appendChild(completionItem);
        }

        // 创建时间线项元素
        function createTimelineItem(config) {
            const { number, date, title, description, type, icon, details } = config;

            const item = document.createElement('div');
            item.className = `timeline-item ${type}`;

            let html = '';

            // 如果有编号，显示编号徽章
            if (number) {
                html += `<div class="timeline-item-number">${number}</div>`;
            }

            html += `
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div style="font-size: 2em;">${icon}</div>
                    <div style="flex: 1;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h5 style="margin: 0; color: #2c3e50; font-size: 1.1em;">${title}</h5>
                            <span style="color: #7f8c8d; font-size: 0.9em;">${formatDate(date)}</span>
                        </div>
                        <p style="margin: 0 0 12px 0; color: #7f8c8d; font-size: 0.95em;">${description}</p>
            `;

            if (details && details.length > 0) {
                html += '<ul style="margin: 0; padding-left: 20px; color: #555;">';
                details.forEach(detail => {
                    html += `<li style="margin: 5px 0; font-size: 0.9em;">${detail}</li>`;
                });
                html += '</ul>';
            }

            html += `
                    </div>
                </div>
            `;

            item.innerHTML = html;
            return item;
        }

        // 解析恢复期天数
        function parseRecoveryDays(recoveryStr) {
            if (!recoveryStr) return 0;

            // 匹配 "X天" 或 "X-Y天" 格式
            const match = recoveryStr.match(/(\d+)[-~]?(\d+)?天/);
            if (match) {
                // 如果是范围，取平均值
                if (match[2]) {
                    return Math.ceil((parseInt(match[1]) + parseInt(match[2])) / 2);
                }
                return parseInt(match[1]);
            }

            // 如果包含"无"或"不需要"，返回0
            if (recoveryStr.includes('无') || recoveryStr.includes('不需要')) {
                return 0;
            }

            // 默认返回3天
            return 3;
        }

        // 格式化日期
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const weekdays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
            const weekday = weekdays[date.getDay()];

            return `${year}/${month}/${day} ${weekday}`;
        }

        // 重置时间线
        function resetTimeline() {
            // 重置所有输入
            document.getElementById('timelineTreatmentSelect').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('timelineStartDate').value = today;
            document.getElementById('timelineSessionCount').value = 3;
            document.getElementById('sessionCountDisplay').textContent = '3';
            document.getElementById('timelineInterval').value = 21;
            document.getElementById('intervalDisplay').textContent = '21';

            // 隐藏时间线内容，显示空状态
            document.getElementById('timelineEmptyState').style.display = 'block';
            document.getElementById('timelineContent').style.display = 'none';
            document.getElementById('selectedTreatmentInfo').style.display = 'none';
        }

    </script>

    <!-- 症状详情弹窗 -->
    <div id="symptomDetailModal" class="detail-modal">
        <div class="detail-modal-content" onclick="event.stopPropagation();">
            <button class="modal-close-btn" onclick="closeSymptomModal()" style="position: absolute; top: 20px; right: 20px; background: #f0f0f0; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 20px; color: #666; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                ×
            </button>
            <div id="symptomDetailModalBody"></div>
        </div>
    </div>

    <!-- PWA 安装提示横幅 -->
    <div id="pwaInstallBanner" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(102,126,234,0.5); z-index: 9999; max-width: 90%; width: 500px; animation: slideUp 0.5s;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="font-size: 2em;">📱</div>
            <div style="flex: 1;">
                <div style="font-weight: bold; margin-bottom: 5px;">安装到主屏幕</div>
                <div style="font-size: 0.9em; opacity: 0.9;">像APP一样使用，支持离线访问</div>
            </div>
            <button onclick="installPWA()" style="background: white; color: #667eea; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                安装
            </button>
            <button onclick="closePWABanner()" style="background: transparent; color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                稍后
            </button>
        </div>
    </div>

    <!-- PWA 安装成功提示 -->
    <div id="pwaInstallSuccess" style="display: none; position: fixed; top: 80px; right: 30px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 20px rgba(40,167,69,0.4); z-index: 10001; animation: slideInRight 0.3s;">
        <div style="display: flex; align-items: center; gap: 10px;">
            <div style="font-size: 1.5em;">✅</div>
            <div>
                <div style="font-weight: bold;">安装成功！</div>
                <div style="font-size: 0.9em; opacity: 0.9;">现在可以离线访问了</div>
            </div>
        </div>
    </div>

    <!-- PWA 离线提示 -->
    <div id="pwaOfflineNotice" style="display: none; position: fixed; top: 0; left: 0; right: 0; background: #ffc107; color: #333; padding: 10px; text-align: center; z-index: 10000; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <span style="font-weight: bold;">📡 您当前处于离线状态</span> - 正在使用缓存内容
    </div>

    <!-- Service Worker 注册代码 -->
    <script>
        // PWA相关变量
        let deferredPrompt;
        let isInstalled = false;

        // 检查是否已安装为PWA
        function checkIfPWAInstalled() {
            // 检查是否在standalone模式下运行
            if (window.matchMedia('(display-mode: standalone)').matches) {
                isInstalled = true;
                console.log('[PWA] 应用已安装');
                return true;
            }

            // iOS Safari检测
            if (window.navigator.standalone === true) {
                isInstalled = true;
                console.log('[PWA] 应用已安装（iOS）');
                return true;
            }

            return false;
        }

        // 注册Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('[PWA] Service Worker注册成功:', registration.scope);

                        // 检查更新
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[PWA] 发现新版本');

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[PWA] 新版本已准备好');
                                    // 可以在这里提示用户刷新页面
                                    if (confirm('发现新版本，是否立即更新？')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });

                        // 监听Service Worker控制器变化
                        navigator.serviceWorker.addEventListener('controllerchange', () => {
                            console.log('[PWA] Service Worker已更新');
                        });
                    })
                    .catch((error) => {
                        console.error('[PWA] Service Worker注册失败:', error);
                    });
            });

            // 监听在线/离线状态
            window.addEventListener('online', () => {
                console.log('[PWA] 已恢复网络连接');
                document.getElementById('pwaOfflineNotice').style.display = 'none';
            });

            window.addEventListener('offline', () => {
                console.log('[PWA] 网络连接已断开');
                document.getElementById('pwaOfflineNotice').style.display = 'block';
            });

            // 初始检查网络状态
            if (!navigator.onLine) {
                document.getElementById('pwaOfflineNotice').style.display = 'block';
            }
        }

        // 监听PWA安装提示事件
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('[PWA] 安装提示事件触发');
            // 阻止默认的安装提示
            e.preventDefault();
            deferredPrompt = e;

            // 如果还没安装，显示自定义安装横幅
            if (!checkIfPWAInstalled()) {
                // 延迟3秒显示，避免打扰用户
                setTimeout(() => {
                    const banner = document.getElementById('pwaInstallBanner');
                    if (banner && !localStorage.getItem('pwa_banner_dismissed')) {
                        banner.style.display = 'block';
                    }
                }, 3000);
            }
        });

        // PWA安装函数
        async function installPWA() {
            if (!deferredPrompt) {
                console.log('[PWA] 安装提示不可用');
                alert('您的浏览器不支持PWA安装，或者已经安装了。');
                return;
            }

            // 显示安装提示
            deferredPrompt.prompt();

            // 等待用户响应
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`[PWA] 用户选择: ${outcome}`);

            if (outcome === 'accepted') {
                console.log('[PWA] 用户接受安装');
                closePWABanner();
                showPWAInstallSuccess();
            } else {
                console.log('[PWA] 用户拒绝安装');
            }

            // 清除deferredPrompt
            deferredPrompt = null;
        }

        // 关闭PWA横幅
        function closePWABanner() {
            const banner = document.getElementById('pwaInstallBanner');
            if (banner) {
                banner.style.animation = 'slideDown 0.3s';
                setTimeout(() => {
                    banner.style.display = 'none';
                }, 300);
            }
            // 记录用户已关闭，7天内不再显示
            localStorage.setItem('pwa_banner_dismissed', Date.now());
        }

        // 显示安装成功提示
        function showPWAInstallSuccess() {
            const successNotice = document.getElementById('pwaInstallSuccess');
            if (successNotice) {
                successNotice.style.display = 'block';
                setTimeout(() => {
                    successNotice.style.animation = 'slideOutRight 0.3s';
                    setTimeout(() => {
                        successNotice.style.display = 'none';
                    }, 300);
                }, 3000);
            }
        }

        // 监听PWA安装完成事件
        window.addEventListener('appinstalled', () => {
            console.log('[PWA] PWA已成功安装');
            isInstalled = true;
            closePWABanner();
            showPWAInstallSuccess();
        });

        // 页面加载时检查PWA横幅是否应该显示
        document.addEventListener('DOMContentLoaded', () => {
            checkIfPWAInstalled();

            // 检查横幅关闭记录
            const dismissedTime = localStorage.getItem('pwa_banner_dismissed');
            if (dismissedTime) {
                const sevenDays = 7 * 24 * 60 * 60 * 1000;
                if (Date.now() - parseInt(dismissedTime) > sevenDays) {
                    // 超过7天，清除记录
                    localStorage.removeItem('pwa_banner_dismissed');
                }
            }
        });

        // 添加PWA相关的CSS动画
        const pwaStyles = document.createElement('style');
        pwaStyles.textContent = `
            @keyframes slideUp {
                from {
                    transform: translateX(-50%) translateY(100px);
                    opacity: 0;
                }
                to {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
            }

            @keyframes slideDown {
                from {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(-50%) translateY(100px);
                    opacity: 0;
                }
            }

            @keyframes slideInRight {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }

            /* 移动端适配 */
            @media (max-width: 768px) {
                #pwaInstallBanner {
                    bottom: 10px;
                    padding: 12px 15px;
                    width: 95%;
                }

                #pwaInstallBanner > div {
                    flex-direction: column;
                    text-align: center;
                }

                #pwaInstallBanner button {
                    width: 100%;
                    margin-top: 8px;
                }

                #pwaInstallSuccess {
                    right: 10px;
                    left: 10px;
                }
            }
        `;
        document.head.appendChild(pwaStyles);
    </script>

    <!-- PDF报告生成器 -->
    <script>
        // PDF报告生成函数
        async function generatePDFReport() {
            try {
                // 检查jsPDF是否加载
                if (typeof window.jspdf === 'undefined') {
                    alert('⚠️ PDF生成库加载失败，请刷新页面重试');
                    return;
                }

                // 显示生成中提示
                const loadingToast = showToast('⏳ 正在生成PDF报告...', 'info', 0);

                // 收集数据
                const gagsResult = localStorage.getItem('gagsAssessmentResult');
                const decisionTreeAnswers = localStorage.getItem('decisionTreeAnswers');
                const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
                const trackingRecords = JSON.parse(localStorage.getItem('trackingRecords') || '[]');

                // 解析GAGS评分数据
                let gagsData = null;
                if (gagsResult) {
                    try {
                        gagsData = JSON.parse(gagsResult);
                    } catch (e) {
                        console.warn('GAGS数据解析失败:', e);
                    }
                }

                // 解析决策树数据
                let decisionData = null;
                if (decisionTreeAnswers) {
                    try {
                        decisionData = JSON.parse(decisionTreeAnswers);
                    } catch (e) {
                        console.warn('决策树数据解析失败:', e);
                    }
                }

                // 创建PDF文档
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                let yPosition = 20;
                const pageWidth = 210; // A4宽度
                const pageHeight = 297; // A4高度
                const marginLeft = 20;
                const marginRight = 20;
                const contentWidth = pageWidth - marginLeft - marginRight;

                // 添加新页面的函数
                function addNewPageIfNeeded(requiredSpace) {
                    if (yPosition + requiredSpace > pageHeight - 20) {
                        doc.addPage();
                        yPosition = 20;
                        return true;
                    }
                    return false;
                }

                // 设置文本函数（由于jsPDF中文支持限制，使用基础字体）
                function addTitle(text, fontSize = 20) {
                    doc.setFontSize(fontSize);
                    doc.setFont('helvetica', 'bold');
                    doc.text(text, pageWidth / 2, yPosition, { align: 'center' });
                    yPosition += 10;
                }

                function addSectionTitle(text, fontSize = 14) {
                    addNewPageIfNeeded(15);
                    doc.setFontSize(fontSize);
                    doc.setFont('helvetica', 'bold');
                    doc.text(text, marginLeft, yPosition);
                    yPosition += 8;
                }

                function addText(text, fontSize = 11) {
                    doc.setFontSize(fontSize);
                    doc.setFont('helvetica', 'normal');

                    // 文本换行处理
                    const lines = doc.splitTextToSize(text, contentWidth);
                    for (let i = 0; i < lines.length; i++) {
                        addNewPageIfNeeded(7);
                        doc.text(lines[i], marginLeft, yPosition);
                        yPosition += 6;
                    }
                }

                function addBulletPoint(text, fontSize = 11) {
                    addNewPageIfNeeded(7);
                    doc.setFontSize(fontSize);
                    doc.setFont('helvetica', 'normal');

                    const bulletWidth = 5;
                    doc.text('•', marginLeft, yPosition);

                    const lines = doc.splitTextToSize(text, contentWidth - bulletWidth);
                    for (let i = 0; i < lines.length; i++) {
                        if (i > 0) addNewPageIfNeeded(7);
                        doc.text(lines[i], marginLeft + bulletWidth, yPosition);
                        yPosition += 6;
                    }
                }

                function addDivider() {
                    addNewPageIfNeeded(5);
                    doc.setDrawColor(200, 200, 200);
                    doc.line(marginLeft, yPosition, pageWidth - marginRight, yPosition);
                    yPosition += 8;
                }

                // ========== 报告标题 ==========
                addTitle('Acne Treatment Plan Report', 22);
                addText('Personalized Treatment Recommendation', 12);
                addText('Generated: ' + new Date().toLocaleString('zh-CN'), 10);
                yPosition += 5;
                addDivider();

                // ========== 1. GAGS评分结果 ==========
                addSectionTitle('1. GAGS Assessment Results');
                if (gagsData && gagsData.totalScore !== undefined) {
                    addBulletPoint('Total Score: ' + gagsData.totalScore + ' points');
                    addBulletPoint('Severity Level: ' + (gagsData.severity || 'Not assessed'));

                    if (gagsData.details) {
                        yPosition += 3;
                        addText('Score Details:', 11);
                        Object.keys(gagsData.details).forEach(area => {
                            const score = gagsData.details[area];
                            addBulletPoint(`  ${area}: ${score} points`);
                        });
                    }
                } else {
                    addText('No GAGS assessment data found. Please complete the assessment first.');
                }
                yPosition += 5;
                addDivider();

                // ========== 2. 推荐治疗方案 ==========
                addSectionTitle('2. Recommended Treatment Plan');

                // 从决策树获取推荐方案
                if (decisionData && decisionData.recommendedTreatments) {
                    addText('Based on your assessment, the following treatments are recommended:');
                    yPosition += 2;
                    decisionData.recommendedTreatments.forEach(treatment => {
                        addBulletPoint(treatment.name || treatment);
                    });
                } else if (bookmarks.length > 0) {
                    addText('Based on your bookmarked treatments:');
                    yPosition += 2;
                    bookmarks.forEach(bookmark => {
                        addBulletPoint(bookmark.title || bookmark);
                    });
                } else {
                    addText('No specific treatment recommendations yet.');
                    addText('Please complete the decision tree or bookmark treatments of interest.');
                }

                yPosition += 5;
                addDivider();

                // ========== 3. 治疗时间规划 ==========
                addSectionTitle('3. Treatment Timeline');
                addText('General Treatment Duration Guidelines:');
                yPosition += 2;

                if (gagsData && gagsData.totalScore) {
                    const score = gagsData.totalScore;
                    if (score < 19) {
                        addBulletPoint('Mild acne: 3-6 months treatment cycle');
                        addBulletPoint('Recommended sessions: 3-5 sessions');
                        addBulletPoint('Session interval: 2-4 weeks');
                    } else if (score < 31) {
                        addBulletPoint('Moderate acne: 6-12 months treatment cycle');
                        addBulletPoint('Recommended sessions: 6-10 sessions');
                        addBulletPoint('Session interval: 3-4 weeks');
                    } else {
                        addBulletPoint('Severe acne: 12-18 months treatment cycle');
                        addBulletPoint('Recommended sessions: 10-15 sessions');
                        addBulletPoint('Session interval: 3-4 weeks');
                    }
                } else {
                    addBulletPoint('Please complete GAGS assessment for personalized timeline');
                }

                yPosition += 5;
                addDivider();

                // ========== 4. 预估费用范围 ==========
                addSectionTitle('4. Estimated Cost Range');
                addText('Cost estimates are based on typical treatment requirements:');
                yPosition += 2;

                if (gagsData && gagsData.totalScore) {
                    const score = gagsData.totalScore;
                    if (score < 19) {
                        addBulletPoint('Mild acne treatment: RMB 3,000 - 8,000');
                        addBulletPoint('Per session average: RMB 800 - 1,500');
                    } else if (score < 31) {
                        addBulletPoint('Moderate acne treatment: RMB 8,000 - 20,000');
                        addBulletPoint('Per session average: RMB 1,200 - 2,500');
                    } else {
                        addBulletPoint('Severe acne treatment: RMB 20,000 - 50,000+');
                        addBulletPoint('Per session average: RMB 2,000 - 4,000');
                    }
                } else {
                    addBulletPoint('Please complete assessment for cost estimation');
                }

                yPosition += 2;
                addText('Note: Final pricing depends on specific treatments, clinic location, and individual conditions.', 9);

                yPosition += 5;
                addDivider();

                // ========== 5. 护理注意事项 ==========
                addSectionTitle('5. Care Instructions');
                addText('Pre-treatment Preparation:');
                yPosition += 2;
                addBulletPoint('Avoid sun exposure 2 weeks before treatment');
                addBulletPoint('Stop using retinoids/acids 1 week before');
                addBulletPoint('Inform doctor of any medications or allergies');

                yPosition += 3;
                addText('Post-treatment Care:');
                yPosition += 2;
                addBulletPoint('Gentle cleansing with mild cleanser');
                addBulletPoint('Apply sunscreen (SPF 30+) daily');
                addBulletPoint('Avoid makeup for 24-48 hours post-treatment');
                addBulletPoint('Keep skin moisturized');
                addBulletPoint('Avoid picking or squeezing');

                yPosition += 5;
                addDivider();

                // ========== 6. 专家建议 ==========
                addSectionTitle('6. Expert Recommendations');
                addText('Important Reminders:');
                yPosition += 2;
                addBulletPoint('This report is for reference only and not a medical diagnosis');
                addBulletPoint('In-person consultation required for final treatment plan');
                addBulletPoint('Treatment effectiveness varies by individual');
                addBulletPoint('Maintain healthy lifestyle: adequate sleep, balanced diet');
                addBulletPoint('Be patient - acne treatment requires time');

                yPosition += 3;
                addText('Next Steps:');
                yPosition += 2;
                addBulletPoint('Book an appointment with our dermatology specialists');
                addBulletPoint('Bring this report to your consultation');
                addBulletPoint('Discuss treatment options and expected outcomes');
                addBulletPoint('Follow prescribed treatment plan consistently');

                yPosition += 10;
                addDivider();

                // ========== 页脚信息 ==========
                addNewPageIfNeeded(20);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'italic');
                doc.text('United Liggett Southwest Center - Medical Aesthetics Division', pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 5;
                doc.text('Report generated by online assessment system', pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 5;
                doc.text('For appointment: consultation hotline or online booking', pageWidth / 2, yPosition, { align: 'center' });

                // 保存PDF
                const fileName = `Acne_Treatment_Plan_${new Date().getTime()}.pdf`;
                doc.save(fileName);

                // 关闭加载提示，显示成功消息
                if (loadingToast) loadingToast.remove();
                showToast('✅ PDF报告已生成并下载！', 'success', 3000);

                // 记录生成事件
                console.log('[PDF Generator] 报告生成成功:', fileName);

            } catch (error) {
                console.error('[PDF Generator] 生成失败:', error);
                alert('❌ PDF生成失败: ' + error.message);
            }
        }

        // Toast提示函数
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');

            const bgColors = {
                'info': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'success': 'linear-gradient(135deg, #28a745 0%, #20c997 100%)',
                'error': 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)'
            };

            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 30px;
                background: ${bgColors[type] || bgColors.info};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                z-index: 10001;
                font-weight: bold;
                animation: slideInRight 0.3s;
                max-width: 350px;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            if (duration > 0) {
                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s';
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }

            return toast;
        }
    </script>

    <!-- 主题切换功能 -->
    <script>
        // 主题管理
        const themeManager = {
            // 获取当前主题
            getCurrentTheme() {
                return localStorage.getItem('theme') || this.getSystemTheme();
            },

            // 获取系统主题偏好
            getSystemTheme() {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    return 'dark';
                }
                return 'light';
            },

            // 设置主题
            setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                this.updateThemeIcon(theme);
                console.log(`[Theme] 主题已切换为: ${theme}`);
            },

            // 更新主题图标
            updateThemeIcon(theme) {
                const icon = document.getElementById('themeIcon');
                if (!icon) return;

                if (theme === 'dark') {
                    icon.textContent = '☀️'; // 深色模式显示太阳图标
                } else {
                    icon.textContent = '🌙'; // 浅色模式显示月亮图标
                }
            },

            // 切换主题
            toggle() {
                const currentTheme = this.getCurrentTheme();
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                this.setTheme(newTheme);

                // 显示切换提示
                this.showThemeToast(newTheme);
            },

            // 显示切换提示
            showThemeToast(theme) {
                const toast = document.createElement('div');
                const themeText = theme === 'dark' ? '深色模式' : '浅色模式';
                toast.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 30px;
                    background: ${theme === 'dark' ? '#2a2a3e' : '#ffffff'};
                    color: ${theme === 'dark' ? '#e0e0e0' : '#333'};
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                    z-index: 10001;
                    font-weight: bold;
                    animation: slideInRight 0.3s;
                `;
                toast.textContent = `已切换到${themeText}`;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s';
                    setTimeout(() => toast.remove(), 300);
                }, 2000);
            },

            // 初始化
            init() {
                const currentTheme = this.getCurrentTheme();
                this.setTheme(currentTheme);

                // 监听系统主题变化
                if (window.matchMedia) {
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                        // 如果用户没有手动设置过主题，跟随系统
                        if (!localStorage.getItem('theme')) {
                            const newTheme = e.matches ? 'dark' : 'light';
                            this.setTheme(newTheme);
                            console.log('[Theme] 跟随系统主题:', newTheme);
                        }
                    });
                }

                console.log('[Theme] 主题管理器初始化完成，当前主题:', currentTheme);
            }
        };

        // 主题切换函数（供HTML调用）
        function toggleTheme() {
            themeManager.toggle();
        }

        // 页面加载时初始化主题
        (function() {
            themeManager.init();
        })();

        // 添加键盘快捷键：Ctrl/Cmd + Shift + T 切换主题
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'T') {
                e.preventDefault();
                toggleTheme();
            }
        });
    </script>
</body>
</html>