<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI模型管理系统 - 演示页面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .demo-header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .demo-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .demo-nav {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .toast.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 50px;
            padding: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .footer h3 {
            margin-bottom: 15px;
        }

        .footer p {
            opacity: 0.9;
            line-height: 1.6;
        }

        .stats-summary {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }

        .stats-summary h2 {
            margin-bottom: 20px;
            color: #1f2937;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-box {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-radius: 12px;
        }

        .stat-box .value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-box .label {
            color: #6b7280;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- 页面标题 -->
    <div class="demo-header">
        <h1>🤖 AI模型管理系统</h1>
        <p>一个完整的多模型AI集成解决方案</p>
    </div>

    <!-- 导航栏 -->
    <div class="demo-nav">
        <button class="nav-btn active" onclick="switchSection('overview')">📊 系统概览</button>
        <button class="nav-btn" onclick="switchSection('config')">🔧 模型配置</button>
        <button class="nav-btn" onclick="switchSection('selector')">🤖 模型选择</button>
        <button class="nav-btn" onclick="switchSection('dashboard')">📈 成本统计</button>
        <button class="nav-btn" onclick="switchSection('demo')">💬 对话演示</button>
    </div>

    <!-- 系统概览 -->
    <div id="overview-section" class="section active">
        <div class="stats-summary">
            <h2>📊 系统统计</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="value" id="total-code-lines">4,580</div>
                    <div class="label">总代码行数</div>
                </div>
                <div class="stat-box">
                    <div class="value">10</div>
                    <div class="label">核心类</div>
                </div>
                <div class="stat-box">
                    <div class="value">6</div>
                    <div class="label">支持模型</div>
                </div>
                <div class="stat-box">
                    <div class="value">85%</div>
                    <div class="label">项目进度</div>
                </div>
            </div>
        </div>

        <div class="stats-summary">
            <h2>✨ 核心特性</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">🎯 智能路由</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        自动评估问题复杂度，智能选择最优模型，支持三种降级策略
                    </p>
                </div>
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #10b981; margin-bottom: 10px;">💰 成本控制</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        实时成本追踪，预算管理，支持日/周/月统计报告
                    </p>
                </div>
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #f59e0b; margin-bottom: 10px;">⚡ 性能优化</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        LRU缓存机制，减少API调用，提升响应速度
                    </p>
                </div>
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #8b5cf6; margin-bottom: 10px;">🎨 精美UI</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        现代化界面设计，响应式布局，完美的用户体验
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 模型配置 -->
    <div id="config-section" class="section">
        <div id="ai-config-panel"></div>
    </div>

    <!-- 模型选择 -->
    <div id="selector-section" class="section">
        <div id="ai-model-selector"></div>
    </div>

    <!-- 成本统计 -->
    <div id="dashboard-section" class="section">
        <div id="ai-cost-dashboard"></div>
    </div>

    <!-- 对话演示 -->
    <div id="demo-section" class="section">
        <div class="stats-summary">
            <h2>💬 AI对话演示</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">
                配置API Key后即可开始对话（当前为演示模式）
            </p>

            <div style="background: #f9fafb; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                <input type="text"
                       id="chat-input"
                       placeholder="请输入您的问题..."
                       style="width: 100%; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1em;">
            </div>

            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="sendDemoMessage()"
                        style="padding: 12px 30px; border: none; border-radius: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; cursor: pointer;">
                    发送消息
                </button>
                <button onclick="testCache()"
                        style="padding: 12px 30px; border: none; border-radius: 25px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-weight: 600; cursor: pointer;">
                    测试缓存
                </button>
                <button onclick="testRouter()"
                        style="padding: 12px 30px; border: none; border-radius: 25px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; font-weight: 600; cursor: pointer;">
                    测试路由
                </button>
            </div>

            <div id="chat-output" style="margin-top: 20px; padding: 20px; background: white; border-radius: 12px; min-height: 200px;">
                <div style="color: #9ca3af; text-align: center; padding: 40px;">
                    暂无对话记录
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <div class="footer">
        <h3>🎉 Phase 3 UI开发完成！</h3>
        <p>
            已完成：模型配置面板（650行）+ 模型选择器（550行）+ 成本仪表盘（700行）<br>
            总代码量：4,580行 | 当前进度：85%<br>
            下一步：集成到实际应用 + 完整测试
        </p>
    </div>

    <!-- 引入所有JS文件 -->
    <script src="js/ai-models/providers/base-provider.js"></script>
    <script src="js/ai-models/providers/qwen-provider.js"></script>
    <script src="js/ai-models/providers/glm-provider.js"></script>
    <script src="js/ai-models/model-manager.js"></script>
    <script src="js/ai-models/utils/smart-router.js"></script>
    <script src="js/ai-models/utils/cost-tracker.js"></script>
    <script src="js/ai-models/utils/response-cache.js"></script>
    <script src="js/ai-models/ui/config-panel.js"></script>
    <script src="js/ai-models/ui/model-selector.js"></script>
    <script src="js/ai-models/ui/cost-dashboard.js"></script>

    <script>
        // ========== 初始化系统 ==========
        console.log('%c🤖 AI模型管理系统初始化中...', 'color: #667eea; font-size: 18px; font-weight: bold;');

        const manager = new AIModelManager();
        const router = new SmartRouter(manager);
        const tracker = new CostTracker();
        const cache = new ResponseCache();

        // 注册演示Provider（使用模拟数据）
        try {
            // 注册glm-4-flash（免费模型）
            manager.registerProvider('glm-4-flash', {
                chat: async () => ({ content: '这是GLM-4-Flash的模拟响应', cost: 0, usage: { inputTokens: 10, outputTokens: 15 } }),
                streamChat: async () => {},
                getModelInfo: () => ({ provider: 'ChatGLM', model: 'glm-4-flash', stats: { totalCalls: 42, totalCost: 0 } })
            });

            // 注册qwen-plus
            manager.registerProvider('qwen-plus', {
                chat: async () => ({ content: '这是Qwen-Plus的模拟响应', cost: 0.016, usage: { inputTokens: 10, outputTokens: 15 } }),
                streamChat: async () => {},
                getModelInfo: () => ({ provider: '通义千问', model: 'qwen-plus', stats: { totalCalls: 28, totalCost: 0.45 } })
            });

            manager.setCurrentModel('glm-4-flash');
            console.log('%c✓ Provider注册成功', 'color: #10b981; font-weight: bold;');
        } catch (error) {
            console.error('Provider注册失败:', error);
        }

        // ========== 渲染UI组件 ==========
        const configPanel = new ConfigPanel(manager);
        configPanel.render();
        window.configPanel = configPanel;

        const modelSelector = new ModelSelector(manager, {
            mode: 'both',
            onChange: (model) => {
                showToast(`已切换到 ${model}`, 'success');
            }
        });
        modelSelector.render();
        window.modelSelector = modelSelector;

        const costDashboard = new CostDashboard(tracker);
        costDashboard.render();
        window.costDashboard = costDashboard;

        console.log('%c✓ UI组件渲染完成', 'color: #10b981; font-weight: bold;');

        // ========== 工具函数 ==========
        function switchSection(section) {
            // 隐藏所有section
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));

            // 显示选中的section
            document.getElementById(section + '-section').classList.add('active');
            event.target.classList.add('active');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        window.showToast = showToast;  // 全局访问

        // ========== 演示功能 ==========
        async function sendDemoMessage() {
            const input = document.getElementById('chat-input');
            const output = document.getElementById('chat-output');
            const message = input.value.trim();

            if (!message) {
                showToast('请输入消息', 'error');
                return;
            }

            try {
                showToast('正在处理...', 'info');

                // 模拟API调用
                const response = await manager.chat([{ role: 'user', content: message }]);

                // 记录成本
                tracker.track({
                    model: manager.getCurrentModel(),
                    inputTokens: response.usage.inputTokens,
                    outputTokens: response.usage.outputTokens,
                    cost: response.cost,
                    responseTime: 1200,
                    success: true
                });

                // 显示响应
                output.innerHTML = `
                    <div style="margin-bottom: 15px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                        <strong>用户:</strong> ${message}
                    </div>
                    <div style="padding: 15px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #10b981;">
                        <strong>AI (${manager.getCurrentModel()}):</strong> ${response.content}
                        <div style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                            费用: ¥${response.cost.toFixed(4)} | 响应时间: 1.2s
                        </div>
                    </div>
                `;

                input.value = '';
                showToast('响应成功！', 'success');

            } catch (error) {
                showToast('发送失败: ' + error.message, 'error');
            }
        }

        function testCache() {
            const stats = cache.getStats();
            showToast(`缓存命中率: ${stats.hitRate} | 节省: ¥${stats.totalSaved.toFixed(4)}`, 'info');
        }

        function testRouter() {
            const config = router.getConfig();
            showToast('路由配置已加载，详情请查看控制台', 'info');
            console.log('路由配置:', config);
        }

        // 添加模拟数据以便演示
        for (let i = 0; i < 5; i++) {
            tracker.track({
                model: i % 2 === 0 ? 'glm-4-flash' : 'qwen-plus',
                inputTokens: 100 + i * 10,
                outputTokens: 150 + i * 15,
                cost: i % 2 === 0 ? 0 : 0.004 * (i + 1),
                responseTime: 1000 + i * 100,
                success: true
            });
        }

        console.log('%c🎉 系统初始化完成！', 'color: #10b981; font-size: 18px; font-weight: bold;');
    </script>
</body>
</html>
