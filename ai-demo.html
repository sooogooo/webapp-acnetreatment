<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ¨¡å‹ç®¡ç†ç³»ç»Ÿ - æ¼”ç¤ºé¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .demo-header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .demo-header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .demo-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .demo-nav {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .toast.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 50px;
            padding: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .footer h3 {
            margin-bottom: 15px;
        }

        .footer p {
            opacity: 0.9;
            line-height: 1.6;
        }

        .stats-summary {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }

        .stats-summary h2 {
            margin-bottom: 20px;
            color: #1f2937;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-box {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-radius: 12px;
        }

        .stat-box .value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-box .label {
            color: #6b7280;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="demo-header">
        <h1>ğŸ¤– AIæ¨¡å‹ç®¡ç†ç³»ç»Ÿ</h1>
        <p>ä¸€ä¸ªå®Œæ•´çš„å¤šæ¨¡å‹AIé›†æˆè§£å†³æ–¹æ¡ˆ</p>
    </div>

    <!-- å¯¼èˆªæ  -->
    <div class="demo-nav">
        <button class="nav-btn active" onclick="switchSection('overview')">ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ</button>
        <button class="nav-btn" onclick="switchSection('config')">ğŸ”§ æ¨¡å‹é…ç½®</button>
        <button class="nav-btn" onclick="switchSection('selector')">ğŸ¤– æ¨¡å‹é€‰æ‹©</button>
        <button class="nav-btn" onclick="switchSection('dashboard')">ğŸ“ˆ æˆæœ¬ç»Ÿè®¡</button>
        <button class="nav-btn" onclick="switchSection('demo')">ğŸ’¬ å¯¹è¯æ¼”ç¤º</button>
    </div>

    <!-- ç³»ç»Ÿæ¦‚è§ˆ -->
    <div id="overview-section" class="section active">
        <div class="stats-summary">
            <h2>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="value" id="total-code-lines">4,580</div>
                    <div class="label">æ€»ä»£ç è¡Œæ•°</div>
                </div>
                <div class="stat-box">
                    <div class="value">10</div>
                    <div class="label">æ ¸å¿ƒç±»</div>
                </div>
                <div class="stat-box">
                    <div class="value">6</div>
                    <div class="label">æ”¯æŒæ¨¡å‹</div>
                </div>
                <div class="stat-box">
                    <div class="value">85%</div>
                    <div class="label">é¡¹ç›®è¿›åº¦</div>
                </div>
            </div>
        </div>

        <div class="stats-summary">
            <h2>âœ¨ æ ¸å¿ƒç‰¹æ€§</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">ğŸ¯ æ™ºèƒ½è·¯ç”±</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        è‡ªåŠ¨è¯„ä¼°é—®é¢˜å¤æ‚åº¦ï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä¼˜æ¨¡å‹ï¼Œæ”¯æŒä¸‰ç§é™çº§ç­–ç•¥
                    </p>
                </div>
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #10b981; margin-bottom: 10px;">ğŸ’° æˆæœ¬æ§åˆ¶</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        å®æ—¶æˆæœ¬è¿½è¸ªï¼Œé¢„ç®—ç®¡ç†ï¼Œæ”¯æŒæ—¥/å‘¨/æœˆç»Ÿè®¡æŠ¥å‘Š
                    </p>
                </div>
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #f59e0b; margin-bottom: 10px;">âš¡ æ€§èƒ½ä¼˜åŒ–</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        LRUç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘APIè°ƒç”¨ï¼Œæå‡å“åº”é€Ÿåº¦
                    </p>
                </div>
                <div style="padding: 20px; background: #f3f4f6; border-radius: 12px;">
                    <h3 style="color: #8b5cf6; margin-bottom: 10px;">ğŸ¨ ç²¾ç¾UI</h3>
                    <p style="color: #6b7280; line-height: 1.6;">
                        ç°ä»£åŒ–ç•Œé¢è®¾è®¡ï¼Œå“åº”å¼å¸ƒå±€ï¼Œå®Œç¾çš„ç”¨æˆ·ä½“éªŒ
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡å‹é…ç½® -->
    <div id="config-section" class="section">
        <div id="ai-config-panel"></div>
    </div>

    <!-- æ¨¡å‹é€‰æ‹© -->
    <div id="selector-section" class="section">
        <div id="ai-model-selector"></div>
    </div>

    <!-- æˆæœ¬ç»Ÿè®¡ -->
    <div id="dashboard-section" class="section">
        <div id="ai-cost-dashboard"></div>
    </div>

    <!-- å¯¹è¯æ¼”ç¤º -->
    <div id="demo-section" class="section">
        <div class="stats-summary">
            <h2>ğŸ’¬ AIå¯¹è¯æ¼”ç¤º</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">
                é…ç½®API Keyåå³å¯å¼€å§‹å¯¹è¯ï¼ˆå½“å‰ä¸ºæ¼”ç¤ºæ¨¡å¼ï¼‰
            </p>

            <div style="background: #f9fafb; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                <input type="text"
                       id="chat-input"
                       placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
                       style="width: 100%; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1em;">
            </div>

            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="sendDemoMessage()"
                        style="padding: 12px 30px; border: none; border-radius: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; cursor: pointer;">
                    å‘é€æ¶ˆæ¯
                </button>
                <button onclick="testCache()"
                        style="padding: 12px 30px; border: none; border-radius: 25px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-weight: 600; cursor: pointer;">
                    æµ‹è¯•ç¼“å­˜
                </button>
                <button onclick="testRouter()"
                        style="padding: 12px 30px; border: none; border-radius: 25px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; font-weight: 600; cursor: pointer;">
                    æµ‹è¯•è·¯ç”±
                </button>
            </div>

            <div id="chat-output" style="margin-top: 20px; padding: 20px; background: white; border-radius: 12px; min-height: 200px;">
                <div style="color: #9ca3af; text-align: center; padding: 40px;">
                    æš‚æ— å¯¹è¯è®°å½•
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <div class="footer">
        <h3>ğŸ‰ Phase 3 UIå¼€å‘å®Œæˆï¼</h3>
        <p>
            å·²å®Œæˆï¼šæ¨¡å‹é…ç½®é¢æ¿ï¼ˆ650è¡Œï¼‰+ æ¨¡å‹é€‰æ‹©å™¨ï¼ˆ550è¡Œï¼‰+ æˆæœ¬ä»ªè¡¨ç›˜ï¼ˆ700è¡Œï¼‰<br>
            æ€»ä»£ç é‡ï¼š4,580è¡Œ | å½“å‰è¿›åº¦ï¼š85%<br>
            ä¸‹ä¸€æ­¥ï¼šé›†æˆåˆ°å®é™…åº”ç”¨ + å®Œæ•´æµ‹è¯•
        </p>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰JSæ–‡ä»¶ -->
    <script src="js/ai-models/providers/base-provider.js"></script>
    <script src="js/ai-models/providers/qwen-provider.js"></script>
    <script src="js/ai-models/providers/glm-provider.js"></script>
    <script src="js/ai-models/model-manager.js"></script>
    <script src="js/ai-models/utils/smart-router.js"></script>
    <script src="js/ai-models/utils/cost-tracker.js"></script>
    <script src="js/ai-models/utils/response-cache.js"></script>
    <script src="js/ai-models/ui/config-panel.js"></script>
    <script src="js/ai-models/ui/model-selector.js"></script>
    <script src="js/ai-models/ui/cost-dashboard.js"></script>

    <script>
        // ========== åˆå§‹åŒ–ç³»ç»Ÿ ==========
        console.log('%cğŸ¤– AIæ¨¡å‹ç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–ä¸­...', 'color: #667eea; font-size: 18px; font-weight: bold;');

        const manager = new AIModelManager();
        const router = new SmartRouter(manager);
        const tracker = new CostTracker();
        const cache = new ResponseCache();

        // æ³¨å†Œæ¼”ç¤ºProviderï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
        try {
            // æ³¨å†Œglm-4-flashï¼ˆå…è´¹æ¨¡å‹ï¼‰
            manager.registerProvider('glm-4-flash', {
                chat: async () => ({ content: 'è¿™æ˜¯GLM-4-Flashçš„æ¨¡æ‹Ÿå“åº”', cost: 0, usage: { inputTokens: 10, outputTokens: 15 } }),
                streamChat: async () => {},
                getModelInfo: () => ({ provider: 'ChatGLM', model: 'glm-4-flash', stats: { totalCalls: 42, totalCost: 0 } })
            });

            // æ³¨å†Œqwen-plus
            manager.registerProvider('qwen-plus', {
                chat: async () => ({ content: 'è¿™æ˜¯Qwen-Plusçš„æ¨¡æ‹Ÿå“åº”', cost: 0.016, usage: { inputTokens: 10, outputTokens: 15 } }),
                streamChat: async () => {},
                getModelInfo: () => ({ provider: 'é€šä¹‰åƒé—®', model: 'qwen-plus', stats: { totalCalls: 28, totalCost: 0.45 } })
            });

            manager.setCurrentModel('glm-4-flash');
            console.log('%câœ“ Provideræ³¨å†ŒæˆåŠŸ', 'color: #10b981; font-weight: bold;');
        } catch (error) {
            console.error('Provideræ³¨å†Œå¤±è´¥:', error);
        }

        // ========== æ¸²æŸ“UIç»„ä»¶ ==========
        const configPanel = new ConfigPanel(manager);
        configPanel.render();
        window.configPanel = configPanel;

        const modelSelector = new ModelSelector(manager, {
            mode: 'both',
            onChange: (model) => {
                showToast(`å·²åˆ‡æ¢åˆ° ${model}`, 'success');
            }
        });
        modelSelector.render();
        window.modelSelector = modelSelector;

        const costDashboard = new CostDashboard(tracker);
        costDashboard.render();
        window.costDashboard = costDashboard;

        console.log('%câœ“ UIç»„ä»¶æ¸²æŸ“å®Œæˆ', 'color: #10b981; font-weight: bold;');

        // ========== å·¥å…·å‡½æ•° ==========
        function switchSection(section) {
            // éšè—æ‰€æœ‰section
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));

            // æ˜¾ç¤ºé€‰ä¸­çš„section
            document.getElementById(section + '-section').classList.add('active');
            event.target.classList.add('active');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        window.showToast = showToast;  // å…¨å±€è®¿é—®

        // ========== æ¼”ç¤ºåŠŸèƒ½ ==========
        async function sendDemoMessage() {
            const input = document.getElementById('chat-input');
            const output = document.getElementById('chat-output');
            const message = input.value.trim();

            if (!message) {
                showToast('è¯·è¾“å…¥æ¶ˆæ¯', 'error');
                return;
            }

            try {
                showToast('æ­£åœ¨å¤„ç†...', 'info');

                // æ¨¡æ‹ŸAPIè°ƒç”¨
                const response = await manager.chat([{ role: 'user', content: message }]);

                // è®°å½•æˆæœ¬
                tracker.track({
                    model: manager.getCurrentModel(),
                    inputTokens: response.usage.inputTokens,
                    outputTokens: response.usage.outputTokens,
                    cost: response.cost,
                    responseTime: 1200,
                    success: true
                });

                // æ˜¾ç¤ºå“åº”
                output.innerHTML = `
                    <div style="margin-bottom: 15px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                        <strong>ç”¨æˆ·:</strong> ${message}
                    </div>
                    <div style="padding: 15px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #10b981;">
                        <strong>AI (${manager.getCurrentModel()}):</strong> ${response.content}
                        <div style="margin-top: 10px; font-size: 0.9em; color: #6b7280;">
                            è´¹ç”¨: Â¥${response.cost.toFixed(4)} | å“åº”æ—¶é—´: 1.2s
                        </div>
                    </div>
                `;

                input.value = '';
                showToast('å“åº”æˆåŠŸï¼', 'success');

            } catch (error) {
                showToast('å‘é€å¤±è´¥: ' + error.message, 'error');
            }
        }

        function testCache() {
            const stats = cache.getStats();
            showToast(`ç¼“å­˜å‘½ä¸­ç‡: ${stats.hitRate} | èŠ‚çœ: Â¥${stats.totalSaved.toFixed(4)}`, 'info');
        }

        function testRouter() {
            const config = router.getConfig();
            showToast('è·¯ç”±é…ç½®å·²åŠ è½½ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹æ§åˆ¶å°', 'info');
            console.log('è·¯ç”±é…ç½®:', config);
        }

        // æ·»åŠ æ¨¡æ‹Ÿæ•°æ®ä»¥ä¾¿æ¼”ç¤º
        for (let i = 0; i < 5; i++) {
            tracker.track({
                model: i % 2 === 0 ? 'glm-4-flash' : 'qwen-plus',
                inputTokens: 100 + i * 10,
                outputTokens: 150 + i * 15,
                cost: i % 2 === 0 ? 0 : 0.004 * (i + 1),
                responseTime: 1000 + i * 100,
                success: true
            });
        }

        console.log('%cğŸ‰ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼', 'color: #10b981; font-size: 18px; font-weight: bold;');
    </script>
</body>
</html>
